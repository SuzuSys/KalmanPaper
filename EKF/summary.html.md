# 非線形カルマンフィルタの概要


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## 概要

### Schur 補行列

区分行列 **M** を

$$\mathbf M=\begin{pmatrix}\mathbf A & \mathbf B \\ \mathbf C & \mathbf D  \end{pmatrix}$$

としたとき、区画 **D** に関する Schur 補行列とは

**M**/**D** = **A** − **B****D**<sup>−1</sup>**C**

で与えられる。区画 **A** に関する Schur 補行列とは

**M**/**A** = **D** − **C****A**<sup>−1</sup>**B**

で与えられる。

### 区分行列の逆行列

**定理**

区分行列 **M** を

$$\mathbf M=\begin{pmatrix}\mathbf A & \mathbf B \\ \mathbf C & \mathbf D  \end{pmatrix}$$

としたとき、

$$
\begin{split}
\mathbf M^{-1} &=\begin{pmatrix}\mathbf A^{-1}+\mathbf A^{-1}\mathbf B(\mathbf M/\mathbf A)^{-1}\mathbf C\mathbf A^{-1} & -\mathbf A^{-1}\mathbf B(\mathbf M/\mathbf A)^{-1} \\ -(\mathbf M/\mathbf A)^{-1}\mathbf C\mathbf A^{-1} & (\mathbf M/\mathbf A)^{-1}\end{pmatrix} \\
&=\begin{pmatrix}(\mathbf M/\mathbf D)^{-1} & -(\mathbf M/\mathbf D)^{-1}\mathbf B\mathbf D^{-1} \\ -\mathbf D^{-1}\mathbf C(\mathbf M/\mathbf D)^{-1} & \mathbf D^{-1}+\mathbf D^{-1}\mathbf C(\mathbf M/\mathbf D)^{-1}\mathbf B\mathbf D^{-1}\end{pmatrix}
\end{split}
$$

が成り立つ。

### Schur 補行列の正定値性

**定理**

対称な行列 **M** を

$$\mathbf M=\begin{pmatrix}\mathbf A & \mathbf B \\ \mathbf B^T & \mathbf C\end{pmatrix}$$

とすると、

If **C** ≻ 0, then (**M** ≽ 0 ⇔ **M**/**C** ≽ 0)

If **A** ≻ 0, then (**M** ≽ 0 ⇔ **M**/**A** ≽ 0)

が成り立つ。

**定理**

𝔼 を任意の期待値：
𝔼<sub>**x**, **y**</sub>, 𝔼<sub>**x** ∣ **y**</sub>, 𝔼<sub>**y** ∣ **x**</sub>
であるとする。

$$
\begin{pmatrix} \mathbb E\[\mathbf f(\mathbf x,\mathbf y)\mathbf f(\mathbf x,\mathbf y)^T\] & \mathbb E\[\mathbf f(\mathbf x,\mathbf y)\mathbf g(\mathbf x,\mathbf y)^T\] \\ \mathbb E\[\mathbf f(\mathbf x,\mathbf y)\mathbf g(\mathbf x,\mathbf y)^T\]^T & \mathbb E\[\mathbf g(\mathbf x,\mathbf y)\mathbf g(\mathbf x,\mathbf y)^T\] \end{pmatrix}\succeq 0
$$

**証明**

**h**(**x**, **y**) を

$$\mathbf h(\mathbf x,\mathbf y)=\begin{pmatrix}\mathbf f(\mathbf x,\mathbf y) \\ \mathbf g(\mathbf x,\mathbf y)\end{pmatrix}$$

とすると、任意のベクトル **u** に対して

$$
\begin{split}
&\phantom{=}\mathbf u^T\begin{pmatrix} \mathbb E\[\mathbf f(\mathbf x,\mathbf y)\mathbf f(\mathbf x,\mathbf y)^T\] & \mathbb E\[\mathbf f(\mathbf x,\mathbf y)\mathbf g(\mathbf x,\mathbf y)^T\] \\ \mathbb E\[\mathbf f(\mathbf x,\mathbf y)\mathbf g(\mathbf x,\mathbf y)^T\]^T & \mathbb E\[\mathbf g(\mathbf x,\mathbf y)\mathbf g(\mathbf x,\mathbf y)^T\] \end{pmatrix}\mathbf u \\
&= \mathbf u^T\mathbb E\[\mathbf h(\mathbf x,\mathbf y)\mathbf h(\mathbf x,\mathbf y)^T\]\mathbf u \\
&= \mathbb E\[(\mathbf h(\mathbf x,\mathbf y)\mathbf u)^2\] \\
&\succeq 0
\end{split}
$$

**定理**

𝔼\[**g**(**x**, **y**)**g**(**x**, **y**)<sup>*T*</sup>\] ≻ 0 のとき、

𝔼\[**f**(**x**, **y**)**f**(**x**, **y**)<sup>*T*</sup>\] ≽ 𝔼\[**f**(**x**, **y**)**g**(**x**, **y**)<sup>*T*</sup>\]𝔼\[**g**(**x**, **y**)**g**(**x**, **y**)<sup>*T*</sup>\]<sup>−1</sup>𝔼\[**f**(**x**, **y**)**g**(**x**, **y**)<sup>*T*</sup>\]<sup>*T*</sup>

が成り立つ。

**証明**

$$\mathbf M=\begin{pmatrix} \mathbb E\[\mathbf f(\mathbf x,\mathbf y)\mathbf f(\mathbf x,\mathbf y)^T\] & \mathbb E\[\mathbf f(\mathbf x,\mathbf y)\mathbf g(\mathbf x,\mathbf y)^T\] \\ \mathbb E\[\mathbf f(\mathbf x,\mathbf y)\mathbf g(\mathbf x,\mathbf y)^T\]^T & \mathbb E\[\mathbf g(\mathbf x,\mathbf y)\mathbf g(\mathbf x,\mathbf y)^T\] \end{pmatrix}$$

とすると、 **M** ≽ 0 であり、よって
**M**/𝔼\[**g**(**x**, **y**)**g**(**x**, **y**)<sup>*T*</sup>\] ≽ 0
である。

### Fisher 情報行列

**w** を未知変数、 *y* を観測変数とする。 Fisher 情報行列を

$$
\begin{split}
I(\mathbf w) &=-\mathbb E\_{y\mid \mathbf w}\left\[\frac{\partial^2}{\partial \mathbf w^2}\ln p(y\mid\mathbf w)\right\] \\
&= -\int\left(\frac{\partial^2}{\partial \mathbf w^2}\ln p(y\mid\mathbf w)\right)p(y\mid\mathbf w)dy \\
&\in\mathbb R^{n\times n}
\end{split}
$$

とする。各要素は

$$
I\_{ij}=-\mathbb E\_{y\mid\mathbf w}\left\[\frac{\partial^2}{\partial w_i\partial w_j}\ln p(y\mid\mathbf w)\right\]
$$

となる。

### Fisher 情報行列は対称行列である

$$
\begin{split}
I(\mathbf w) &=-\mathbb E\_{y\mid \mathbf w}\left\[\frac{\partial^2}{\partial \mathbf w^2}\ln p(y\mid\mathbf w)\right\] \\
&= -\int\left(\frac{\partial^2}{\partial \mathbf w^2}\ln p(y\mid\mathbf w)\right)p(y\mid\mathbf w)dy \\
&= -\int\left(\frac{\partial}{\partial\mathbf w}\left\[\frac{1}{p(y\mid\mathbf w)}\frac{\partial}{\partial\mathbf w}p(y\mid\mathbf w)\right\]\right)p(y\mid\mathbf w)dy \\
&= -\int\left(-\left\[\frac{1}{p(y\mid\mathbf w)}\right\]^2\left\[\frac{\partial}{\partial\mathbf w}p(y\mid\mathbf w)\right\]\left\[\frac{\partial}{\partial\mathbf w}p(y\mid\mathbf w)\right\]^T+\frac{1}{p(y\mid\mathbf w)}\frac{\partial^2}{\partial\mathbf w^2}p(y\mid\mathbf w)\right)p(y\mid\mathbf w)dy \\
&= \int\left(\frac{1}{p(y\mid\mathbf w)}\frac{\partial}{\partial \mathbf w}p(y\mid\mathbf w)\right)\left(\frac{1}{p(y\mid\mathbf w)}\frac{\partial}{\partial \mathbf w}p(y\mid\mathbf w)\right)^Tp(y\mid\mathbf w)dy-\int\frac{\partial^2}{\partial\mathbf w^2}p(y\mid\mathbf w)dy \\
&= \int\left(\frac{\partial}{\partial\mathbf w}\ln p(y\mid\mathbf w)\right)\left(\frac{\partial}{\partial\mathbf w}\ln p(y\mid\mathbf w)\right)^Tp(y\mid\mathbf w)dy-\underbrace{\frac{\partial^2}{\partial\mathbf w^2}\int p(y\mid\mathbf w)dy}\_\mathbf O \\
&= \mathbb E\_{y\mid\mathbf w}\left\[\left(\frac{\partial}{\partial\mathbf w}\ln p(y\mid\mathbf w)\right)\left(\frac{\partial}{\partial\mathbf w}\ln p(y\mid\mathbf w)\right)^T\right\]
\end{split}
$$

であるから、Fisher 情報行列は

$$
I(\mathbf w) =-\mathbb E\_{y\mid \mathbf w}\left\[\frac{\partial^2}{\partial \mathbf w^2}\ln p(y\mid\mathbf w)\right\] = \mathbb E\_{y\mid\mathbf w}\left\[\left(\frac{\partial}{\partial\mathbf w}\ln p(y\mid\mathbf w)\right)\left(\frac{\partial}{\partial\mathbf w}\ln p(y\mid\mathbf w)\right)^T\right\]
$$

と表せる。

### クラメル・ラオ不等式

**定理**

*I*(**w**) ≻ 0 のとき、

𝔼<sub>*y* ∣ **w**</sub>\[(**w** − **f**(*y*))(**w** − **f**(*y*))<sup>*T*</sup>\] ≽ *I*<sup>−1</sup>(**w**)

が成り立つ。ただし、 **f**(*y*)
は不偏推定値とする。つまり、次式が成り立つとする。

𝔼<sub>*y* ∣ **w**</sub>\[**f**(*y*)\] = **w**

**証明**

Schur 補行列の正定値性より、

$$
\begin{split}
&\phantom{=}\mathbb E\_{y\mid\mathbf w}\left\[(\mathbf w-\mathbf f(y))(\mathbf w-\mathbf f(y))^T\right\] \\
&\succeq \mathbb E\_{y\mid\mathbf w}\left\[(\mathbf w-\mathbf f(y))\left(\frac{\partial}{\partial \mathbf w}\ln p(y\mid\mathbf w)\right)^T\right\]I^{-1}(\mathbf w)\mathbb E\_{y\mid\mathbf w}\left\[(\mathbf w-\mathbf f(y))\left(\frac{\partial}{\partial \mathbf w}\ln p(y\mid\mathbf w)\right)^T\right\]^T
\end{split}
$$

ここで、

$$
\begin{split}
\mathbb E\_{y\mid\mathbf w}\left\[(\mathbf w-\mathbf f(y))\left(\frac{\partial}{\partial \mathbf w}\ln p(y\mid\mathbf w)\right)^T\right\] &= \int\left(\mathbf w-\mathbf f(y)\right)\left(\frac{1}{p(y\mid\mathbf w)}\frac{\partial}{\partial\mathbf w}p(y\mid\mathbf w)\right)^Tp(y\mid\mathbf w)dy \\
&= \int \left(\mathbf w - \mathbf f(y)\right)\left(\frac{\partial}{\partial\mathbf w}p(y\mid\mathbf w)\right)^Tdy \\
&= \mathbf w\left( \frac{\partial}{\partial \mathbf w} \int p(y\mid\mathbf w) dy \right)^T-\frac{\partial}{\partial \mathbf w^T}\int \mathbf f(y) p(y\mid\mathbf w)dy \\
&= \underbrace{\mathbf w\left(\frac{\partial}{\partial \mathbf w} 1\right)^T}\_\mathbf O-\frac{\partial}{\partial\mathbf w^T}\mathbf w \\
&= -\mathbf I
\end{split}
$$

が成り立つ。 **I** は単位行列を表す。

### ベイズ情報行列

**w** を未知変数、 *y* を観測変数とする。 ベイズ情報行列を

$$
\begin{split}
J &=-\mathbb E\_{\mathbf w, y}\left\[\frac{\partial^2}{\partial \mathbf w^2}\ln p(\mathbf w, y)\right\] \\
&= -\int\int\left(\frac{\partial^2}{\partial \mathbf w^2}\ln p(\mathbf w, y)\right)p(\mathbf w, y)dyd\mathbf w \\
&\in\mathbb R^{n\times n}
\end{split}
$$

とする。各要素は

$$
J\_{ij}=-\mathbb E\_{\mathbf w,y}\left\[\frac{\partial^2}{\partial w_i\partial w_j}\ln p(\mathbf w,y)\right\]
$$

となる。

### ベイズ情報行列は対称行列である

$$
\begin{split}
J &=-\mathbb E\_{\mathbf w,y}\left\[\frac{\partial^2}{\partial \mathbf w^2}\ln p(\mathbf w,y)\right\] \\
&= -\int\int\left(\frac{\partial^2}{\partial \mathbf w^2}\ln p(\mathbf w,y)\right)p(\mathbf w,y)d\mathbf wdy \\
&= -\int\int\left(\frac{\partial}{\partial\mathbf w}\left\[\frac{1}{p(\mathbf w,y)}\frac{\partial}{\partial\mathbf w}p(\mathbf w,y)\right\]\right)p(\mathbf w,y)d\mathbf wdy \\
&= -\int\int\left(-\left\[\frac{1}{p(\mathbf w,y)}\right\]^2\left\[\frac{\partial}{\partial\mathbf w}p(\mathbf w,y)\right\]\left\[\frac{\partial}{\partial\mathbf w}p(\mathbf w,y)\right\]^T+\frac{1}{p(\mathbf w,y)}\frac{\partial^2}{\partial\mathbf w^2}p(\mathbf w,y)\right)p(\mathbf w,y)d\mathbf wdy \\
&= \int\int\left(\frac{1}{p(\mathbf w,y)}\frac{\partial}{\partial \mathbf w}p(\mathbf w,y)\right)\left(\frac{1}{p(\mathbf w,y)}\frac{\partial}{\partial \mathbf w}p(\mathbf w,y)\right)^Tp(\mathbf w,y)d\mathbf wdy-\int\int\frac{\partial^2}{\partial\mathbf w^2}p(\mathbf w,y)d\mathbf wdy \\
&= \int\int\left(\frac{\partial}{\partial\mathbf w}\ln p(\mathbf w,y)\right)\left(\frac{\partial}{\partial\mathbf w}\ln p(\mathbf w,y)\right)^Tp(\mathbf w,y)d\mathbf wdy-\underbrace{\frac{\partial^2}{\partial\mathbf w^2}\int\int p(\mathbf w,y)d\mathbf wdy}\_\mathbf O \\
&= \mathbb E\_{\mathbf w,y}\left\[\left(\frac{\partial}{\partial\mathbf w}\ln p(\mathbf w,y)\right)\left(\frac{\partial}{\partial\mathbf w}\ln p(\mathbf w,y)\right)^T\right\]
\end{split}
$$

であり、

$$
\begin{split}
J &=-\mathbb E\_{\mathbf w,y}\left\[\frac{\partial^2}{\partial \mathbf w^2}\ln p(\mathbf w,y)\right\] \\
&= -\int\int\left(\frac{\partial^2}{\partial \mathbf w^2}\ln p(\mathbf w\mid y)\right)p(\mathbf w,y)d\mathbf wdy -\underbrace{\int\int\left(\frac{\partial^2}{\partial \mathbf w^2}\ln p(y)\right)p(\mathbf w,y)d\mathbf wdy}\_\mathbf O \\
&= \mathbb E\_{\mathbf w,y}\left\[\left(\frac{\partial}{\partial\mathbf w}\ln p(\mathbf w\mid y)\right)\left(\frac{\partial}{\partial\mathbf w}\ln p(\mathbf w\mid y)\right)^T\right\]
\end{split}
$$

であるから、ベイズ情報行列は

$$
\begin{split}
J &=-\mathbb E\_{\mathbf w,y}\left\[\frac{\partial^2}{\partial \mathbf w^2}\ln p(\mathbf w,y)\right\] \\
&= \mathbb E\_{\mathbf w,y}\left\[\left(\frac{\partial}{\partial\mathbf w}\ln p(\mathbf w,y)\right)\left(\frac{\partial}{\partial\mathbf w}\ln p(\mathbf w,y)\right)^T\right\] \\
&= \mathbb E\_{\mathbf w,y}\left\[\left(\frac{\partial}{\partial\mathbf w}\ln p(\mathbf w\mid y)\right)\left(\frac{\partial}{\partial\mathbf w}\ln p(\mathbf w\mid y)\right)^T\right\]
\end{split}
$$

と表せる。

### 事後クラメル・ラオ不等式 (Posterior Cramér-Rao inequality)

**定理**

*J* ≻ 0 のとき、

𝔼<sub>**w**, *y*</sub>\[(**w** − **f**(*y*))(**w** − **f**(*y*))<sup>*T*</sup>\] ≽ *J*<sup>−1</sup>

が成り立つ。ただし、次式が成り立つとする。

lim<sub>**w**<sub>*i*</sub> → ±∞</sub>𝔼<sub>*y* ∣ **w**</sub>\[**f**(*y*) − **w**\]*p*(**w**) = lim<sub>**w**<sub>*i*</sub> → ±∞</sub>∫(**f**(*y*) − **w**)*p*(**w**, *y*)*d**y* = **0**, *i* = 1, …, *n*

**証明**

Schur 補行列の正定値性より、

$$
\begin{split}
&\phantom{=}\mathbb E\_{\mathbf w,y}\left\[(\mathbf w-\mathbf f(y))(\mathbf w-\mathbf f(y))^T\right\] \\
&\succeq \mathbb E\_{\mathbf w,y}\left\[(\mathbf w-\mathbf f(y))\left(\frac{\partial}{\partial \mathbf w}\ln p(\mathbf w,y)\right)^T\right\]J^{-1}\mathbb E\_{\mathbf w,y}\left\[(\mathbf w-\mathbf f(y))\left(\frac{\partial}{\partial \mathbf w}\ln p(\mathbf w,y)\right)^T\right\]^T
\end{split}
$$

ここで、

$$
\begin{split}
\mathbb E\_{\mathbf w,y}\left\[(\mathbf w-\mathbf f(y))\left(\frac{\partial}{\partial \mathbf w}\ln p(\mathbf w,y)\right)^T\right\] &= \int\int\left(\mathbf w-\mathbf f(y)\right)\left(\frac{1}{p(\mathbf w,y)}\frac{\partial}{\partial\mathbf w}p(\mathbf w,y)\right)^Tp(\mathbf w,y)d\mathbf wdy \\
&= \int\int \left(\mathbf w - \mathbf f(y)\right)\left(\frac{\partial}{\partial\mathbf w}p(\mathbf w,y)\right)^Td\mathbf wdy
\end{split}
$$

が成り立つ。*i**j* 要素に対して部分積分すると、

$$
\begin{split}
& \left\\\int\int \left(\mathbf w - \mathbf f(y)\right)\left(\frac{\partial}{\partial\mathbf w}p(\mathbf w,y)\right)^Td\mathbf wdy\right\\\_{ij} \\
&= \int\int(w_i-f_i(y))\left(\frac{\partial}{\partial w_j}p(\mathbf w,y)\right)d\mathbf wdy \\
&= \int\int\left\[(w_i-f_i(y))p(\mathbf w,y)\right\]\_{w_j=-\infty}^{w_j=\infty}d\mathbf w_kdy-\int\int\frac{\partial}{\partial w_j}(w_i-f_i(y))p(\mathbf w,y)d\mathbf wdy \\
&= \int\left\[\lim\_{w_j\to\infty}\int(w_i-f_i(y))p(\mathbf w,y)dy-\lim\_{w_j\to-\infty}\int(w_i-f_i(y))p(\mathbf w,y)dy\right\]d\mathbf w_k - I\_{ij} \\
&= -I\_{ij}
\end{split}
$$

となる。**w**<sub>*k*</sub> は *k* ≠ *j* となる全ての *k* を添字とする
*w* を表す。 *I*<sub>*i**j*</sub> とは単位行列 **I** の *i**j*
要素を表す。

### 部分ベイズ行列

**定理**

$$\mathbf w - \mathbf f(y)=\begin{pmatrix}\mathbf w_a-\mathbf f_a(y) \\ \mathbf w_b-\mathbf f_b(y)\end{pmatrix}$$

とおくと、ベイズ情報行列は

$$J=\begin{pmatrix}\mathbf A &\mathbf B \\\mathbf C &\mathbf D\end{pmatrix}$$

と表せる。ただし、例えば **A** は

$$\mathbf A=\mathbb E\_{\mathbf w_a,y}\left\[\left(\frac{\partial}{\partial\mathbf w_a}\ln p(\mathbf w_a\mid y)\right)\left(\frac{\partial}{\partial \mathbf w_a}\ln p(\mathbf w_a\mid y)\right)^T\right\]$$

と表す。このとき、*J* ≻ 0 ならば、次を得る。

𝔼<sub>**w**<sub>*b*</sub>, *y*</sub>\[(**w**<sub>*b*</sub> − **f**<sub>*b*</sub>(*y*))(**w**<sub>*b*</sub> − **f**<sub>*b*</sub>(*y*))<sup>*T*</sup>\] ≽ (*J*/**A**)<sup>−1</sup>

**証明**

次の式において、⋅ は省略を意味する。

$$\mathbb E\_{\mathbf w,y}\left\[(\mathbf w-\mathbf f(y))(\mathbf w-\mathbf f(y))^T\right\]=\begin{pmatrix}\cdot & \cdot \\ \cdot & \mathbb E\_{\mathbf w_b,y}\left\[(\mathbf w_b-\mathbf f_b(y))(\mathbf w_b-\mathbf f_b(y))^T\right\]\end{pmatrix}$$

$$J^{-1}=\begin{pmatrix}\cdot & \cdot \\ \cdot & (J/\mathbf A)^{-1}\end{pmatrix}$$

任意の **x** について、

**x**<sup>*T*</sup>(𝔼<sub>**w**, *y*</sub>\[(**w** − **f**(*y*))(**w** − **f**(*y*))<sup>*T*</sup>\] − *J*<sup>−1</sup>)**x** ≥ 0

であるから、

$$\mathbf x=\begin{pmatrix}\mathbf 0 \\ \mathbf x_b\end{pmatrix}$$

として、

$$
\begin{split}
\phantom{=}&\\ \mathbf x^T(\mathbb E\_{\mathbf w,y}\left\[(\mathbf w-\mathbf f(y))(\mathbf w-\mathbf f(y))^T\right\]-J^{-1})\mathbf x \\
=&\\ \mathbf x_b^T (\mathbb E\_{\mathbf w_b,y}\left\[(\mathbf w_b-\mathbf f_b(y))(\mathbf w_b-\mathbf f_b(y))^T\right\]-(J/\mathbf A)^{-1})\mathbf x_b \\
\ge&\\ 0
\end{split}
$$

が成り立つ。
