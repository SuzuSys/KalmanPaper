[
  {
    "objectID": "Gen/gen.html",
    "href": "Gen/gen.html",
    "title": "00_Gen",
    "section": "",
    "text": "source\n\ngen_w\n\n gen_w (key:Union[jaxtyping.Key[Array,''],jaxtyping.UInt32[Array,'2']],\n        N:int, T:int, G:jaxtyping.Float[Array,'{N}{N}'],\n        w0:jaxtyping.Float[Array,'{N}'])\n\n\\(\\!\\) 潜在変数 \\(\\{\\mathbf w_t\\}_{t=0,\\ldots,T-1}\\) の生成 \\[\\mathbf w_{t}\\sim\\mathcal N(\\mathbf w_t\\mid\\mathbf w_{t-1},\\boldsymbol\\Gamma)\\] \\(\\!\\)\n\n\n\n\n\n\n\n\n\nType\nDetails\n\n\n\n\nkey\nUnion\nPRNGKeyArray\n\n\nN\nint\n\\(N\\)\n\n\nT\nint\n\\(T\\)\n\n\nG\nFloat[Array, ‘{N} {N}’]\n\\(\\boldsymbol\\Gamma\\)\n\n\nw0\nFloat[Array, ‘{N}’]\n\\(\\mathbf w_{-1}\\)\n\n\nReturns\nFloat[Array, ‘{T} {N}’]\n\\(\\{\\mathbf w_t\\}_{t=0,\\ldots,T-1}\\)\n\n\n\n\nsource\n\n\ngen_xy\n\n gen_xy (key:Union[jaxtyping.Key[Array,''],jaxtyping.UInt32[Array,'2']],\n         N:int, T:int, Sigma:jaxtyping.Float[Array,'{N}{N}'],\n         W:jaxtyping.Float[Array,'{T}{N}'])\n\n\\(\\!\\) 観測変数 \\(\\{\\mathbf x_t\\}_{t=0,\\ldots,T-1}, \\{y_t\\}_{t=0,\\ldots,T-1}\\) の生成 \\[y_t\\sim\\text{Bern}(y_t\\mid 1/2)\\] \\[\\boldsymbol\\Sigma\\mathbf w_t=2\\boldsymbol\\mu_{1,t}\\] \\[\\boldsymbol\\mu_{2,t}=-\\boldsymbol\\mu_{1,t}\\] \\[\n\\mathbf x_t\\sim\n\\begin{cases}\n\\displaystyle\\mathcal N\\left(\\boldsymbol\\mu_{1,t},\\boldsymbol\\Sigma\\right) & (y_t=1) \\\\\n\\displaystyle\\mathcal N\\left(\\boldsymbol\\mu_{2,t},\\boldsymbol\\Sigma\\right) & (y_t=0)\n\\end{cases}\n\\] \\(\\!\\)\n\n\n\n\n\n\n\n\n\nType\nDetails\n\n\n\n\nkey\nUnion\nRPNGKeyArray\n\n\nN\nint\n\\(N\\)\n\n\nT\nint\n\\(T\\)\n\n\nSigma\nFloat[Array, ‘{N} {N}’]\n\\(\\boldsymbol\\Sigma\\)\n\n\nW\nFloat[Array, ‘{T} {N}’]\n\\(\\{\\mathbf w_t\\}_{t=0,\\ldots,T-1}\\)\n\n\nReturns\nTuple\n\\(\\{\\mathbf x_t\\}_{t=0,\\ldots,T-1}, \\{y_t\\}_{t=0,\\ldots,T-1}\\)",
    "crumbs": [
      "データ生成",
      "00_Gen"
    ]
  },
  {
    "objectID": "common.html",
    "href": "common.html",
    "title": "共通概念・表記",
    "section": "",
    "text": "\\[\n\\begin{split}\np(y_t=1\\mid\\mathbf w_t) &= \\sigma(\\mathbf w_t^T\\mathbf x_t) \\\\\np(\\mathbf w_{t+1}\\mid\\mathbf w_t) &= \\mathcal N(\\mathbf w_{t+1}\\mid\\mathbf w_t,\\mathbf \\Gamma)\n\\end{split}\n\\]",
    "crumbs": [
      "共通概念・表記"
    ]
  },
  {
    "objectID": "common.html#環境",
    "href": "common.html#環境",
    "title": "共通概念・表記",
    "section": "",
    "text": "\\[\n\\begin{split}\np(y_t=1\\mid\\mathbf w_t) &= \\sigma(\\mathbf w_t^T\\mathbf x_t) \\\\\np(\\mathbf w_{t+1}\\mid\\mathbf w_t) &= \\mathcal N(\\mathbf w_{t+1}\\mid\\mathbf w_t,\\mathbf \\Gamma)\n\\end{split}\n\\]",
    "crumbs": [
      "共通概念・表記"
    ]
  },
  {
    "objectID": "common.html#記法",
    "href": "common.html#記法",
    "title": "共通概念・表記",
    "section": "記法",
    "text": "記法\n\\[\n\\begin{split}\np(\\mathbf w_t\\mid\\mathbf Y_t) &= \\mathcal N(\\mathbf w_t\\mid\\hat{\\mathbf w}_{t/t},\\mathbf P_{t/t}) \\\\\np(\\mathbf w_{t+1}\\mid\\mathbf Y_t) &= \\mathcal N(\\mathbf w_{t+1}\\mid\\hat{\\mathbf w}_{t+1/t},\\mathbf P_{t+1/t})\n\\end{split}\n\\]\n\n\\(\\hat{\\mathbf w}_{t/t}\\) : 濾波推定値\n\\(\\hat{\\mathbf w}_{t+1/t}\\) : 一段予測推定値\n\\(\\mathbf P_{t/t}\\), \\(\\mathbf P_{t+1/t}\\) : 推定誤差共分散行列",
    "crumbs": [
      "共通概念・表記"
    ]
  },
  {
    "objectID": "common.html#logistic-sigmoid-func.-と-softmax-func.",
    "href": "common.html#logistic-sigmoid-func.-と-softmax-func.",
    "title": "共通概念・表記",
    "section": "Logistic sigmoid func. と Softmax func.",
    "text": "Logistic sigmoid func. と Softmax func.\nクラスの条件付き確率密度がガウス分布であると仮定する。このとき、共分散行列が各クラスに共有されるとする。\n\\[p(\\mathbf x_t\\mid y_t=\\mathcal C_1)=\\mathcal N(\\mathbf x_t\\mid\\boldsymbol \\mu_{\\mathcal C_1},\\boldsymbol\\Sigma)\\]\nこのとき、決定境界は \\(\\mathbf x_t\\) に対して線形となる。\n共分散行列が各クラスに共有されないとすると、決定境界は２次判別関数となる \\(\\mathbf x_t\\) の２次関数を得る。",
    "crumbs": [
      "共通概念・表記"
    ]
  },
  {
    "objectID": "common.html#状態推定問題",
    "href": "common.html#状態推定問題",
    "title": "共通概念・表記",
    "section": "状態推定問題",
    "text": "状態推定問題\n観測データ \\(\\mathbf Y_t\\) に基づいて、ベイズリスク\n\\[\nJ=\\mathbb E[\\|\\mathbf w_{t+m}-\\hat{\\mathbf w}_{t+m/t}\\|^2],\\ m=0,1\n\\]\nを最小にする最適推定値 \\(\\hat{\\mathbf w}_{t+m/t}\\) は\n\\[\n\\hat{\\mathbf w}_{t+m/t}=\\mathbb E_{\\mathbf w_{t+m}\\mid\\mathbf Y_t}[\\mathbf w_{t+m}]\n\\]\nで与えられる。次式で説明される。\n\\[\\frac{\\partial}{\\partial \\hat{\\mathbf w}_{t+m/t}}J=\\int 2(\\mathbf w_{t+m}-\\hat{\\mathbf w}_{t+m/t})p(\\mathbf w\\mid y)d\\mathbf w=0\\]",
    "crumbs": [
      "共通概念・表記"
    ]
  },
  {
    "objectID": "common.html#logistic-sigmoid-関数",
    "href": "common.html#logistic-sigmoid-関数",
    "title": "共通概念・表記",
    "section": "Logistic Sigmoid 関数",
    "text": "Logistic Sigmoid 関数\n\\[\\sigma(\\mathbf w^T\\mathbf x)=\\frac{1}{1+e^{-\\mathbf w^T\\mathbf x}}\\]\n\\[\\frac{\\partial}{\\partial \\mathbf w}\\sigma(\\mathbf w^T\\mathbf x)=\\sigma(\\mathbf w^T\\mathbf x)\\{1-\\sigma(\\mathbf w^T\\mathbf x)\\}\\mathbf x\\]\n\\[\\frac{\\partial}{\\partial \\mathbf w}\\ln\\sigma(\\mathbf w^T\\mathbf x)=[1-\\sigma(\\mathbf w^T\\mathbf x)]\\mathbf x\\]\n\\[\\frac{\\partial^2}{\\partial \\mathbf w^2}=-\\sigma(\\mathbf w^T\\mathbf x)(1-\\sigma(\\mathbf w^T\\mathbf x))\\mathbf x\\mathbf x^T\\]\n\\[\\frac{\\partial}{\\partial \\mathbf w}\\ln\\{1-\\sigma(\\mathbf w^T\\mathbf x)\\}=-\\sigma(\\mathbf w^T\\mathbf x)\\mathbf x\\]\n\\[\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln\\{1-\\sigma(\\mathbf w^T\\mathbf x)\\}=-\\sigma(\\mathbf w^T\\mathbf x)(1-\\sigma(\\mathbf w^T\\mathbf x))\\mathbf x\\mathbf x^T\\]",
    "crumbs": [
      "共通概念・表記"
    ]
  },
  {
    "objectID": "EKF/summary.html",
    "href": "EKF/summary.html",
    "title": "非線形カルマンフィルタの概要",
    "section": "",
    "text": "区分行列 \\(\\mathbf M\\) を\n\\[\\mathbf M=\\begin{pmatrix}\\mathbf A & \\mathbf B \\\\ \\mathbf C & \\mathbf D  \\end{pmatrix}\\]\nとしたとき、区画 \\(\\mathbf D\\) に関する Schur 補行列とは\n\\[\\mathbf M/\\mathbf D=\\mathbf A-\\mathbf B\\mathbf D^{-1}\\mathbf C\\]\nで与えられる。区画 \\(\\mathbf A\\) に関する Schur 補行列とは\n\\[\\mathbf M/\\mathbf A=\\mathbf D-\\mathbf C\\mathbf A^{-1}\\mathbf B\\]\nで与えられる。\n\n\n\n定理\n区分行列 \\(\\mathbf M\\) を\n\\[\\mathbf M=\\begin{pmatrix}\\mathbf A & \\mathbf B \\\\ \\mathbf C & \\mathbf D  \\end{pmatrix}\\]\nとしたとき、\n\\[\n\\begin{split}\n\\mathbf M^{-1} &=\\begin{pmatrix}\\mathbf A^{-1}+\\mathbf A^{-1}\\mathbf B(\\mathbf M/\\mathbf A)^{-1}\\mathbf C\\mathbf A^{-1} & -\\mathbf A^{-1}\\mathbf B(\\mathbf M/\\mathbf A)^{-1} \\\\ -(\\mathbf M/\\mathbf A)^{-1}\\mathbf C\\mathbf A^{-1} & (\\mathbf M/\\mathbf A)^{-1}\\end{pmatrix} \\\\\n&=\\begin{pmatrix}(\\mathbf M/\\mathbf D)^{-1} & -(\\mathbf M/\\mathbf D)^{-1}\\mathbf B\\mathbf D^{-1} \\\\ -\\mathbf D^{-1}\\mathbf C(\\mathbf M/\\mathbf D)^{-1} & \\mathbf D^{-1}+\\mathbf D^{-1}\\mathbf C(\\mathbf M/\\mathbf D)^{-1}\\mathbf B\\mathbf D^{-1}\\end{pmatrix}\n\\end{split}\n\\]\nが成り立つ。\n\n\n\n定理\n対称な行列 \\(\\mathbf M\\) を\n\\[\\mathbf M=\\begin{pmatrix}\\mathbf A & \\mathbf B \\\\ \\mathbf B^T & \\mathbf C\\end{pmatrix}\\]\nとすると、\n\\[\\text{If}\\ \\mathbf C\\succ 0, \\text{then}\\ (\\mathbf M\\succeq 0\\iff \\mathbf M/\\mathbf C\\succeq 0)\\]\n\\[\\text{If}\\ \\mathbf A\\succ 0, \\text{then}\\ (\\mathbf M\\succeq 0\\iff \\mathbf M/\\mathbf A\\succeq 0)\\]\nが成り立つ。\n定理\n\\(\\mathbb E\\) を任意の期待値： \\(\\mathbb E_{\\mathbf x,\\mathbf y}, \\mathbb E_{\\mathbf x\\mid\\mathbf y}, \\mathbb E_{\\mathbf y\\mid\\mathbf x}\\) であるとする。\n\\[\n\\begin{pmatrix} \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf f(\\mathbf x,\\mathbf y)^T] & \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T] \\\\ \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T]^T & \\mathbb E[\\mathbf g(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T] \\end{pmatrix}\\succeq 0\n\\]\n証明\n\\(\\mathbf h(\\mathbf x,\\mathbf y)\\) を\n\\[\\mathbf h(\\mathbf x,\\mathbf y)=\\begin{pmatrix}\\mathbf f(\\mathbf x,\\mathbf y) \\\\ \\mathbf g(\\mathbf x,\\mathbf y)\\end{pmatrix}\\]\nとすると、任意のベクトル \\(\\mathbf u\\) に対して\n\\[\n\\begin{split}\n&\\phantom{=}\\mathbf u^T\\begin{pmatrix} \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf f(\\mathbf x,\\mathbf y)^T] & \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T] \\\\ \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T]^T & \\mathbb E[\\mathbf g(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T] \\end{pmatrix}\\mathbf u \\\\\n&= \\mathbf u^T\\mathbb E[\\mathbf h(\\mathbf x,\\mathbf y)\\mathbf h(\\mathbf x,\\mathbf y)^T]\\mathbf u \\\\\n&= \\mathbb E[(\\mathbf h(\\mathbf x,\\mathbf y)\\mathbf u)^2] \\\\\n&\\succeq 0\n\\end{split}\n\\]\n定理\n\\(\\mathbb E[\\mathbf g(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T]\\succ 0\\) のとき、\n\\[\\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf f(\\mathbf x,\\mathbf y)^T]\\succeq\\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T]\\mathbb E[\\mathbf g(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T]^{-1}\\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T]^T\\]\nが成り立つ。\n証明\n\\[\\mathbf M=\\begin{pmatrix} \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf f(\\mathbf x,\\mathbf y)^T] & \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T] \\\\ \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T]^T & \\mathbb E[\\mathbf g(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T] \\end{pmatrix}\\]\nとすると、 \\(\\mathbf M\\succeq 0\\) であり、よって \\(\\mathbf M/\\mathbb E[\\mathbf g(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T]\\succeq 0\\) である。\n\n\n\n\\(\\mathbf w\\) を未知変数、 \\(y\\) を観測変数とする。 Fisher 情報行列を\n\\[\n\\begin{split}\nI(\\mathbf w) &=-\\mathbb E_{y\\mid \\mathbf w}\\left[\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(y\\mid\\mathbf w)\\right] \\\\\n&= -\\int\\left(\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(y\\mid\\mathbf w)\\right)p(y\\mid\\mathbf w)dy \\\\\n&\\in\\mathbb R^{n\\times n}\n\\end{split}\n\\]\nとする。各要素は\n\\[\nI_{ij}=-\\mathbb E_{y\\mid\\mathbf w}\\left[\\frac{\\partial^2}{\\partial w_i\\partial w_j}\\ln p(y\\mid\\mathbf w)\\right]\n\\]\nとなる。\n\n\n\n\\[\n\\begin{split}\nI(\\mathbf w) &=-\\mathbb E_{y\\mid \\mathbf w}\\left[\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(y\\mid\\mathbf w)\\right] \\\\\n&= -\\int\\left(\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(y\\mid\\mathbf w)\\right)p(y\\mid\\mathbf w)dy \\\\\n&= -\\int\\left(\\frac{\\partial}{\\partial\\mathbf w}\\left[\\frac{1}{p(y\\mid\\mathbf w)}\\frac{\\partial}{\\partial\\mathbf w}p(y\\mid\\mathbf w)\\right]\\right)p(y\\mid\\mathbf w)dy \\\\\n&= -\\int\\left(-\\left[\\frac{1}{p(y\\mid\\mathbf w)}\\right]^2\\left[\\frac{\\partial}{\\partial\\mathbf w}p(y\\mid\\mathbf w)\\right]\\left[\\frac{\\partial}{\\partial\\mathbf w}p(y\\mid\\mathbf w)\\right]^T+\\frac{1}{p(y\\mid\\mathbf w)}\\frac{\\partial^2}{\\partial\\mathbf w^2}p(y\\mid\\mathbf w)\\right)p(y\\mid\\mathbf w)dy \\\\\n&= \\int\\left(\\frac{1}{p(y\\mid\\mathbf w)}\\frac{\\partial}{\\partial \\mathbf w}p(y\\mid\\mathbf w)\\right)\\left(\\frac{1}{p(y\\mid\\mathbf w)}\\frac{\\partial}{\\partial \\mathbf w}p(y\\mid\\mathbf w)\\right)^Tp(y\\mid\\mathbf w)dy-\\int\\frac{\\partial^2}{\\partial\\mathbf w^2}p(y\\mid\\mathbf w)dy \\\\\n&= \\int\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)^Tp(y\\mid\\mathbf w)dy-\\underbrace{\\frac{\\partial^2}{\\partial\\mathbf w^2}\\int p(y\\mid\\mathbf w)dy}_\\mathbf O \\\\\n&= \\mathbb E_{y\\mid\\mathbf w}\\left[\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)^T\\right]\n\\end{split}\n\\]\nであるから、Fisher 情報行列は\n\\[\nI(\\mathbf w) =-\\mathbb E_{y\\mid \\mathbf w}\\left[\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(y\\mid\\mathbf w)\\right] = \\mathbb E_{y\\mid\\mathbf w}\\left[\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)^T\\right]\n\\]\nと表せる。\n\n\n\n定理\n\\(I(\\mathbf w)\\succ 0\\) のとき、\n\\[\\mathbb E_{y\\mid\\mathbf w}\\left[(\\mathbf w-\\mathbf f(y))(\\mathbf w-\\mathbf f(y))^T\\right]\\succeq I^{-1}(\\mathbf w)\\]\nが成り立つ。ただし、 \\(\\mathbf f(y)\\) は不偏推定値とする。つまり、次式が成り立つとする。\n\\[\\mathbb E_{y\\mid\\mathbf w}[\\mathbf f(y)]=\\mathbf w\\]\n証明\nSchur 補行列の正定値性より、\n\\[\n\\begin{split}\n&\\phantom{=}\\mathbb E_{y\\mid\\mathbf w}\\left[(\\mathbf w-\\mathbf f(y))(\\mathbf w-\\mathbf f(y))^T\\right] \\\\\n&\\succeq \\mathbb E_{y\\mid\\mathbf w}\\left[(\\mathbf w-\\mathbf f(y))\\left(\\frac{\\partial}{\\partial \\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)^T\\right]I^{-1}(\\mathbf w)\\mathbb E_{y\\mid\\mathbf w}\\left[(\\mathbf w-\\mathbf f(y))\\left(\\frac{\\partial}{\\partial \\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)^T\\right]^T\n\\end{split}\n\\]\nここで、\n\\[\n\\begin{split}\n\\mathbb E_{y\\mid\\mathbf w}\\left[(\\mathbf w-\\mathbf f(y))\\left(\\frac{\\partial}{\\partial \\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)^T\\right] &= \\int\\left(\\mathbf w-\\mathbf f(y)\\right)\\left(\\frac{1}{p(y\\mid\\mathbf w)}\\frac{\\partial}{\\partial\\mathbf w}p(y\\mid\\mathbf w)\\right)^Tp(y\\mid\\mathbf w)dy \\\\\n&= \\int \\left(\\mathbf w - \\mathbf f(y)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}p(y\\mid\\mathbf w)\\right)^Tdy \\\\\n&= \\mathbf w\\left( \\frac{\\partial}{\\partial \\mathbf w} \\int p(y\\mid\\mathbf w) dy \\right)^T-\\frac{\\partial}{\\partial \\mathbf w^T}\\int \\mathbf f(y) p(y\\mid\\mathbf w)dy \\\\\n&= \\underbrace{\\mathbf w\\left(\\frac{\\partial}{\\partial \\mathbf w} 1\\right)^T}_\\mathbf O-\\frac{\\partial}{\\partial\\mathbf w^T}\\mathbf w \\\\\n&= -\\mathbf I\n\\end{split}\n\\]\nが成り立つ。 \\(\\mathbf I\\) は単位行列を表す。\n\n\n\n\\(\\mathbf w\\) を未知変数、 \\(y\\) を観測変数とする。 ベイズ情報行列を\n\\[\n\\begin{split}\nJ &=-\\mathbb E_{\\mathbf w, y}\\left[\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(\\mathbf w, y)\\right] \\\\\n&= -\\int\\int\\left(\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(\\mathbf w, y)\\right)p(\\mathbf w, y)dyd\\mathbf w \\\\\n&\\in\\mathbb R^{n\\times n}\n\\end{split}\n\\]\nとする。各要素は\n\\[\nJ_{ij}=-\\mathbb E_{\\mathbf w,y}\\left[\\frac{\\partial^2}{\\partial w_i\\partial w_j}\\ln p(\\mathbf w,y)\\right]\n\\]\nとなる。\n\n\n\n\\[\n\\begin{split}\nJ &=-\\mathbb E_{\\mathbf w,y}\\left[\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(\\mathbf w,y)\\right] \\\\\n&= -\\int\\int\\left(\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(\\mathbf w,y)\\right)p(\\mathbf w,y)d\\mathbf wdy \\\\\n&= -\\int\\int\\left(\\frac{\\partial}{\\partial\\mathbf w}\\left[\\frac{1}{p(\\mathbf w,y)}\\frac{\\partial}{\\partial\\mathbf w}p(\\mathbf w,y)\\right]\\right)p(\\mathbf w,y)d\\mathbf wdy \\\\\n&= -\\int\\int\\left(-\\left[\\frac{1}{p(\\mathbf w,y)}\\right]^2\\left[\\frac{\\partial}{\\partial\\mathbf w}p(\\mathbf w,y)\\right]\\left[\\frac{\\partial}{\\partial\\mathbf w}p(\\mathbf w,y)\\right]^T+\\frac{1}{p(\\mathbf w,y)}\\frac{\\partial^2}{\\partial\\mathbf w^2}p(\\mathbf w,y)\\right)p(\\mathbf w,y)d\\mathbf wdy \\\\\n&= \\int\\int\\left(\\frac{1}{p(\\mathbf w,y)}\\frac{\\partial}{\\partial \\mathbf w}p(\\mathbf w,y)\\right)\\left(\\frac{1}{p(\\mathbf w,y)}\\frac{\\partial}{\\partial \\mathbf w}p(\\mathbf w,y)\\right)^Tp(\\mathbf w,y)d\\mathbf wdy-\\int\\int\\frac{\\partial^2}{\\partial\\mathbf w^2}p(\\mathbf w,y)d\\mathbf wdy \\\\\n&= \\int\\int\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w,y)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w,y)\\right)^Tp(\\mathbf w,y)d\\mathbf wdy-\\underbrace{\\frac{\\partial^2}{\\partial\\mathbf w^2}\\int\\int p(\\mathbf w,y)d\\mathbf wdy}_\\mathbf O \\\\\n&= \\mathbb E_{\\mathbf w,y}\\left[\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w,y)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w,y)\\right)^T\\right]\n\\end{split}\n\\]\nであり、\n\\[\n\\begin{split}\nJ &=-\\mathbb E_{\\mathbf w,y}\\left[\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(\\mathbf w,y)\\right] \\\\\n&= -\\int\\int\\left(\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(\\mathbf w\\mid y)\\right)p(\\mathbf w,y)d\\mathbf wdy -\\underbrace{\\int\\int\\left(\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(y)\\right)p(\\mathbf w,y)d\\mathbf wdy}_\\mathbf O \\\\\n&= \\mathbb E_{\\mathbf w,y}\\left[\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w\\mid y)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w\\mid y)\\right)^T\\right]\n\\end{split}\n\\]\nであるから、ベイズ情報行列は\n\\[\n\\begin{split}\nJ &=-\\mathbb E_{\\mathbf w,y}\\left[\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(\\mathbf w,y)\\right] \\\\\n&= \\mathbb E_{\\mathbf w,y}\\left[\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w,y)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w,y)\\right)^T\\right] \\\\\n&= \\mathbb E_{\\mathbf w,y}\\left[\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w\\mid y)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w\\mid y)\\right)^T\\right]\n\\end{split}\n\\]\nと表せる。\n\n\n\n定理\n\\(J\\succ 0\\) のとき、\n\\[\\mathbb E_{\\mathbf w,y}\\left[(\\mathbf w-\\mathbf f(y))(\\mathbf w-\\mathbf f(y))^T\\right]\\succeq J^{-1}\\]\nが成り立つ。ただし、次式が成り立つとする。\n\\[\\lim_{\\mathbf w_i\\to\\pm\\infty}\\mathbb E_{y\\mid\\mathbf w}[\\mathbf f(y)-\\mathbf w]p(\\mathbf w)=\\lim_{\\mathbf w_i\\to\\pm\\infty}\\int (\\mathbf f(y)-\\mathbf w)p(\\mathbf w,y)dy=\\mathbf 0,\\ i=1,\\ldots,n\\]\n証明\nSchur 補行列の正定値性より、\n\\[\n\\begin{split}\n&\\phantom{=}\\mathbb E_{\\mathbf w,y}\\left[(\\mathbf w-\\mathbf f(y))(\\mathbf w-\\mathbf f(y))^T\\right] \\\\\n&\\succeq \\mathbb E_{\\mathbf w,y}\\left[(\\mathbf w-\\mathbf f(y))\\left(\\frac{\\partial}{\\partial \\mathbf w}\\ln p(\\mathbf w,y)\\right)^T\\right]J^{-1}\\mathbb E_{\\mathbf w,y}\\left[(\\mathbf w-\\mathbf f(y))\\left(\\frac{\\partial}{\\partial \\mathbf w}\\ln p(\\mathbf w,y)\\right)^T\\right]^T\n\\end{split}\n\\]\nここで、\n\\[\n\\begin{split}\n\\mathbb E_{\\mathbf w,y}\\left[(\\mathbf w-\\mathbf f(y))\\left(\\frac{\\partial}{\\partial \\mathbf w}\\ln p(\\mathbf w,y)\\right)^T\\right] &= \\int\\int\\left(\\mathbf w-\\mathbf f(y)\\right)\\left(\\frac{1}{p(\\mathbf w,y)}\\frac{\\partial}{\\partial\\mathbf w}p(\\mathbf w,y)\\right)^Tp(\\mathbf w,y)d\\mathbf wdy \\\\\n&= \\int\\int \\left(\\mathbf w - \\mathbf f(y)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}p(\\mathbf w,y)\\right)^Td\\mathbf wdy\n\\end{split}\n\\]\nが成り立つ。\\(ij\\) 要素に対して部分積分すると、\n\\[\n\\begin{split}\n& \\left\\{\\int\\int \\left(\\mathbf w - \\mathbf f(y)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}p(\\mathbf w,y)\\right)^Td\\mathbf wdy\\right\\}_{ij} \\\\\n&= \\int\\int(w_i-f_i(y))\\left(\\frac{\\partial}{\\partial w_j}p(\\mathbf w,y)\\right)d\\mathbf wdy \\\\\n&= \\int\\int\\left[(w_i-f_i(y))p(\\mathbf w,y)\\right]_{w_j=-\\infty}^{w_j=\\infty}d\\mathbf w_kdy-\\int\\int\\frac{\\partial}{\\partial w_j}(w_i-f_i(y))p(\\mathbf w,y)d\\mathbf wdy \\\\\n&= \\int\\left[\\lim_{w_j\\to\\infty}\\int(w_i-f_i(y))p(\\mathbf w,y)dy-\\lim_{w_j\\to-\\infty}\\int(w_i-f_i(y))p(\\mathbf w,y)dy\\right]d\\mathbf w_k - I_{ij} \\\\\n&= -I_{ij}\n\\end{split}\n\\]\nとなる。\\(\\mathbf w_k\\) は \\(k\\neq j\\) となる全ての \\(k\\) を添字とする \\(w\\) を表す。 \\(I_{ij}\\) とは単位行列 \\(\\mathbf I\\) の \\(ij\\) 要素を表す。\n\n\n\n定理\n\\[\\mathbf w - \\mathbf f(y)=\\begin{pmatrix}\\mathbf w_a-\\mathbf f_a(y) \\\\ \\mathbf w_b-\\mathbf f_b(y)\\end{pmatrix}\\]\nとおくと、ベイズ情報行列は\n\\[J=\\begin{pmatrix}\\mathbf A &\\mathbf B \\\\\\mathbf C &\\mathbf D\\end{pmatrix}\\]\nと表せる。ただし、例えば \\(\\mathbf A\\) は\n\\[\\mathbf A=\\mathbb E_{\\mathbf w_a,y}\\left[\\left(\\frac{\\partial}{\\partial\\mathbf w_a}\\ln p(\\mathbf w_a\\mid y)\\right)\\left(\\frac{\\partial}{\\partial \\mathbf w_a}\\ln p(\\mathbf w_a\\mid y)\\right)^T\\right]\\]\nと表す。このとき、\\(J\\succ 0\\) ならば、次を得る。\n\\[\\mathbb E_{\\mathbf w_b,y}\\left[(\\mathbf w_b-\\mathbf f_b(y))(\\mathbf w_b-\\mathbf f_b(y))^T\\right]\\succeq (J/\\mathbf A)^{-1}\\]\n証明\n次の式において、\\(\\cdot\\) は省略を意味する。\n\\[\\mathbb E_{\\mathbf w,y}\\left[(\\mathbf w-\\mathbf f(y))(\\mathbf w-\\mathbf f(y))^T\\right]=\\begin{pmatrix}\\cdot & \\cdot \\\\ \\cdot & \\mathbb E_{\\mathbf w_b,y}\\left[(\\mathbf w_b-\\mathbf f_b(y))(\\mathbf w_b-\\mathbf f_b(y))^T\\right]\\end{pmatrix}\\]\n\\[J^{-1}=\\begin{pmatrix}\\cdot & \\cdot \\\\ \\cdot & (J/\\mathbf A)^{-1}\\end{pmatrix}\\]\n任意の \\(\\mathbf x\\) について、\n\\[\\mathbf x^T(\\mathbb E_{\\mathbf w,y}\\left[(\\mathbf w-\\mathbf f(y))(\\mathbf w-\\mathbf f(y))^T\\right]-J^{-1})\\mathbf x\\ge 0\\]\nであるから、\n\\[\\mathbf x=\\begin{pmatrix}\\mathbf 0 \\\\ \\mathbf x_b\\end{pmatrix}\\]\nとして、\n\\[\n\\begin{split}\n\\phantom{=}&\\, \\mathbf x^T(\\mathbb E_{\\mathbf w,y}\\left[(\\mathbf w-\\mathbf f(y))(\\mathbf w-\\mathbf f(y))^T\\right]-J^{-1})\\mathbf x \\\\\n=&\\, \\mathbf x_b^T (\\mathbb E_{\\mathbf w_b,y}\\left[(\\mathbf w_b-\\mathbf f_b(y))(\\mathbf w_b-\\mathbf f_b(y))^T\\right]-(J/\\mathbf A)^{-1})\\mathbf x_b \\\\\n\\ge&\\, 0\n\\end{split}\n\\]\nが成り立つ。",
    "crumbs": [
      "非線形カルマンフィルタ",
      "非線形カルマンフィルタの概要"
    ]
  },
  {
    "objectID": "EKF/summary.html#概要",
    "href": "EKF/summary.html#概要",
    "title": "非線形カルマンフィルタの概要",
    "section": "",
    "text": "区分行列 \\(\\mathbf M\\) を\n\\[\\mathbf M=\\begin{pmatrix}\\mathbf A & \\mathbf B \\\\ \\mathbf C & \\mathbf D  \\end{pmatrix}\\]\nとしたとき、区画 \\(\\mathbf D\\) に関する Schur 補行列とは\n\\[\\mathbf M/\\mathbf D=\\mathbf A-\\mathbf B\\mathbf D^{-1}\\mathbf C\\]\nで与えられる。区画 \\(\\mathbf A\\) に関する Schur 補行列とは\n\\[\\mathbf M/\\mathbf A=\\mathbf D-\\mathbf C\\mathbf A^{-1}\\mathbf B\\]\nで与えられる。\n\n\n\n定理\n区分行列 \\(\\mathbf M\\) を\n\\[\\mathbf M=\\begin{pmatrix}\\mathbf A & \\mathbf B \\\\ \\mathbf C & \\mathbf D  \\end{pmatrix}\\]\nとしたとき、\n\\[\n\\begin{split}\n\\mathbf M^{-1} &=\\begin{pmatrix}\\mathbf A^{-1}+\\mathbf A^{-1}\\mathbf B(\\mathbf M/\\mathbf A)^{-1}\\mathbf C\\mathbf A^{-1} & -\\mathbf A^{-1}\\mathbf B(\\mathbf M/\\mathbf A)^{-1} \\\\ -(\\mathbf M/\\mathbf A)^{-1}\\mathbf C\\mathbf A^{-1} & (\\mathbf M/\\mathbf A)^{-1}\\end{pmatrix} \\\\\n&=\\begin{pmatrix}(\\mathbf M/\\mathbf D)^{-1} & -(\\mathbf M/\\mathbf D)^{-1}\\mathbf B\\mathbf D^{-1} \\\\ -\\mathbf D^{-1}\\mathbf C(\\mathbf M/\\mathbf D)^{-1} & \\mathbf D^{-1}+\\mathbf D^{-1}\\mathbf C(\\mathbf M/\\mathbf D)^{-1}\\mathbf B\\mathbf D^{-1}\\end{pmatrix}\n\\end{split}\n\\]\nが成り立つ。\n\n\n\n定理\n対称な行列 \\(\\mathbf M\\) を\n\\[\\mathbf M=\\begin{pmatrix}\\mathbf A & \\mathbf B \\\\ \\mathbf B^T & \\mathbf C\\end{pmatrix}\\]\nとすると、\n\\[\\text{If}\\ \\mathbf C\\succ 0, \\text{then}\\ (\\mathbf M\\succeq 0\\iff \\mathbf M/\\mathbf C\\succeq 0)\\]\n\\[\\text{If}\\ \\mathbf A\\succ 0, \\text{then}\\ (\\mathbf M\\succeq 0\\iff \\mathbf M/\\mathbf A\\succeq 0)\\]\nが成り立つ。\n定理\n\\(\\mathbb E\\) を任意の期待値： \\(\\mathbb E_{\\mathbf x,\\mathbf y}, \\mathbb E_{\\mathbf x\\mid\\mathbf y}, \\mathbb E_{\\mathbf y\\mid\\mathbf x}\\) であるとする。\n\\[\n\\begin{pmatrix} \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf f(\\mathbf x,\\mathbf y)^T] & \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T] \\\\ \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T]^T & \\mathbb E[\\mathbf g(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T] \\end{pmatrix}\\succeq 0\n\\]\n証明\n\\(\\mathbf h(\\mathbf x,\\mathbf y)\\) を\n\\[\\mathbf h(\\mathbf x,\\mathbf y)=\\begin{pmatrix}\\mathbf f(\\mathbf x,\\mathbf y) \\\\ \\mathbf g(\\mathbf x,\\mathbf y)\\end{pmatrix}\\]\nとすると、任意のベクトル \\(\\mathbf u\\) に対して\n\\[\n\\begin{split}\n&\\phantom{=}\\mathbf u^T\\begin{pmatrix} \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf f(\\mathbf x,\\mathbf y)^T] & \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T] \\\\ \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T]^T & \\mathbb E[\\mathbf g(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T] \\end{pmatrix}\\mathbf u \\\\\n&= \\mathbf u^T\\mathbb E[\\mathbf h(\\mathbf x,\\mathbf y)\\mathbf h(\\mathbf x,\\mathbf y)^T]\\mathbf u \\\\\n&= \\mathbb E[(\\mathbf h(\\mathbf x,\\mathbf y)\\mathbf u)^2] \\\\\n&\\succeq 0\n\\end{split}\n\\]\n定理\n\\(\\mathbb E[\\mathbf g(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T]\\succ 0\\) のとき、\n\\[\\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf f(\\mathbf x,\\mathbf y)^T]\\succeq\\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T]\\mathbb E[\\mathbf g(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T]^{-1}\\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T]^T\\]\nが成り立つ。\n証明\n\\[\\mathbf M=\\begin{pmatrix} \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf f(\\mathbf x,\\mathbf y)^T] & \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T] \\\\ \\mathbb E[\\mathbf f(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T]^T & \\mathbb E[\\mathbf g(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T] \\end{pmatrix}\\]\nとすると、 \\(\\mathbf M\\succeq 0\\) であり、よって \\(\\mathbf M/\\mathbb E[\\mathbf g(\\mathbf x,\\mathbf y)\\mathbf g(\\mathbf x,\\mathbf y)^T]\\succeq 0\\) である。\n\n\n\n\\(\\mathbf w\\) を未知変数、 \\(y\\) を観測変数とする。 Fisher 情報行列を\n\\[\n\\begin{split}\nI(\\mathbf w) &=-\\mathbb E_{y\\mid \\mathbf w}\\left[\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(y\\mid\\mathbf w)\\right] \\\\\n&= -\\int\\left(\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(y\\mid\\mathbf w)\\right)p(y\\mid\\mathbf w)dy \\\\\n&\\in\\mathbb R^{n\\times n}\n\\end{split}\n\\]\nとする。各要素は\n\\[\nI_{ij}=-\\mathbb E_{y\\mid\\mathbf w}\\left[\\frac{\\partial^2}{\\partial w_i\\partial w_j}\\ln p(y\\mid\\mathbf w)\\right]\n\\]\nとなる。\n\n\n\n\\[\n\\begin{split}\nI(\\mathbf w) &=-\\mathbb E_{y\\mid \\mathbf w}\\left[\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(y\\mid\\mathbf w)\\right] \\\\\n&= -\\int\\left(\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(y\\mid\\mathbf w)\\right)p(y\\mid\\mathbf w)dy \\\\\n&= -\\int\\left(\\frac{\\partial}{\\partial\\mathbf w}\\left[\\frac{1}{p(y\\mid\\mathbf w)}\\frac{\\partial}{\\partial\\mathbf w}p(y\\mid\\mathbf w)\\right]\\right)p(y\\mid\\mathbf w)dy \\\\\n&= -\\int\\left(-\\left[\\frac{1}{p(y\\mid\\mathbf w)}\\right]^2\\left[\\frac{\\partial}{\\partial\\mathbf w}p(y\\mid\\mathbf w)\\right]\\left[\\frac{\\partial}{\\partial\\mathbf w}p(y\\mid\\mathbf w)\\right]^T+\\frac{1}{p(y\\mid\\mathbf w)}\\frac{\\partial^2}{\\partial\\mathbf w^2}p(y\\mid\\mathbf w)\\right)p(y\\mid\\mathbf w)dy \\\\\n&= \\int\\left(\\frac{1}{p(y\\mid\\mathbf w)}\\frac{\\partial}{\\partial \\mathbf w}p(y\\mid\\mathbf w)\\right)\\left(\\frac{1}{p(y\\mid\\mathbf w)}\\frac{\\partial}{\\partial \\mathbf w}p(y\\mid\\mathbf w)\\right)^Tp(y\\mid\\mathbf w)dy-\\int\\frac{\\partial^2}{\\partial\\mathbf w^2}p(y\\mid\\mathbf w)dy \\\\\n&= \\int\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)^Tp(y\\mid\\mathbf w)dy-\\underbrace{\\frac{\\partial^2}{\\partial\\mathbf w^2}\\int p(y\\mid\\mathbf w)dy}_\\mathbf O \\\\\n&= \\mathbb E_{y\\mid\\mathbf w}\\left[\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)^T\\right]\n\\end{split}\n\\]\nであるから、Fisher 情報行列は\n\\[\nI(\\mathbf w) =-\\mathbb E_{y\\mid \\mathbf w}\\left[\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(y\\mid\\mathbf w)\\right] = \\mathbb E_{y\\mid\\mathbf w}\\left[\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)^T\\right]\n\\]\nと表せる。\n\n\n\n定理\n\\(I(\\mathbf w)\\succ 0\\) のとき、\n\\[\\mathbb E_{y\\mid\\mathbf w}\\left[(\\mathbf w-\\mathbf f(y))(\\mathbf w-\\mathbf f(y))^T\\right]\\succeq I^{-1}(\\mathbf w)\\]\nが成り立つ。ただし、 \\(\\mathbf f(y)\\) は不偏推定値とする。つまり、次式が成り立つとする。\n\\[\\mathbb E_{y\\mid\\mathbf w}[\\mathbf f(y)]=\\mathbf w\\]\n証明\nSchur 補行列の正定値性より、\n\\[\n\\begin{split}\n&\\phantom{=}\\mathbb E_{y\\mid\\mathbf w}\\left[(\\mathbf w-\\mathbf f(y))(\\mathbf w-\\mathbf f(y))^T\\right] \\\\\n&\\succeq \\mathbb E_{y\\mid\\mathbf w}\\left[(\\mathbf w-\\mathbf f(y))\\left(\\frac{\\partial}{\\partial \\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)^T\\right]I^{-1}(\\mathbf w)\\mathbb E_{y\\mid\\mathbf w}\\left[(\\mathbf w-\\mathbf f(y))\\left(\\frac{\\partial}{\\partial \\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)^T\\right]^T\n\\end{split}\n\\]\nここで、\n\\[\n\\begin{split}\n\\mathbb E_{y\\mid\\mathbf w}\\left[(\\mathbf w-\\mathbf f(y))\\left(\\frac{\\partial}{\\partial \\mathbf w}\\ln p(y\\mid\\mathbf w)\\right)^T\\right] &= \\int\\left(\\mathbf w-\\mathbf f(y)\\right)\\left(\\frac{1}{p(y\\mid\\mathbf w)}\\frac{\\partial}{\\partial\\mathbf w}p(y\\mid\\mathbf w)\\right)^Tp(y\\mid\\mathbf w)dy \\\\\n&= \\int \\left(\\mathbf w - \\mathbf f(y)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}p(y\\mid\\mathbf w)\\right)^Tdy \\\\\n&= \\mathbf w\\left( \\frac{\\partial}{\\partial \\mathbf w} \\int p(y\\mid\\mathbf w) dy \\right)^T-\\frac{\\partial}{\\partial \\mathbf w^T}\\int \\mathbf f(y) p(y\\mid\\mathbf w)dy \\\\\n&= \\underbrace{\\mathbf w\\left(\\frac{\\partial}{\\partial \\mathbf w} 1\\right)^T}_\\mathbf O-\\frac{\\partial}{\\partial\\mathbf w^T}\\mathbf w \\\\\n&= -\\mathbf I\n\\end{split}\n\\]\nが成り立つ。 \\(\\mathbf I\\) は単位行列を表す。\n\n\n\n\\(\\mathbf w\\) を未知変数、 \\(y\\) を観測変数とする。 ベイズ情報行列を\n\\[\n\\begin{split}\nJ &=-\\mathbb E_{\\mathbf w, y}\\left[\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(\\mathbf w, y)\\right] \\\\\n&= -\\int\\int\\left(\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(\\mathbf w, y)\\right)p(\\mathbf w, y)dyd\\mathbf w \\\\\n&\\in\\mathbb R^{n\\times n}\n\\end{split}\n\\]\nとする。各要素は\n\\[\nJ_{ij}=-\\mathbb E_{\\mathbf w,y}\\left[\\frac{\\partial^2}{\\partial w_i\\partial w_j}\\ln p(\\mathbf w,y)\\right]\n\\]\nとなる。\n\n\n\n\\[\n\\begin{split}\nJ &=-\\mathbb E_{\\mathbf w,y}\\left[\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(\\mathbf w,y)\\right] \\\\\n&= -\\int\\int\\left(\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(\\mathbf w,y)\\right)p(\\mathbf w,y)d\\mathbf wdy \\\\\n&= -\\int\\int\\left(\\frac{\\partial}{\\partial\\mathbf w}\\left[\\frac{1}{p(\\mathbf w,y)}\\frac{\\partial}{\\partial\\mathbf w}p(\\mathbf w,y)\\right]\\right)p(\\mathbf w,y)d\\mathbf wdy \\\\\n&= -\\int\\int\\left(-\\left[\\frac{1}{p(\\mathbf w,y)}\\right]^2\\left[\\frac{\\partial}{\\partial\\mathbf w}p(\\mathbf w,y)\\right]\\left[\\frac{\\partial}{\\partial\\mathbf w}p(\\mathbf w,y)\\right]^T+\\frac{1}{p(\\mathbf w,y)}\\frac{\\partial^2}{\\partial\\mathbf w^2}p(\\mathbf w,y)\\right)p(\\mathbf w,y)d\\mathbf wdy \\\\\n&= \\int\\int\\left(\\frac{1}{p(\\mathbf w,y)}\\frac{\\partial}{\\partial \\mathbf w}p(\\mathbf w,y)\\right)\\left(\\frac{1}{p(\\mathbf w,y)}\\frac{\\partial}{\\partial \\mathbf w}p(\\mathbf w,y)\\right)^Tp(\\mathbf w,y)d\\mathbf wdy-\\int\\int\\frac{\\partial^2}{\\partial\\mathbf w^2}p(\\mathbf w,y)d\\mathbf wdy \\\\\n&= \\int\\int\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w,y)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w,y)\\right)^Tp(\\mathbf w,y)d\\mathbf wdy-\\underbrace{\\frac{\\partial^2}{\\partial\\mathbf w^2}\\int\\int p(\\mathbf w,y)d\\mathbf wdy}_\\mathbf O \\\\\n&= \\mathbb E_{\\mathbf w,y}\\left[\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w,y)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w,y)\\right)^T\\right]\n\\end{split}\n\\]\nであり、\n\\[\n\\begin{split}\nJ &=-\\mathbb E_{\\mathbf w,y}\\left[\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(\\mathbf w,y)\\right] \\\\\n&= -\\int\\int\\left(\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(\\mathbf w\\mid y)\\right)p(\\mathbf w,y)d\\mathbf wdy -\\underbrace{\\int\\int\\left(\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(y)\\right)p(\\mathbf w,y)d\\mathbf wdy}_\\mathbf O \\\\\n&= \\mathbb E_{\\mathbf w,y}\\left[\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w\\mid y)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w\\mid y)\\right)^T\\right]\n\\end{split}\n\\]\nであるから、ベイズ情報行列は\n\\[\n\\begin{split}\nJ &=-\\mathbb E_{\\mathbf w,y}\\left[\\frac{\\partial^2}{\\partial \\mathbf w^2}\\ln p(\\mathbf w,y)\\right] \\\\\n&= \\mathbb E_{\\mathbf w,y}\\left[\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w,y)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w,y)\\right)^T\\right] \\\\\n&= \\mathbb E_{\\mathbf w,y}\\left[\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w\\mid y)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}\\ln p(\\mathbf w\\mid y)\\right)^T\\right]\n\\end{split}\n\\]\nと表せる。\n\n\n\n定理\n\\(J\\succ 0\\) のとき、\n\\[\\mathbb E_{\\mathbf w,y}\\left[(\\mathbf w-\\mathbf f(y))(\\mathbf w-\\mathbf f(y))^T\\right]\\succeq J^{-1}\\]\nが成り立つ。ただし、次式が成り立つとする。\n\\[\\lim_{\\mathbf w_i\\to\\pm\\infty}\\mathbb E_{y\\mid\\mathbf w}[\\mathbf f(y)-\\mathbf w]p(\\mathbf w)=\\lim_{\\mathbf w_i\\to\\pm\\infty}\\int (\\mathbf f(y)-\\mathbf w)p(\\mathbf w,y)dy=\\mathbf 0,\\ i=1,\\ldots,n\\]\n証明\nSchur 補行列の正定値性より、\n\\[\n\\begin{split}\n&\\phantom{=}\\mathbb E_{\\mathbf w,y}\\left[(\\mathbf w-\\mathbf f(y))(\\mathbf w-\\mathbf f(y))^T\\right] \\\\\n&\\succeq \\mathbb E_{\\mathbf w,y}\\left[(\\mathbf w-\\mathbf f(y))\\left(\\frac{\\partial}{\\partial \\mathbf w}\\ln p(\\mathbf w,y)\\right)^T\\right]J^{-1}\\mathbb E_{\\mathbf w,y}\\left[(\\mathbf w-\\mathbf f(y))\\left(\\frac{\\partial}{\\partial \\mathbf w}\\ln p(\\mathbf w,y)\\right)^T\\right]^T\n\\end{split}\n\\]\nここで、\n\\[\n\\begin{split}\n\\mathbb E_{\\mathbf w,y}\\left[(\\mathbf w-\\mathbf f(y))\\left(\\frac{\\partial}{\\partial \\mathbf w}\\ln p(\\mathbf w,y)\\right)^T\\right] &= \\int\\int\\left(\\mathbf w-\\mathbf f(y)\\right)\\left(\\frac{1}{p(\\mathbf w,y)}\\frac{\\partial}{\\partial\\mathbf w}p(\\mathbf w,y)\\right)^Tp(\\mathbf w,y)d\\mathbf wdy \\\\\n&= \\int\\int \\left(\\mathbf w - \\mathbf f(y)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}p(\\mathbf w,y)\\right)^Td\\mathbf wdy\n\\end{split}\n\\]\nが成り立つ。\\(ij\\) 要素に対して部分積分すると、\n\\[\n\\begin{split}\n& \\left\\{\\int\\int \\left(\\mathbf w - \\mathbf f(y)\\right)\\left(\\frac{\\partial}{\\partial\\mathbf w}p(\\mathbf w,y)\\right)^Td\\mathbf wdy\\right\\}_{ij} \\\\\n&= \\int\\int(w_i-f_i(y))\\left(\\frac{\\partial}{\\partial w_j}p(\\mathbf w,y)\\right)d\\mathbf wdy \\\\\n&= \\int\\int\\left[(w_i-f_i(y))p(\\mathbf w,y)\\right]_{w_j=-\\infty}^{w_j=\\infty}d\\mathbf w_kdy-\\int\\int\\frac{\\partial}{\\partial w_j}(w_i-f_i(y))p(\\mathbf w,y)d\\mathbf wdy \\\\\n&= \\int\\left[\\lim_{w_j\\to\\infty}\\int(w_i-f_i(y))p(\\mathbf w,y)dy-\\lim_{w_j\\to-\\infty}\\int(w_i-f_i(y))p(\\mathbf w,y)dy\\right]d\\mathbf w_k - I_{ij} \\\\\n&= -I_{ij}\n\\end{split}\n\\]\nとなる。\\(\\mathbf w_k\\) は \\(k\\neq j\\) となる全ての \\(k\\) を添字とする \\(w\\) を表す。 \\(I_{ij}\\) とは単位行列 \\(\\mathbf I\\) の \\(ij\\) 要素を表す。\n\n\n\n定理\n\\[\\mathbf w - \\mathbf f(y)=\\begin{pmatrix}\\mathbf w_a-\\mathbf f_a(y) \\\\ \\mathbf w_b-\\mathbf f_b(y)\\end{pmatrix}\\]\nとおくと、ベイズ情報行列は\n\\[J=\\begin{pmatrix}\\mathbf A &\\mathbf B \\\\\\mathbf C &\\mathbf D\\end{pmatrix}\\]\nと表せる。ただし、例えば \\(\\mathbf A\\) は\n\\[\\mathbf A=\\mathbb E_{\\mathbf w_a,y}\\left[\\left(\\frac{\\partial}{\\partial\\mathbf w_a}\\ln p(\\mathbf w_a\\mid y)\\right)\\left(\\frac{\\partial}{\\partial \\mathbf w_a}\\ln p(\\mathbf w_a\\mid y)\\right)^T\\right]\\]\nと表す。このとき、\\(J\\succ 0\\) ならば、次を得る。\n\\[\\mathbb E_{\\mathbf w_b,y}\\left[(\\mathbf w_b-\\mathbf f_b(y))(\\mathbf w_b-\\mathbf f_b(y))^T\\right]\\succeq (J/\\mathbf A)^{-1}\\]\n証明\n次の式において、\\(\\cdot\\) は省略を意味する。\n\\[\\mathbb E_{\\mathbf w,y}\\left[(\\mathbf w-\\mathbf f(y))(\\mathbf w-\\mathbf f(y))^T\\right]=\\begin{pmatrix}\\cdot & \\cdot \\\\ \\cdot & \\mathbb E_{\\mathbf w_b,y}\\left[(\\mathbf w_b-\\mathbf f_b(y))(\\mathbf w_b-\\mathbf f_b(y))^T\\right]\\end{pmatrix}\\]\n\\[J^{-1}=\\begin{pmatrix}\\cdot & \\cdot \\\\ \\cdot & (J/\\mathbf A)^{-1}\\end{pmatrix}\\]\n任意の \\(\\mathbf x\\) について、\n\\[\\mathbf x^T(\\mathbb E_{\\mathbf w,y}\\left[(\\mathbf w-\\mathbf f(y))(\\mathbf w-\\mathbf f(y))^T\\right]-J^{-1})\\mathbf x\\ge 0\\]\nであるから、\n\\[\\mathbf x=\\begin{pmatrix}\\mathbf 0 \\\\ \\mathbf x_b\\end{pmatrix}\\]\nとして、\n\\[\n\\begin{split}\n\\phantom{=}&\\, \\mathbf x^T(\\mathbb E_{\\mathbf w,y}\\left[(\\mathbf w-\\mathbf f(y))(\\mathbf w-\\mathbf f(y))^T\\right]-J^{-1})\\mathbf x \\\\\n=&\\, \\mathbf x_b^T (\\mathbb E_{\\mathbf w_b,y}\\left[(\\mathbf w_b-\\mathbf f_b(y))(\\mathbf w_b-\\mathbf f_b(y))^T\\right]-(J/\\mathbf A)^{-1})\\mathbf x_b \\\\\n\\ge&\\, 0\n\\end{split}\n\\]\nが成り立つ。",
    "crumbs": [
      "非線形カルマンフィルタ",
      "非線形カルマンフィルタの概要"
    ]
  },
  {
    "objectID": "EKF/ekf.html",
    "href": "EKF/ekf.html",
    "title": "Extended Kalman Filter",
    "section": "",
    "text": "濾波推定値 \\(\\hat{\\mathbf w}_{t/t}\\) \\[\\hat{\\mathbf w}_{t/t}=\\hat{\\mathbf w}_{t/t-1}+\\frac{1}{1+\\sigma_t(1-\\sigma_t)\\mathbf x_t^T\\mathbf P_{t/t-1}\\mathbf x_t}\\mathbf P_{t/t-1}\\mathbf x_t(y_t-\\sigma_t)\\]\n推定誤差共分散行列 \\(\\mathbf P_{t/t}\\) \\[\\sigma_t=\\sigma(\\hat{\\mathbf w}_{t/t-1}^T\\mathbf x_t)\\] \\[\\mathbf P_{t/t}=\\mathbf P_{t/t-1}-\\frac{\\sigma_t(1-\\sigma_t)}{1+\\sigma_t(1-\\sigma_t)\\mathbf x_t^T\\mathbf P_{t/t-1}\\mathbf x_t}(\\mathbf P_{t/t-1}\\mathbf x_t)(\\mathbf P_{t/t-1}\\mathbf x_t)^T\\]\n各変数の情報の利用\n\n\n\n\n\n\n\n\n\n\n\n\n\\(\\!\\)\n\\(\\mathbf P_{t/t}\\)\n\\(\\hat{\\mathbf w}_{t/t}\\)\n\\(\\mathbf P_{t/t-1}\\)\n\\(\\hat{\\mathbf w}_{t/t-1}\\)\n\\(\\mathbf x_t\\)\n\\(y_t\\)\n\n\n\n\n\\(\\mathbf P_{t/t}\\)\n\\(\\!\\)\n\\(\\!\\)\n\\(\\bigcirc\\)\n\\(\\bigcirc\\)\n\\(\\bigcirc\\)\n\\(\\!\\)\n\n\n\\(\\hat{\\mathbf w}_{t/t}\\)\n\\(\\!\\)\n\\(\\!\\)\n\\(\\bigcirc\\)\n\\(\\bigcirc\\)\n\\(\\bigcirc\\)\n\\(\\bigcirc\\)",
    "crumbs": [
      "非線形カルマンフィルタ",
      "Extended Kalman Filter"
    ]
  },
  {
    "objectID": "EKF/ekf.html#概要",
    "href": "EKF/ekf.html#概要",
    "title": "Extended Kalman Filter",
    "section": "",
    "text": "濾波推定値 \\(\\hat{\\mathbf w}_{t/t}\\) \\[\\hat{\\mathbf w}_{t/t}=\\hat{\\mathbf w}_{t/t-1}+\\frac{1}{1+\\sigma_t(1-\\sigma_t)\\mathbf x_t^T\\mathbf P_{t/t-1}\\mathbf x_t}\\mathbf P_{t/t-1}\\mathbf x_t(y_t-\\sigma_t)\\]\n推定誤差共分散行列 \\(\\mathbf P_{t/t}\\) \\[\\sigma_t=\\sigma(\\hat{\\mathbf w}_{t/t-1}^T\\mathbf x_t)\\] \\[\\mathbf P_{t/t}=\\mathbf P_{t/t-1}-\\frac{\\sigma_t(1-\\sigma_t)}{1+\\sigma_t(1-\\sigma_t)\\mathbf x_t^T\\mathbf P_{t/t-1}\\mathbf x_t}(\\mathbf P_{t/t-1}\\mathbf x_t)(\\mathbf P_{t/t-1}\\mathbf x_t)^T\\]\n各変数の情報の利用\n\n\n\n\n\n\n\n\n\n\n\n\n\\(\\!\\)\n\\(\\mathbf P_{t/t}\\)\n\\(\\hat{\\mathbf w}_{t/t}\\)\n\\(\\mathbf P_{t/t-1}\\)\n\\(\\hat{\\mathbf w}_{t/t-1}\\)\n\\(\\mathbf x_t\\)\n\\(y_t\\)\n\n\n\n\n\\(\\mathbf P_{t/t}\\)\n\\(\\!\\)\n\\(\\!\\)\n\\(\\bigcirc\\)\n\\(\\bigcirc\\)\n\\(\\bigcirc\\)\n\\(\\!\\)\n\n\n\\(\\hat{\\mathbf w}_{t/t}\\)\n\\(\\!\\)\n\\(\\!\\)\n\\(\\bigcirc\\)\n\\(\\bigcirc\\)\n\\(\\bigcirc\\)\n\\(\\bigcirc\\)",
    "crumbs": [
      "非線形カルマンフィルタ",
      "Extended Kalman Filter"
    ]
  },
  {
    "objectID": "EKF/ekf.html#ラプラス近似による導出",
    "href": "EKF/ekf.html#ラプラス近似による導出",
    "title": "Extended Kalman Filter",
    "section": "ラプラス近似による導出",
    "text": "ラプラス近似による導出\n\n1. \\(p(\\mathbf w_t\\mid\\mathbf Y_t)\\)\n\\[\np(\\mathbf w_t\\mid \\mathbf Y_t)=\\frac{p(y_t\\mid\\mathbf w_t)p(\\mathbf w_t\\mid\\mathbf Y_{t-1})}{p(y_t\\mid\\mathbf Y_{t-1})}\n\\]\n\\[p(\\mathbf w_t\\mid\\mathbf Y_{t-1})=\\mathcal N(\\mathbf w_t\\mid\\hat{\\mathbf w}_{t/t-1},\\mathbf P_{t/t-1})\\]\nよって、\n\\[\n\\begin{equation*}\np(\\mathbf w_t\\mid \\mathbf Y_t)=\n\\begin{cases}\n\\sigma(\\mathbf w_t^T\\mathbf x_t)\\mathcal N(\\mathbf w_t\\mid\\hat{\\mathbf w}_{t/t-1},\\mathbf P_{t/t-1}) &( y_t=1) \\\\\n\\{1-\\sigma(\\mathbf w_t^T\\mathbf x_t)\\}\\mathcal N(\\mathbf w_t\\mid\\hat{\\mathbf w}_{t/t-1},\\mathbf P_{t/t-1}) & (y_t=0)\n\\end{cases}\n\\end{equation*}\n\\]\n\n\n2. \\(\\hat{\\mathbf w}_{t/t}\\)\n\\(\\mathbf w_{t}\\) をMAP推定する。 \\(\\ln p(\\mathbf w_t\\mid\\mathbf Y_t)\\) の微分を \\(\\mathbf 0\\) と置く。\n\\[\n\\begin{split}\n&\\phantom{=}\\frac{\\partial}{\\partial \\mathbf w_t}\\ln p(\\mathbf w_t\\mid\\mathbf Y_t) \\\\\n&= \\frac{\\partial}{\\partial \\mathbf w_t}\\ln\\left[\\sigma(\\mathbf w_t^T\\mathbf x_t)^{y_t}\\{1-\\sigma(\\mathbf w_t^T\\mathbf x_t)\\}^{1-y_t}\\mathcal N(\\mathbf w_t\\mid\\hat{\\mathbf w}_{t/t-1},\\mathbf P_{t/t-1})\\right] \\\\\n&= \\frac{\\partial}{\\partial \\mathbf w_t}y_t\\ln\\sigma(\\mathbf w_t^T\\mathbf x_t)+\\frac{\\partial}{\\partial\\mathbf w_t}(1-y_t)\\ln\\{1-\\sigma(\\mathbf w_t^T\\mathbf x_t)\\} \\\\\n&\\phantom{=} +\\frac{\\partial}{\\partial\\mathbf w_t}\\ln\\mathcal N(\\mathbf w_t\\mid\\hat{\\mathbf w}_{t/t-1},\\mathbf P_{t/t-1}) \\\\\n&= \\left\\{y_t-\\sigma(\\mathbf w_t^T\\mathbf x_t)\\right\\}\\mathbf x_t-\\mathbf P_{t/t-1}^{-1}(\\mathbf w_t-\\hat{\\mathbf w}_{t/t-1})\n\\end{split}\n\\]\nここで、\\(\\sigma(\\mathbf w_t^T\\mathbf x_t)\\) をテイラー展開で一次近似する。\n\\(\\sigma_t=\\sigma(\\hat{\\mathbf w}_{t/t-1}^T\\mathbf x_t)\\) とする。\n\\[\n\\begin{split}\n\\sigma(\\mathbf w_t^T\\mathbf x_t) &\\simeq \\sigma_t+\\left.\\frac{\\partial\\sigma(\\mathbf w_t^T\\mathbf x_t)}{\\partial \\mathbf w_t}\\right|_{\\mathbf w_t=\\hat{\\mathbf w}_{t/t-1}}(\\mathbf w_t-\\hat{\\mathbf w}_{t/t-1}) \\\\\n&\\phantom{00}=\\sigma_t+\\sigma_t\\{1-\\sigma_t\\}(\\mathbf w_t-\\hat{\\mathbf w}_{t/t-1})^T\\mathbf x_t\n\\end{split}\n\\]\n\\(\\sigma(\\mathbf w_t^T\\mathbf x_t)\\) を \\(\\sigma_t\\) に置き換え、\\(\\mathbf 0\\) とおく。\n\\[\n\\begin{split}\n&\\phantom{=}\\frac{\\partial}{\\partial \\mathbf w_t}\\ln p(\\mathbf w_t\\mid\\mathbf Y_t) \\\\\n&=\\left[ y_t-\\sigma_t-\\sigma_t\\left\\{1-\\sigma_t\\right\\}(\\mathbf w_t-\\hat{\\mathbf w}_{t/t-1})^T\\mathbf x_t \\right]\\mathbf x_t-\\mathbf P_{t/t-1}^{-1}(\\mathbf w_t-\\hat{\\mathbf w}_{t/t-1}) \\\\\n&=(y_t-\\sigma_t)\\mathbf x_t-\\left[\\mathbf P_{t/t-1}^{-1}+\\sigma_t(1-\\sigma_t)\\mathbf x_t\\mathbf x_t^T\\right](\\mathbf w_t-\\hat{\\mathbf w}_{t/t-1}) \\\\\n&=\\mathbf 0\n\\end{split}\n\\]\n\\[\n\\begin{split}\n\\mathbf w_t &= \\hat{\\mathbf w}_{t/t-1}+\\left[\\mathbf P_{t/t-1}^{-1}+\\sigma_t\\left\\{1-\\sigma_t\\right\\}\\mathbf x_t\\mathbf x_t^T\\right]^{-1}\\mathbf x_t(y_t-\\sigma_t) \\\\\n&=\\hat{\\mathbf w}_{t/t-1}+\\left[\\mathbf P_{t/t-1}-\\frac{\\sigma_t(1-\\sigma_t)\\mathbf P_{t/t-1}\\mathbf x_t\\mathbf x_t^T\\mathbf P_{t/t-1}}{1+\\sigma_t(1-\\sigma_t)\\mathbf x_t^T\\mathbf P_{t/t-1}\\mathbf x_t}\\right]\\mathbf x_t(y_t-\\sigma_t) \\\\\n&=\\hat{\\mathbf w}_{t/t-1}+\\left[\\mathbf P_{t/t-1}\\mathbf x_t-\\frac{\\sigma_t(1-\\sigma_t)\\mathbf P_{t/t-1}\\mathbf x_t\\mathbf x_t^T\\mathbf P_{t/t-1}\\mathbf x_t}{1+\\sigma_t(1-\\sigma_t)\\mathbf x_t^T\\mathbf P_{t/t-1}\\mathbf x_t}\\right](y_t-\\sigma_t) \\\\\n&=\\hat{\\mathbf w}_{t/t-1}+\\left[1-\\frac{\\sigma_t(1-\\sigma_t)\\mathbf x_t^T\\mathbf P_{t/t-1}\\mathbf x_t}{1+\\sigma_t(1-\\sigma_t)\\mathbf x_t^T\\mathbf P_{t/t-1}\\mathbf x_t}\\right]\\mathbf P_{t/t-1}\\mathbf x_t(y_t-\\sigma_t) \\\\\n&=\\hat{\\mathbf w}_{t/t-1}+\\frac{1}{1+\\sigma_t(1-\\sigma_t)\\mathbf x_t^T\\mathbf P_{t/t-1}\\mathbf x_t}\\mathbf P_{t/t-1}\\mathbf x_t(y_t-\\sigma_t)\n\\end{split}\n\\]\nよって \\(\\mathbf w_t\\) のMAP推定値 \\(\\hat{\\mathbf w}_{t/t}\\) は\n\\[\\hat{\\mathbf w}_{t/t}=\\hat{\\mathbf w}_{t/t-1}+\\frac{1}{1+\\sigma_t(1-\\sigma_t)\\mathbf x_t^T\\mathbf P_{t/t-1}\\mathbf x_t}\\mathbf P_{t/t-1}\\mathbf x_t(y_t-\\sigma_t)\\]\nとなる。\n\n\n3. \\(\\mathbf P_{t/t}\\)\n\\(\\hat{\\mathbf w}_{t/t-1}\\) を \\(p(\\mathbf w_t\\mid\\mathbf Y_t)\\) のピークとすると \\(\\mathbf P_{t/t}\\) が得られる。\n（ \\(\\hat{\\mathbf w}_{t/t}\\) をピークとするのが本来のラプラス近似）\n\\[\n\\begin{split}\n\\mathbf P_{t/t}^{-1} &= \\left.-\\frac{\\partial^2}{\\partial\\mathbf w_t^2} \\ln p(\\mathbf w_t\\mid\\mathbf Y_t)\\right|_{\\mathbf w_t=\\hat{\\mathbf w}_{t/t-1}} \\\\\n&= \\left. -\\frac{\\partial}{\\partial\\mathbf w_t}\\left[\\left\\{y_t-\\sigma(\\mathbf w_t^T\\mathbf x_t)\\right\\}\\mathbf x_t-\\mathbf P_{t/t-1}^{-1}(\\mathbf w_t-\\hat{\\mathbf w}_{t/t-1})\\right]\\right|_{\\mathbf w_t=\\hat{\\mathbf w}_{t/t-1}} \\\\\n&= \\mathbf P_{t/t-1}^{-1}+\\sigma_t(1-\\sigma_t)\\mathbf x_t\\mathbf x_t^T\n\\end{split}\n\\]\nSherman-Morrison の公式によって、 \\(\\mathbf P_{t/t}\\) が得られる。\n\\[\n\\mathbf P_{t/t}=\\mathbf P_{t/t-1}-\\frac{\\sigma_t(1-\\sigma_t)}{1+\\sigma_t(1-\\sigma_t)\\mathbf x_t^T\\mathbf P_{t/t-1}\\mathbf x_t}(\\mathbf P_{t/t-1}\\mathbf x_t)(\\mathbf P_{t/t-1}\\mathbf x_t)^T\n\\]",
    "crumbs": [
      "非線形カルマンフィルタ",
      "Extended Kalman Filter"
    ]
  },
  {
    "objectID": "EKF/ekf.html#関数等",
    "href": "EKF/ekf.html#関数等",
    "title": "Extended Kalman Filter",
    "section": "関数等",
    "text": "関数等\n\nsource\n\nPtt\n\n Ptt (Ptm:jaxtyping.Float[Array,'NN'], w:jaxtyping.Float[Array,'N'],\n      x:jaxtyping.Float[Array,'N'])\n\n\\(\\!\\) 推定誤差共分散行列 \\(\\mathbf P_{t/t}\\) \\[\\sigma_t=\\sigma(\\hat{\\mathbf w}_{t/t-1}^T\\mathbf x_t)\\] \\[\\mathbf P_{t/t}=\\mathbf P_{t/t-1}-\\frac{\\sigma_t(1-\\sigma_t)}{1+\\sigma_t(1-\\sigma_t)\\mathbf x_t^T\\mathbf P_{t/t-1}\\mathbf x_t}(\\mathbf P_{t/t-1}\\mathbf x_t)(\\mathbf P_{t/t-1}\\mathbf x_t)^T\\] \\(\\!\\)\n\n\n\n\nType\nDetails\n\n\n\n\nPtm\nFloat[Array, ‘N N’]\n\\(\\mathbf P_{t/t-1}\\)\n\n\nw\nFloat[Array, ‘N’]\n\\(\\hat{\\mathbf w}_{t/t-1}\\)\n\n\nx\nFloat[Array, ‘N’]\n\\(\\mathbf x_t\\)\n\n\nReturns\nFloat[Array, ‘N N’]\n\\(\\mathbf P_{t/t}\\)\n\n\n\n\nsource\n\n\nwtt\n\n wtt (Ptm:jaxtyping.Float[Array,'NN'], w:jaxtyping.Float[Array,'N'],\n      x:jaxtyping.Float[Array,'N'], y:jaxtyping.Float[Array,'N'])\n\n\\(\\!\\) 濾波推定値 \\(\\hat{\\mathbf w}_{t/t}\\) \\[\\hat{\\mathbf w}_{t/t}=\\hat{\\mathbf w}_{t/t-1}+\\frac{1}{1+\\sigma_t(1-\\sigma_t)\\mathbf x_t^T\\mathbf P_{t/t-1}\\mathbf x_t}\\mathbf P_{t/t-1}\\mathbf x_t(y_t-\\sigma_t)\\] \\(\\!\\)\n\n\n\n\nType\nDetails\n\n\n\n\nPtm\nFloat[Array, ‘N N’]\n\\(\\mathbf P_{t/t-1}\\)\n\n\nw\nFloat[Array, ‘N’]\n\\(\\hat{\\mathbf w}_{t/t-1}\\)\n\n\nx\nFloat[Array, ‘N’]\n\\(\\mathbf x_t\\)\n\n\ny\nFloat[Array, ‘N’]\n\\(y_t\\)\n\n\nReturns\nFloat[Array, ‘N’]\n\\(\\hat{\\mathbf w}_{t/t}\\)\n\n\n\n\nsource\n\n\nEKF_out\n\n EKF_out (W:jaxtyping.Float[Array,'TN'], P:jaxtyping.Float[Array,'TNN'])\n\n\\(\\!\\) EKF 関数の返り値\n\n\n\n\n\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nW\nFloat[Array, ‘T N’]\n\\(\\{\\hat{\\mathbf w}_{t/t}\\}_{t=0,\\ldots,T-1}\\)\n\n\nP\nFloat[Array, ‘T N N’]\n\\(\\{\\mathbf P_{t/t}\\}_{t=0,\\ldots,T-1}\\)\n\n\n\n\\(\\!\\)\n\nsource\n\n\nEKF\n\n EKF (N:int, T:int, x:jaxtyping.Float[Array,'{T}{N}'],\n      y:jaxtyping.Float[Array,'{T}{N}'],\n      G:jaxtyping.Float[Array,'{N}{N}'], w0:jaxtyping.Float[Array,'{N}'],\n      P0:jaxtyping.Float[Array,'{N}{N}'])\n\n\\(\\!\\) 拡張カルマンフィルタ \\(\\!\\)\n\n\n\n\nType\nDetails\n\n\n\n\nN\nint\n\\(N\\)\n\n\nT\nint\n\\(T\\)\n\n\nx\nFloat[Array, ‘{T} {N}’]\n\\(\\{ \\mathbf x_t \\}_{t=0,\\ldots,T-1}\\)\n\n\ny\nFloat[Array, ‘{T} {N}’]\n\\(\\{ y_t \\}_{t=0,\\ldots,T-1}\\)\n\n\nG\nFloat[Array, ‘{N} {N}’]\n\\(\\boldsymbol\\Gamma\\)\n\n\nw0\nFloat[Array, ‘{N}’]\n\\(\\hat{\\mathbf w}_{0/-1}\\)\n\n\nP0\nFloat[Array, ‘{N} {N}’]\n\\(\\mathbf P_{0/-1}\\)\n\n\nReturns\nEKF_out",
    "crumbs": [
      "非線形カルマンフィルタ",
      "Extended Kalman Filter"
    ]
  },
  {
    "objectID": "AnalysisStorage/index.html",
    "href": "AnalysisStorage/index.html",
    "title": "分析データ",
    "section": "",
    "text": "分析データの全て。\n\n\n\n\n\n\n\n\n\n\nTitle\n\n\n\nDescription\n\n\n\n\n\n\n\n\n分析00\n\n\n00_Gen によって生成されたデータに対して各種モデルを適用する\n\n\n\n\n\n\n分析01\n\n\n実データ 01_Data/ に対して適用する\n\n\n\n\n\n\nNo matching items",
    "crumbs": [
      "分析データ"
    ]
  },
  {
    "objectID": "Exp/exp.html",
    "href": "Exp/exp.html",
    "title": "実験",
    "section": "",
    "text": "N=2\nG = 1/2**9 * jnp.identity(N, dtype=jnp.float32)\nSigma = 10* jnp.identity(N, dtype=jnp.float32)\nw0 = 0*jnp.ones((N,), dtype=jnp.float32)\npropy1 = 0.5\n\nX, Y, W, \\\n  (Wtt_EKF, Ptt_EKF), \\\n    (Wtt_VA, Ptt_VA, Xit_VA), \\\n      (Wtt_EM, Ptt_EM, Xit_EM) \\\n        = exper(\n  key=jrd.PRNGKey(422), # 822 522\n  N=N, \n  T=500, \n  G=G,\n  w0=w0,\n  Sigma=Sigma,\n  P0=G,\n  propy1=propy1)\n\n\nplt.plot(W[:,0], label=r\"$(w_0)_t$\")\nplt.plot(W[:,1], label=r\"$(w_1)_t$\")\nplt.legend()\n\n\n\n\n\n\n\n\n\nplt.scatter(X[Y==1][100:300,0], X[Y==1][100:300,1], label=r\"$\\mathbf{x}_t\\ (y_t=1)$\")\nplt.scatter(X[Y==0][100:300,0], X[Y==0][100:300,1], label=r\"$\\mathbf{x}_t\\ (y_t=0)$\")\nplt.legend()\n\n\n\n\n\n\n\n\n\nplt.plot(W[:,0], label=r\"$(w_0)_t$ (True Weights)\")\nplt.plot(Wtt_EKF[:,0], \"-\", label=r\"$(\\hat{w}_0)_t$, (DLR)\")\nplt.plot(Wtt_VA[:,0], \"--\", label=r\"$(\\hat{w}_0)_t$, (FU)\")\nplt.plot(Wtt_EM[:,0], \":\", label=r\"$(\\hat{w}_0)_t$, (FP)\")\nplt.xlabel(\"time\")\nplt.ylabel(\"weights\")\nplt.legend()\n\n\n\n\n\n\n\n\n\nplt.plot(W[:,1], label=r\"$(w_1)_t$\")\nplt.plot(Wtt_EKF[:,1], label=r\"$(\\hat{w}_1)_t$, (EKF)\")\nplt.plot(Wtt_VA[:,1], label=r\"$(\\hat{w}_1)_t$, (VA)\")\nplt.plot(Wtt_EM[:,1], label=r\"$(\\hat{w}_1)_t$, (EM)\")\nplt.legend()\n\n\n\n\n\n\n\n\n\nplt.plot(Ptt_EKF[:,0,0], label=r\"$(P_{1,1})_t$, (EKF)\")\nplt.plot(Ptt_VA[:,0,0], label=r\"$(P_{1,1})_t$, (VA)\")\nplt.plot(Ptt_EM[:,0,0], label=r\"$(P_{1,1})_t$, (EM)\")\nplt.legend()\n\n\n\n\n\n\n\n\n\nplt.plot(Ptt_EKF[:,1,1], label=r\"$(P_{2,2})_t$, (EKF)\")\nplt.plot(Ptt_VA[:,1,1], label=r\"$(P_{2,2})_t$, (VA)\")\nplt.plot(Ptt_EM[:,1,1], label=r\"$(P_{2,2})_t$, (EM)\")\nplt.legend()\n\n\n\n\n\n\n\n\n\nplt.plot(simple.losi(jnp.sum(W*X, axis=1)), 'o', label=r\"$(w_0)_t$\")\nplt.plot(simple.losi(jnp.sum(Wtt_EKF*X, axis=1)), 'o', label=r\"$(\\hat{w}_0)_t$, (EKF)\")\nplt.plot(simple.losi(jnp.sum(Wtt_VA*X, axis=1)), 'o', label=r\"$(\\hat{w}_0)_t$, (VA)\")\nplt.plot(simple.losi(jnp.sum(Wtt_EM*X, axis=1)), 'o', label=r\"$(\\hat{w}_0)_t$, (EM)\")\nplt.legend()\n\n\n\n\n\n\n\n\n\ntrue_line = simple.losi(jnp.sum(W*X, axis=1))\nplt.plot(simple.losi(jnp.sum(Wtt_EKF*X, axis=1)) - true_line, label=r\"$(\\hat{w}_0)_t$, (EKF)\")\nplt.plot(simple.losi(jnp.sum(Wtt_VA*X, axis=1)) - true_line, label=r\"$(\\hat{w}_0)_t$, (VA)\")\nplt.plot(simple.losi(jnp.sum(Wtt_EM*X, axis=1)) - true_line, label=r\"$(\\hat{w}_0)_t$, (EM)\")\nplt.legend()\n\n\n\n\n\n\n\n\n\nprint(jnp.sum((simple.losi(jnp.sum(Wtt_EKF*X, axis=1)) - true_line)**2))\nprint(jnp.sum((simple.losi(jnp.sum(Wtt_VA*X, axis=1)) - true_line)**2))\nprint(jnp.sum((simple.losi(jnp.sum(Wtt_EM*X, axis=1)) - true_line)**2))\n\n7.2249694\n7.6888556\n7.6575623\n\n\n\nimport pandas as pd\n\n\ndf1 = pd.read_csv(\"data.csv\", sep=\"\\t\")\ndf1\n\n\n\n\n\n\n\n\nN\nG\nSigma\npropy1\nerr_EKF_sc\nerr_VA_sc\nerr_EM_sc\n\n\n\n\n2\n2.0\n0.062500\n0.50\n0.5\n0.093420\n0.093336\n0.093043\n\n\n4\n2.0\n0.062500\n1.00\n0.5\n0.093443\n0.091697\n0.091294\n\n\n6\n2.0\n0.062500\n2.00\n0.5\n0.093836\n0.089228\n0.088805\n\n\n8\n2.0\n0.062500\n4.00\n0.5\n0.094327\n0.086147\n0.085870\n\n\n10\n2.0\n0.062500\n8.00\n0.5\n0.096139\n0.082455\n0.082723\n\n\n18\n2.0\n0.015625\n2.00\n0.5\n0.093420\n0.093336\n0.093043\n\n\n20\n2.0\n0.015625\n4.00\n0.5\n0.093443\n0.091697\n0.091294\n\n\n22\n2.0\n0.015625\n8.00\n0.5\n0.093836\n0.089228\n0.088805\n\n\n34\n2.0\n0.003906\n8.00\n0.5\n0.093420\n0.093336\n0.093043\n\n\n48\n2.0\n0.000244\n0.25\n0.5\n0.039164\n0.039163\n0.039163\n\n\n60\n4.0\n0.062500\n0.25\n0.5\n0.100617\n0.099913\n0.099700\n\n\n62\n4.0\n0.062500\n0.50\n0.5\n0.093656\n0.091329\n0.091214\n\n\n64\n4.0\n0.062500\n1.00\n0.5\n0.085952\n0.080761\n0.080898\n\n\n66\n4.0\n0.062500\n2.00\n0.5\n0.078222\n0.070136\n0.070658\n\n\n68\n4.0\n0.062500\n4.00\n0.5\n0.072354\n0.060668\n0.061745\n\n\n70\n4.0\n0.062500\n8.00\n0.5\n0.064038\n0.051949\n0.053414\n\n\n76\n4.0\n0.015625\n1.00\n0.5\n0.100617\n0.099913\n0.099700\n\n\n78\n4.0\n0.015625\n2.00\n0.5\n0.093656\n0.091329\n0.091214\n\n\n80\n4.0\n0.015625\n4.00\n0.5\n0.085952\n0.080761\n0.080898\n\n\n82\n4.0\n0.015625\n8.00\n0.5\n0.078222\n0.070136\n0.070658\n\n\n92\n4.0\n0.003906\n4.00\n0.5\n0.100617\n0.099913\n0.099700\n\n\n94\n4.0\n0.003906\n8.00\n0.5\n0.093656\n0.091329\n0.091214\n\n\n120\n8.0\n0.062500\n0.25\n0.5\n0.096732\n0.091938\n0.092006\n\n\n122\n8.0\n0.062500\n0.50\n0.5\n0.083484\n0.076024\n0.076319\n\n\n124\n8.0\n0.062500\n1.00\n0.5\n0.071028\n0.062117\n0.062546\n\n\n126\n8.0\n0.062500\n2.00\n0.5\n0.059638\n0.050017\n0.050485\n\n\n128\n8.0\n0.062500\n4.00\n0.5\n0.048867\n0.039920\n0.040344\n\n\n130\n8.0\n0.062500\n8.00\n0.5\n0.038852\n0.031403\n0.031772\n\n\n132\n8.0\n0.015625\n0.25\n0.5\n0.120174\n0.119479\n0.119283\n\n\n134\n8.0\n0.015625\n0.50\n0.5\n0.109672\n0.107326\n0.107210\n\n\n136\n8.0\n0.015625\n1.00\n0.5\n0.096732\n0.091938\n0.092006\n\n\n138\n8.0\n0.015625\n2.00\n0.5\n0.083484\n0.076024\n0.076319\n\n\n140\n8.0\n0.015625\n4.00\n0.5\n0.071028\n0.062117\n0.062546\n\n\n142\n8.0\n0.015625\n8.00\n0.5\n0.059638\n0.050017\n0.050485\n\n\n146\n8.0\n0.003906\n0.50\n0.5\n0.125066\n0.124960\n0.124792\n\n\n148\n8.0\n0.003906\n1.00\n0.5\n0.120174\n0.119479\n0.119283\n\n\n150\n8.0\n0.003906\n2.00\n0.5\n0.109672\n0.107326\n0.107210\n\n\n152\n8.0\n0.003906\n4.00\n0.5\n0.096732\n0.091938\n0.092006\n\n\n154\n8.0\n0.003906\n8.00\n0.5\n0.083484\n0.076024\n0.076319\n\n\n156\n8.0\n0.000977\n0.25\n0.5\n0.104002\n0.103998\n0.103986\n\n\n162\n8.0\n0.000977\n2.00\n0.5\n0.125066\n0.124960\n0.124792\n\n\n164\n8.0\n0.000977\n4.00\n0.5\n0.120174\n0.119479\n0.119283\n\n\n166\n8.0\n0.000977\n8.00\n0.5\n0.109672\n0.107326\n0.107210\n\n\n168\n8.0\n0.000244\n0.25\n0.5\n0.076621\n0.076618\n0.076616\n\n\n170\n8.0\n0.000244\n0.50\n0.5\n0.090635\n0.090629\n0.090625\n\n\n172\n8.0\n0.000244\n1.00\n0.5\n0.104002\n0.103998\n0.103986\n\n\n178\n8.0\n0.000244\n8.00\n0.5\n0.125066\n0.124960\n0.124792\n\n\n\n\n\n\n\n\ndf1[(df1[\"err_EKF_sc\"] &lt; df1[\"err_VA_sc\"])].groupby(\"N\").count()\n\n\n\n\n\n\n\n\nG\nSigma\npropy1\nerr_EKF_sc\nerr_VA_sc\nerr_EM_sc\n\n\nN\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndf1[\"err_EKF_sc\"] &gt; df1[\"err_VA_sc\"]\n\n2      True\n4      True\n6      True\n8      True\n10     True\n18     True\n20     True\n22     True\n34     True\n48     True\n60     True\n62     True\n64     True\n66     True\n68     True\n70     True\n76     True\n78     True\n80     True\n82     True\n92     True\n94     True\n120    True\n122    True\n124    True\n126    True\n128    True\n130    True\n132    True\n134    True\n136    True\n138    True\n140    True\n142    True\n146    True\n148    True\n150    True\n152    True\n154    True\n156    True\n162    True\n164    True\n166    True\n168    True\n170    True\n172    True\n178    True\ndtype: bool",
    "crumbs": [
      "実験関数",
      "実験"
    ]
  },
  {
    "objectID": "Exp/keybatch.html",
    "href": "Exp/keybatch.html",
    "title": "key によるバッチ化",
    "section": "",
    "text": "---\nskip_showdoc: true\n---\n\n\nN=10\nT=1000 \nG =  1/2**7 * jnp.identity(N, dtype=jnp.float32)\nSigma = 1.5 * jnp.identity(N, dtype=jnp.float32)\nw0 = 0*jnp.ones((N,), dtype=jnp.float32)/jnp.sqrt(N)\nP0 = G\npropy1 = 0.5\n\nbatched_exper = jax.vmap(\n  lambda key: Comp.RMS(key, N, T, G, w0, Sigma, P0, propy1)\n)\n\nmaster_key = jrd.PRNGKey(0)\nkeys = jrd.split(master_key, 1000)\n\nW_norms, RMS_EKF, RMS_VA, RMS_EM = batched_exper(keys)\n\n\nplt.scatter(W_norms.reshape(-1), RMS_EKF.reshape(-1))\nplt.scatter(W_norms.reshape(-1), RMS_VA.reshape(-1), marker=\"x\")\nplt.scatter(W_norms.reshape(-1), RMS_EM.reshape(-1), marker=\".\")\n\n\n\n\n\n\n\n\n\n# bin の定義\nbins = jnp.arange(0.1, 12, 0.1)\nbin_edges = jnp.arange(0.0, 12.1, 0.1)  # 例: [0.0, 0.1, 0.2, ..., 12.0]\n\n# 各要素が属するビンを計算 (1~len(bins) のインデックス)\nbin_idx = jnp.digitize(W_norms.ravel(), bin_edges) - 1  # shape (T*N,)\n\n# フラット化\nekf_flat = RMS_EKF.ravel()\nva_flat  = RMS_VA.ravel()\nem_flat = RMS_EM.ravel()\n\n# 各 bin ごとの総和とカウントを計算\nsum_ekf = jnp.bincount(bin_idx, weights=ekf_flat, length=len(bins))\nsum_va  = jnp.bincount(bin_idx, weights=va_flat,  length=len(bins))\nsum_em  = jnp.bincount(bin_idx, weights=em_flat,  length=len(bins))\ncounts  = jnp.bincount(bin_idx, length=len(bins))\n\n# 平均を計算（ゼロ除算防止）\nmean_ekf = jnp.where(counts &gt; 0, sum_ekf / counts, jnp.nan)\nmean_va  = jnp.where(counts &gt; 0, sum_va / counts, jnp.nan)\nmean_em  = jnp.where(counts &gt; 0, sum_em / counts, jnp.nan)\n\n# 最終結果をまとめる\ndf_source = jnp.stack([bins, mean_ekf, mean_va, mean_em], axis=1)\n\n# Pandas DataFrame に変換（必要なら）\ndf = pd.DataFrame(jnp.array(df_source), columns=[\"bin\", \"EKF_RMS\", \"VA_RMS\", \"EM_RMS\"]).set_index(\"bin\")\n\n\ndf[0.8:10].head(20)\n\n\n\n\n\n\n\n\nEKF_RMS\nVA_RMS\nEM_RMS\n\n\nbin\n\n\n\n\n\n\n\n0.8\n0.742320\n0.743473\n0.743350\n\n\n0.9\n0.839010\n0.841791\n0.841518\n\n\n1.0\n0.924905\n0.927862\n0.927469\n\n\n1.1\n1.016297\n1.020453\n1.019893\n\n\n1.2\n1.105977\n1.110465\n1.109501\n\n\n1.3\n1.174655\n1.180493\n1.179403\n\n\n1.4\n1.252368\n1.259346\n1.257725\n\n\n1.5\n1.327946\n1.335311\n1.333957\n\n\n1.6\n1.379003\n1.375262\n1.373536\n\n\n1.7\n1.458880\n1.461715\n1.460669\n\n\n1.8\n1.502239\n1.492858\n1.491333\n\n\n1.9\n1.553879\n1.537835\n1.536580\n\n\n2.0\n1.609895\n1.585574\n1.583595\n\n\n2.1\n1.650254\n1.615584\n1.614009\n\n\n2.2\n1.710323\n1.670204\n1.669090\n\n\n2.3\n1.770196\n1.712925\n1.711877\n\n\n2.4\n1.830160\n1.768064\n1.767073\n\n\n2.5\n1.889573\n1.808915\n1.808709\n\n\n2.6\n1.922787\n1.830989\n1.830768\n\n\n2.7\n1.968957\n1.869247\n1.869909\n\n\n\n\n\n\n\n\ndf[:2.7].plot()\n\n\n\n\n\n\n\n\n\nN=10\nT=1000 \nG =  1/2**9 * jnp.identity(N, dtype=jnp.float32)\nSigma = 0.5 * jnp.identity(N, dtype=jnp.float32)\nw0 = 0*jnp.ones((N,), dtype=jnp.float32)/jnp.sqrt(N)\nP0 = G\npropy1 = 0.5\n\nbatched_exper = jax.vmap(\n  lambda key: Comp.losi_error(key, N, T, G, w0, Sigma, P0, propy1)\n)\n\nmaster_key = jrd.PRNGKey(0)\nkeys = jrd.split(master_key, 1000)\n\nRMS_EKF, RMS_VA, RMS_EM = batched_exper(keys)\n\n\nRMS_EKF.sum(), RMS_VA.sum(), RMS_EM.sum()\n\n(Array(1.0641768e+07, dtype=float32),\n Array(8.087362e+06, dtype=float32),\n Array(8.100394e+06, dtype=float32))\n\n\n\nNs = [2, 4, 8]\nGs = jnp.array([1/2**4, 1/2**6, 1/2**8, 1/2**10, 1/2**12])\nSigmas = jnp.array([1/2**2, 1/2, 1, 2, 4, 8])\npropy1s = jnp.array([0.5, 0.1])\n\nimport pandas as pd\n\n# 最初に空の DataFrame を用意\ndf = pd.DataFrame(columns=[\"N\", \"G\", \"Sigma\", \"propy1\", \"err_EKF_sc\", \"err_VA_sc\", \"err_EM_sc\"])\n\nfor N in Ns:\n  print(\"N\", N)\n  for G_ in Gs:\n    print(\"G\", G_)\n    for Sigma_ in Sigmas:\n      for propy1 in propy1s:\n        T = 1000\n        G = G_ * jnp.identity(N, dtype=jnp.float32)\n        Sigma = Sigma_ * jnp.identity(N, dtype=jnp.float32)\n        w0 = 0*jnp.ones((N,), dtype=jnp.float32)/jnp.sqrt(N)\n        P0 = G\n        batched_exper = jax.vmap(\n          lambda key: Comp.losi_error(key, N, T, G, w0, Sigma, P0, propy1),\n          in_axes=(0,)\n        )\n        master_key = jrd.PRNGKey(0)\n        keys = jrd.split(master_key, 1000)\n\n        err_EKF, err_VA, err_EM = batched_exper(keys)\n\n        err_EKF_sc = jnp.sqrt(err_EKF.mean())\n        err_VA_sc = jnp.sqrt(err_VA.mean())\n        err_EM_sc = jnp.sqrt(err_EM.mean())\n\n        # pandas df に追加\n        df.loc[len(df)] = [\n            int(N),\n            float(G_),\n            float(Sigma_),\n            float(propy1),\n            float(err_EKF_sc),\n            float(err_VA_sc),\n            float(err_EM_sc)\n        ]\n\nprint(df.head())\n\nN 2\nG 0.0625\nG 0.015625\nG 0.00390625\nG 0.0009765625\nG 0.00024414062\nN 4\nG 0.0625\nG 0.015625\nG 0.00390625\nG 0.0009765625\nG 0.00024414062\nN 8\nG 0.0625\nG 0.015625\nG 0.00390625\nG 0.0009765625\nG 0.00024414062\n     N       G  Sigma  propy1  err_EKF_sc  err_VA_sc  err_EM_sc\n0  2.0  0.0625   0.25     0.5    0.092954   0.093325   0.093123\n1  2.0  0.0625   0.25     0.1    0.092736   0.093197   0.092990\n2  2.0  0.0625   0.50     0.5    0.093420   0.093336   0.093043\n3  2.0  0.0625   0.50     0.1    0.093356   0.093240   0.092941\n4  2.0  0.0625   1.00     0.5    0.093443   0.091697   0.091294\n\n\n\n\n\n\n\n\n\n\n\n\nN\nG\nSigma\npropy1\nerr_EKF_sc\nerr_VA_sc\nerr_EM_sc\n\n\n\n\n2\n2.0\n0.062500\n0.50\n0.5\n0.093420\n0.093336\n0.093043\n\n\n4\n2.0\n0.062500\n1.00\n0.5\n0.093443\n0.091697\n0.091294\n\n\n6\n2.0\n0.062500\n2.00\n0.5\n0.093836\n0.089228\n0.088805\n\n\n8\n2.0\n0.062500\n4.00\n0.5\n0.094327\n0.086147\n0.085870\n\n\n10\n2.0\n0.062500\n8.00\n0.5\n0.096139\n0.082455\n0.082723\n\n\n18\n2.0\n0.015625\n2.00\n0.5\n0.093420\n0.093336\n0.093043\n\n\n20\n2.0\n0.015625\n4.00\n0.5\n0.093443\n0.091697\n0.091294\n\n\n22\n2.0\n0.015625\n8.00\n0.5\n0.093836\n0.089228\n0.088805\n\n\n34\n2.0\n0.003906\n8.00\n0.5\n0.093420\n0.093336\n0.093043\n\n\n48\n2.0\n0.000244\n0.25\n0.5\n0.039164\n0.039163\n0.039163\n\n\n60\n4.0\n0.062500\n0.25\n0.5\n0.100617\n0.099913\n0.099700\n\n\n62\n4.0\n0.062500\n0.50\n0.5\n0.093656\n0.091329\n0.091214\n\n\n64\n4.0\n0.062500\n1.00\n0.5\n0.085952\n0.080761\n0.080898\n\n\n66\n4.0\n0.062500\n2.00\n0.5\n0.078222\n0.070136\n0.070658\n\n\n68\n4.0\n0.062500\n4.00\n0.5\n0.072354\n0.060668\n0.061745\n\n\n70\n4.0\n0.062500\n8.00\n0.5\n0.064038\n0.051949\n0.053414\n\n\n76\n4.0\n0.015625\n1.00\n0.5\n0.100617\n0.099913\n0.099700\n\n\n78\n4.0\n0.015625\n2.00\n0.5\n0.093656\n0.091329\n0.091214\n\n\n80\n4.0\n0.015625\n4.00\n0.5\n0.085952\n0.080761\n0.080898\n\n\n82\n4.0\n0.015625\n8.00\n0.5\n0.078222\n0.070136\n0.070658\n\n\n92\n4.0\n0.003906\n4.00\n0.5\n0.100617\n0.099913\n0.099700\n\n\n94\n4.0\n0.003906\n8.00\n0.5\n0.093656\n0.091329\n0.091214\n\n\n120\n8.0\n0.062500\n0.25\n0.5\n0.096732\n0.091938\n0.092006\n\n\n122\n8.0\n0.062500\n0.50\n0.5\n0.083484\n0.076024\n0.076319\n\n\n124\n8.0\n0.062500\n1.00\n0.5\n0.071028\n0.062117\n0.062546\n\n\n126\n8.0\n0.062500\n2.00\n0.5\n0.059638\n0.050017\n0.050485\n\n\n128\n8.0\n0.062500\n4.00\n0.5\n0.048867\n0.039920\n0.040344\n\n\n130\n8.0\n0.062500\n8.00\n0.5\n0.038852\n0.031403\n0.031772\n\n\n132\n8.0\n0.015625\n0.25\n0.5\n0.120174\n0.119479\n0.119283\n\n\n134\n8.0\n0.015625\n0.50\n0.5\n0.109672\n0.107326\n0.107210\n\n\n136\n8.0\n0.015625\n1.00\n0.5\n0.096732\n0.091938\n0.092006\n\n\n138\n8.0\n0.015625\n2.00\n0.5\n0.083484\n0.076024\n0.076319\n\n\n140\n8.0\n0.015625\n4.00\n0.5\n0.071028\n0.062117\n0.062546\n\n\n142\n8.0\n0.015625\n8.00\n0.5\n0.059638\n0.050017\n0.050485\n\n\n146\n8.0\n0.003906\n0.50\n0.5\n0.125066\n0.124960\n0.124792\n\n\n148\n8.0\n0.003906\n1.00\n0.5\n0.120174\n0.119479\n0.119283\n\n\n150\n8.0\n0.003906\n2.00\n0.5\n0.109672\n0.107326\n0.107210\n\n\n152\n8.0\n0.003906\n4.00\n0.5\n0.096732\n0.091938\n0.092006\n\n\n154\n8.0\n0.003906\n8.00\n0.5\n0.083484\n0.076024\n0.076319\n\n\n156\n8.0\n0.000977\n0.25\n0.5\n0.104002\n0.103998\n0.103986\n\n\n162\n8.0\n0.000977\n2.00\n0.5\n0.125066\n0.124960\n0.124792\n\n\n164\n8.0\n0.000977\n4.00\n0.5\n0.120174\n0.119479\n0.119283\n\n\n166\n8.0\n0.000977\n8.00\n0.5\n0.109672\n0.107326\n0.107210\n\n\n168\n8.0\n0.000244\n0.25\n0.5\n0.076621\n0.076618\n0.076616\n\n\n170\n8.0\n0.000244\n0.50\n0.5\n0.090635\n0.090629\n0.090625\n\n\n172\n8.0\n0.000244\n1.00\n0.5\n0.104002\n0.103998\n0.103986\n\n\n178\n8.0\n0.000244\n8.00\n0.5\n0.125066\n0.124960\n0.124792\n\n\n\n\n\n\n\n\ndf.groupby(\"propy1\").mean()\n\n\n\n\n\n\n\n\nN\nG\nSigma\nerr_EKF_sc\nerr_VA_sc\nerr_EM_sc\n\n\npropy1\n\n\n\n\n\n\n\n\n\n\n0.1\n4.666667\n0.01665\n2.625\n0.090087\n0.087966\n0.087953\n\n\n0.5\n4.666667\n0.01665\n2.625\n0.090186\n0.088121\n0.088114\n\n\n\n\n\n\n\n\ndf1 = df[df[\"propy1\"] == 0.5][[\"N\", \"G\", \"Sigma\", \"err_EKF_sc\", \"err_VA_sc\", \"err_EM_sc\"]]\n\n\ndf1.shape\n\n(90, 7)\n\n\n損失関数と同じ評価関数\n\\[E=\\|\\hat{\\mathbf w}_{t} - \\mathbf w_t\\|^2\\]\n新たに導入した評価関数: \\[E=\\sqrt{\\frac{1}{T}\\sum_t^T\\left(\\left[\\sigma(\\mathbf w_t^T\\mathbf x_t) - \\sigma(\\hat{\\mathbf w}_{t-1}^T\\mathbf x_t)\\right]^2\\right)}\\]\n\n次元数 \\(N\\) に関しての比較\n90 個のデータのうち、変分近似が拡張カルマンフィルタよりも \\(E\\) が大きかったデータは - \\(N=2\\) : 20/30 - \\(N=4\\) : 18/30 - \\(N=8\\) : 5/30\n\ndf1[(df1[\"err_EKF_sc\"] &lt; df1[\"err_VA_sc\"])].groupby(\"N\").count()\n\n\n\n\n\n\n\n\nG\nSigma\nerr_EKF_sc\nerr_VA_sc\nerr_EM_sc\n\n\nN\n\n\n\n\n\n\n\n\n\n2.0\n20\n20\n20\n20\n20\n\n\n4.0\n18\n18\n18\n18\n18\n\n\n8.0\n5\n5\n5\n5\n5\n\n\n\n\n\n\n\n遷移行列 \\(\\boldsymbol\\Gamma=pI\\) に関しての比較 90 個のデータのうち、変分近似が拡張カルマンフィルタよりも \\(E\\) が大きかったデータは [1/24, 1/26, 1/28, 1/210, 1/2**12] - \\(p = 1/2^{12}\\) : 13/18 - \\(p = 1/2^{10}\\) : 14/18 - \\(p = 1/2^8\\) : 10/18 - \\(p = 1/2^6\\) : 5/18 - \\(p = 1/2^4\\) : 1/18\n\ndf1[(df1[\"err_EKF_sc\"] &lt; df1[\"err_VA_sc\"])].groupby(\"G\").count()\n\n\n\n\n\n\n\n\nN\nSigma\nerr_EKF_sc\nerr_VA_sc\nerr_EM_sc\n\n\nG\n\n\n\n\n\n\n\n\n\n0.000244\n13\n13\n13\n13\n13\n\n\n0.000977\n14\n14\n14\n14\n14\n\n\n0.003906\n10\n10\n10\n10\n10\n\n\n0.015625\n5\n5\n5\n5\n5\n\n\n0.062500\n1\n1\n1\n1\n1\n\n\n\n\n\n\n\n\\(\\mathbf x_t\\) の共分散行列 \\(\\Sigma=qI\\) に関しての比較 [1/2**2, 1/2, 1, 2, 4, 8] - \\(q = 1/2^2\\) : 9/15 - \\(q = 1/2\\) : 9/15 - \\(q = 1\\) : 8/15 - \\(q = 2\\) : 7/15 - \\(q = 4\\) : 6/15 - \\(q = 8\\) : 4/15\n\ndf1[(df1[\"err_EKF_sc\"] &lt; df1[\"err_VA_sc\"])].groupby(\"Sigma\").count()\n\n\n\n\n\n\n\n\nN\nG\nerr_EKF_sc\nerr_VA_sc\nerr_EM_sc\n\n\nSigma\n\n\n\n\n\n\n\n\n\n0.25\n9\n9\n9\n9\n9\n\n\n0.50\n9\n9\n9\n9\n9\n\n\n1.00\n8\n8\n8\n8\n8\n\n\n2.00\n7\n7\n7\n7\n7\n\n\n4.00\n6\n6\n6\n6\n6\n\n\n8.00\n4\n4\n4\n4\n4\n\n\n\n\n\n\n\n\ndf1[[\"G\", \"err_EKF_sc\", \"err_VA_sc\", \"err_EM_sc\"]].groupby(\"G\").mean().plot()\n\n\n\n\n\n\n\n\n\ndf1[[\"Sigma\", \"err_EKF_sc\", \"err_VA_sc\", \"err_EM_sc\"]].groupby(\"Sigma\").mean().plot()\n\n\n\n\n\n\n\n\n\ndf1[[\"N\", \"err_EKF_sc\", \"err_VA_sc\", \"err_EM_sc\"]].groupby(\"N\").mean().plot()",
    "crumbs": [
      "実験関数",
      "key によるバッチ化"
    ]
  },
  {
    "objectID": "funcs.html",
    "href": "funcs.html",
    "title": "簡単な関数等",
    "section": "",
    "text": "source\n\nreshow_doc\n\n reshow_doc (sym:object)\n\n\\(\\!\\) VSCode で Quarto 拡張機能 (nbdev 拡張機能の Extention pack) を有効にすると 空セルを含むテーブルが表示されないというバグを解決する(空セルを $\\!$ で埋める)。\nshow_doc の代わりに使用すること。 \\(\\!\\)\n\n\n\n\nType\nDetails\n\n\n\n\nsym\nobject\n定義した関数等\n\n\n\n\nsource\n\n\nrewrite_nt\n\n rewrite_nt (nt:Type[NamedTuple])\n\n\\(\\!\\) NamedTuple のメンバがテーブルで表示されるように __doc__ を書き換える。\n定義した NamedTuple と同じセルで実行すること。\nコメントは下記のように、table と記載した後下に引数とコメントを列挙し、上下を空行で挟むこと。\n\ntable\n{arg1}: {comment1}\n{arg2}: {comment2}\n\n\\(\\!\\)\n\n\n\n\nType\nDetails\n\n\n\n\nnt\nType\nNamedTuple を継承したクラス\n\n\n\n\nsource\n\n\nhex_to_rgb\n\n hex_to_rgb (hex_color:str)\n\n\\(\\!\\) 6桁カラーコード(#xxyyzz)を形式 “rgb(XX, YY, ZZ)” にして出力する \\(\\!\\)\n\n\n\n\nType\nDetails\n\n\n\n\nhex_color\nstr\n#123456 のような形式\n\n\nReturns\nstr\nrgb(14, 35, 54) のような形式\n\n\n\n\nsource\n\n\nlosi\n\n losi (x:jaxtyping.Float[Array,''])\n\n\\(\\!\\) Logistic sigmoid 関数 \\[\\sigma(x)=\\frac{1}{1+e^{-x}}\\] \\(\\!\\)\n\n\n\n\nType\nDetails\n\n\n\n\nx\nFloat[Array, ’’]\n\\(x\\)\n\n\nReturns\nFloat[Array, ’’]\n\\(\\sigma(x)=1/(1+ e\\\\^{-x})\\)\n\n\n\n\nsource\n\n\ndxlosi\n\n dxlosi (x:jaxtyping.Float[Array,''])\n\n\\(\\!\\) Logistic sigmoid 関数の導関数 \\[\\frac{d}{dx}\\sigma(x)=\\sigma(x)\\{1-\\sigma(x)\\}\\] \\(\\!\\)\n\n\n\n\nType\nDetails\n\n\n\n\nx\nFloat[Array, ’’]\n\\(x\\)\n\n\nReturns\nFloat[Array, ’’]\n\\((d/dx)\\sigma(x)\\)",
    "crumbs": [
      "簡単な関数等"
    ]
  },
  {
    "objectID": "VA/index.html",
    "href": "VA/index.html",
    "title": "変分近似",
    "section": "",
    "text": "変分近似を取り入れた手法。\n\n\n\n\n\n\n\n\n\n\nTitle\n\n\n\nDescription\n\n\n\n\n\n\n\n\nVariational Approximation\n\n\n変分近似\n\n\n\n\n\n\nNo matching items",
    "crumbs": [
      "変分近似"
    ]
  },
  {
    "objectID": "VA/va.html",
    "href": "VA/va.html",
    "title": "Variational Approximation",
    "section": "",
    "text": "source\n\nlam\n\n lam (x:jaxtyping.Float[Array,''])\n\n\\(\\!\\) Lambda 関数 \\[\\lambda(x)=\\frac{1}{2x}\\left[\\sigma(x)-\\frac{1}{2}\\right]\\] \\(\\!\\)\n\n\n\n\nType\nDetails\n\n\n\n\nx\nFloat[Array, ’’]\n\\(x\\)\n\n\nReturns\nFloat[Array, ’’]\n\\(\\lambda(x)\\)\n\n\n\n\nsource\n\n\nPtt\n\n Ptt (Ptm:jaxtyping.Float[Array,'NN'], x:jaxtyping.Float[Array,'N'],\n      xi:jaxtyping.Float[Array,''])\n\n\\(\\!\\) 推定誤差共分散行列 \\(\\mathbf P_{t/t}\\)\n\\[\\mathbf P_{t/t}=\\mathbf P_{t/t-1}-\\frac{2\\lambda(\\xi_t)}{1+2\\lambda(\\xi_t)\\mathbf x_t^T\\mathbf P_{t/t-1}\\mathbf x_t}\\left(\\mathbf P_{t/t-1}\\mathbf x_t\\right)\\left(\\mathbf P_{t/t-1}\\mathbf x_t\\right)^T \\]\n\\[\\mathbf P_{t/t}^{-1}=\\mathbf P_{t/t-1}^{-1}+2\\lambda(\\xi_t)\\mathbf x_t\\mathbf x_t^T\\] \\(\\!\\)\n\n\n\n\nType\nDetails\n\n\n\n\nPtm\nFloat[Array, ‘N N’]\n\\(\\mathbf P_{t/t-1}\\)\n\n\nx\nFloat[Array, ‘N’]\n\\(\\mathbf x_t\\)\n\n\nxi\nFloat[Array, ’’]\n\\(\\xi_t\\)\n\n\nReturns\nFloat[Array, ‘N N’]\n\\(\\mathbf P_{t/t}\\)\n\n\n\n\nsource\n\n\nwtt\n\n wtt (Ptm:jaxtyping.Float[Array,'NN'], Ptt_:jaxtyping.Float[Array,'NN'],\n      w:jaxtyping.Float[Array,'N'], x:jaxtyping.Float[Array,'N'],\n      y:jaxtyping.Float[Array,''])\n\n\\(\\!\\) 濾波推定値 \\(\\hat{\\mathbf w}_{t/t}\\) \\[\\hat{\\mathbf w}_{t/t}=\\mathbf P_{t/t}\\left(\\mathbf P_{t/t-1}^{-1}\\hat{\\mathbf w}_{t/t-1}+(y_t-1/2)\\mathbf x_t\\right)\\] \\(\\!\\)\n\n\n\n\nType\nDetails\n\n\n\n\nPtm\nFloat[Array, ‘N N’]\n\\(\\mathbf P_{t/t-1}\\)\n\n\nPtt_\nFloat[Array, ‘N N’]\n\\(\\mathbf P_{t/t}\\)\n\n\nw\nFloat[Array, ‘N’]\n\\(\\hat{\\mathbf w}_{t/t-1}\\)\n\n\nx\nFloat[Array, ‘N’]\n\\(\\mathbf x_t\\)\n\n\ny\nFloat[Array, ’’]\n\\(y_t\\)\n\n\nReturns\nFloat[Array, ‘N’]\n\\(\\hat{\\mathbf w}_{t/t}\\)\n\n\n\n\nsource\n\n\nxit\n\n xit (Cov:jaxtyping.Float[Array,'NN'], w:jaxtyping.Float[Array,'N'],\n      x:jaxtyping.Float[Array,'N'])\n\n\\(\\!\\) 変分パラメータ \\(\\xi_t\\) \\[\\xi_t=\\sqrt{\\mathbf x_t^T\\mathbb E[\\mathbf w\\mathbf w^T]\\mathbf x_t}=\\sqrt{\\mathbf x_t^T\\left(\\boldsymbol \\Sigma+\\hat{\\mathbf w}\\hat{\\mathbf w}^T\\right)\\mathbf x_t}\\] \\(\\!\\)\n\n\n\n\nType\nDetails\n\n\n\n\nCov\nFloat[Array, ‘N N’]\n\\(\\boldsymbol\\Sigma\\)\n\n\nw\nFloat[Array, ‘N’]\n\\(\\hat{\\mathbf w}\\)\n\n\nx\nFloat[Array, ‘N’]\n\\(\\mathbf x_t\\)\n\n\nReturns\nFloat[Array, ’’]\n\\(\\xi_t\\)\n\n\n\n\nsource\n\n\nVApre_out\n\n VApre_out (W:jaxtyping.Float[Array,'TN'], P:jaxtyping.Float[Array,'TNN'],\n            Xi:jaxtyping.Float[Array,'T'])\n\n\\(\\!\\) VApre 関数の返り値\n\n\n\n\n\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nW\nFloat[Array, ‘T N’]\n\\(\\{\\hat{\\mathbf w}_{t/t}\\}_{t=0,\\ldots,T-1}\\)\n\n\nP\nFloat[Array, ‘T N N’]\n\\(\\{\\mathbf P_{t/t}\\}_{t=0,\\ldots,T-1}\\)\n\n\nXi\nFloat[Array, ‘T’]\n\\(\\{\\xi_t\\}_{t=0,\\ldots,T-1}\\)\n\n\n\n\\(\\!\\)\n\nsource\n\n\nVApre\n\n VApre (N:int, T:int, x:jaxtyping.Float[Array,'{T}{N}'],\n        y:jaxtyping.Float[Array,'{T}'], G:jaxtyping.Float[Array,'{N}{N}'],\n        w0:jaxtyping.Float[Array,'{N}'],\n        P0:jaxtyping.Float[Array,'{N}{N}'])\n\n\\(\\!\\) 一段予測推定値 \\(\\hat{\\mathbf w}_{t/t-1}\\) を使う変分近似法 \\[\\xi_t=\\sqrt{\\mathbf x_t^T\\left(\\mathbf P_{t/t-1}+\\hat{\\mathbf w}_{t/t-1}\\hat{\\mathbf w}_{t/t-1}^T\\right)\\mathbf x_t}\\] \\(\\!\\)\n\n\n\n\nType\nDetails\n\n\n\n\nN\nint\n\\(N\\)\n\n\nT\nint\n\\(T\\)\n\n\nx\nFloat[Array, ‘{T} {N}’]\n\\(\\{ \\mathbf x_t \\}_{t=0,\\ldots,T-1}\\)\n\n\ny\nFloat[Array, ‘{T}’]\n\\(\\{ y_t \\}_{t=0,\\ldots,T-1}\\)\n\n\nG\nFloat[Array, ‘{N} {N}’]\n\\(\\boldsymbol\\Gamma\\)\n\n\nw0\nFloat[Array, ‘{N}’]\n\\(\\hat{\\mathbf w}_{0/-1}\\)\n\n\nP0\nFloat[Array, ‘{N} {N}’]\n\\(\\mathbf P_{0/-1}\\)\n\n\nReturns\nVApre_out\n\n\n\n\n\nsource\n\n\nVAEM_out\n\n VAEM_out (W:jaxtyping.Float[Array,'TN'], P:jaxtyping.Float[Array,'TNN'],\n           Xi:jaxtyping.Float[Array,'T'], Iters:jaxtyping.Int[Array,'T'])\n\n\\(\\!\\) VAEM 関数の返り値\n\n\n\n\n\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nW\nFloat[Array, ‘T N’]\n\\(\\{\\hat{\\mathbf w}_{t/t}\\}_{t=0,\\ldots,T-1}\\)\n\n\nP\nFloat[Array, ‘T N N’]\n\\(\\{\\mathbf P_{t/t}\\}_{t=0,\\ldots,T-1}\\)\n\n\nXi\nFloat[Array, ‘T’]\n\\(\\{\\xi_t\\}_{t=0,\\ldots,T-1}\\)\n\n\nIters\nInt[Array, ‘T’]\n\\(\\{\\mathrm{Iter}_t\\}_{t=0,\\ldots,T-1}\\)\n\n\n\n\\(\\!\\)\n\nsource\n\n\nVAEM\n\n VAEM (N:int, T:int, x:jaxtyping.Float[Array,'{T}{N}'],\n       y:jaxtyping.Float[Array,'{T}'], G:jaxtyping.Float[Array,'{N}{N}'],\n       w0:jaxtyping.Float[Array,'{N}'],\n       P0:jaxtyping.Float[Array,'{N}{N}'],\n       epsilon:jaxtyping.Float[Array,''], max_iter:int=100)\n\n\\(\\!\\) 濾波推定値 \\(\\hat{\\mathbf w}_{t/t}\\) を使う変分近似法。EMアルゴリズムを使う。 \\[\\xi_t=\\sqrt{\\mathbf x_t^T\\left(\\mathbf P_{t/t}+\\hat{\\mathbf w}_{t/t}\\hat{\\mathbf w}_{t/t}^T\\right)\\mathbf x_t}\\] \\(\\!\\)\n\n\n\n\n\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\nN\nint\n\n\\(N\\)\n\n\nT\nint\n\n\\(T\\)\n\n\nx\nFloat[Array, ‘{T} {N}’]\n\n\\(\\{ \\mathbf x_t \\}_{t=0,\\ldots,T-1}\\)\n\n\ny\nFloat[Array, ‘{T}’]\n\n\\(\\{ y_t \\}_{t=0,\\ldots,T-1}\\)\n\n\nG\nFloat[Array, ‘{N} {N}’]\n\n\\(\\boldsymbol\\Gamma\\)\n\n\nw0\nFloat[Array, ‘{N}’]\n\n\\(\\hat{\\mathbf w}_{0/-1}\\)\n\n\nP0\nFloat[Array, ‘{N} {N}’]\n\n\\(\\mathbf P_{0/-1}\\)\n\n\nepsilon\nFloat[Array, ’’]\n\n\\(\\epsilon\\ge \\|\\xi\\\\^{\\text{new}}_t-\\xi\\\\^{\\text{old}}_t\\|\\)\n\n\nmax_iter\nint\n100\n繰り返し回数の上限\n\n\nReturns\nVAEM_out",
    "crumbs": [
      "変分近似",
      "Variational Approximation"
    ]
  },
  {
    "objectID": "Exp/index.html",
    "href": "Exp/index.html",
    "title": "実験関数",
    "section": "",
    "text": "実験用の関数等。Jax による並列化など。\n\n\n\n\n\n\n\n\n\n\nTitle\n\n\n\nDescription\n\n\n\n\n\n\n\n\n実験\n\n\nTest\n\n\n\n\n\n\n評価\n\n\nTest\n\n\n\n\n\n\nkey によるバッチ化\n\n\nTest\n\n\n\n\n\n\n実験関数\n\n\nYAML ファイルの生成等\n\n\n\n\n\n\nNo matching items",
    "crumbs": [
      "実験関数"
    ]
  },
  {
    "objectID": "Exp/comp.html",
    "href": "Exp/comp.html",
    "title": "評価",
    "section": "",
    "text": "N = 2\nG = 1/2**8 * jnp.identity(N, dtype=jnp.float32)\nSigma = 5.0 * jnp.identity(N, dtype=jnp.float32)\nw0 = jnp.ones((N,), dtype=jnp.float32)/jnp.sqrt(N)\npropy1 = 0.5\n\nW_norm, RMS_Wtt_EKF, RMS_Wtt_VA, RMS_Wtt_EM = RMS(\n  key=jrd.PRNGKey(0), \n  N=2, \n  T=1000, \n  G=G,\n  w0=w0,\n  Sigma=Sigma,\n  P0=G,\n  propy1=propy1)\n\n\nplt.scatter(W_norm, RMS_Wtt_EKF, label=\"EKF\")\nplt.scatter(W_norm, RMS_Wtt_VA, marker='x', label=\"VA\")\nplt.scatter(W_norm, RMS_Wtt_EM, marker='.', label=\"EM\")\nplt.legend()\n\n\n\n\n\n\n\n\n\nN = 2\nG = 1/2**8 * jnp.identity(N, dtype=jnp.float32)\nSigma = 5.0 * jnp.identity(N, dtype=jnp.float32)\nw0 = jnp.ones((N,), dtype=jnp.float32)/jnp.sqrt(N)\npropy1 = 0.5\n\nRMS_Wtt_EKF, RMS_Wtt_VA, RMS_Wtt_EM = losi_error(\n  key=jrd.PRNGKey(0), \n  N=2, \n  T=1000, \n  G=G,\n  w0=w0,\n  Sigma=Sigma,\n  P0=G,\n  propy1=propy1)\n\n\nplt.plot(RMS_Wtt_EKF, label=\"EKF\")\nplt.plot(RMS_Wtt_VA, label=\"VA\")\nplt.plot(RMS_Wtt_EM, label=\"EM\")\nplt.legend()\n\n\n\n\n\n\n\n\n\nsum(RMS_Wtt_EKF), sum(RMS_Wtt_VA), sum(RMS_Wtt_EM)\n\n(Array(10.609799, dtype=float32),\n Array(11.298924, dtype=float32),\n Array(11.056256, dtype=float32))\n\n\n\njnp.array([1,2,3])[:-1]\n\nArray([1, 2], dtype=int32)",
    "crumbs": [
      "実験関数",
      "評価"
    ]
  },
  {
    "objectID": "AnalysisStorage/analysis00.html",
    "href": "AnalysisStorage/analysis00.html",
    "title": "分析00",
    "section": "",
    "text": "Parameter (G:jaxtyping.Float[Array,'{N}{N}'],\n            S:jaxtyping.Float[Array,'{N}{N}'],\n            w0:jaxtyping.Float[Array,'{N}'],\n            P0:jaxtyping.Float[Array,'{N}{N}'],\n            epsilon:jaxtyping.Float[Array,'']=Array(1.5258789e-05,\n            dtype=float32, weak_type=True))\n\n\\(\\!\\) 00_Gen によって生成するときのパラメータ。\n\n\n\n\\(\\!\\)\nType\nDefault\nDetails\n\n\n\n\nG\nFloat[Array, ‘{N} {N}’]\n\\(\\!\\)\n\\(\\boldsymbol\\Gamma\\)\n\n\nS\nFloat[Array, ‘{N} {N}’]\n\\(\\!\\)\n\\(\\boldsymbol\\Sigma\\)\n\n\nw0\nFloat[Array, ‘{N}’]\n\\(\\!\\)\n\\(\\mathbf w_{-1}\\)\n\n\nP0\nFloat[Array, ‘{N} {N}’]\n\\(\\!\\)\n\\(\\mathbf P_{-1}\\)\n\n\nepsilon\nFloat[Array, ’’]\n1.52587890625e-05\n\\(\\epsilon\\)\n\n\n\n\\(\\!\\)\n\n\n\n\n\n\n\n\n\n Param (N:int, p:int, q:int, r:int)\n\n\\(\\!\\) 可変パラメータ。各パラメータは次のように定義される。\n\n\\(N\\)\n\\(T=1000\\)\n\\(\\boldsymbol\\Gamma=2^p\\mathbf I\\)\n\\(\\boldsymbol\\Sigma=2^q\\mathbf I\\)\n\\(\\mathbf w_{-1}=(r/2)(1,\\ldots,1)^T/\\sqrt{N}\\)\n\\(\\mathbf P_{-1}=\\boldsymbol\\Gamma\\)\n\\(\\epsilon=2^{-16}\\)\n\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nN\nint\n\\(N\\)\n\n\np\nint\n\\(p\\)\n\n\nq\nint\n\\(q\\)\n\n\nr\nint\n\\(r\\)\n\n\n\n\\(\\!\\)\n\n\n\n\n\n\n\n\n\n restore_param (param:__main__.Param)\n\n\\(\\!\\) Param から Parameter に変換する。 \\(\\!\\)\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nparam\nParam\nParam\n\n\nReturns\nTuple\n\\(N\\), \\(T\\), Parameter\n\n\n\n\n\n\n\n\n\n\n\n\n save_data (param:__main__.Param, name:str, data:dict)\n\n\\(\\!\\) 00_Data.h5 にデータを格納する\n.\n├───param1\n│   ├───Gen\n│   │       W (seed, T, N)\n│   │       X (seed, T, N)\n│   │       Y (seed, T)\n│   │\n│   ├───Model1\n│   │       W (seed, T, N)\n│   │       P (seed, T, N, N)\n│   │\n│   ├───Model2\n│\n├───param2\n\\(\\!\\)\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nparam\nParam\nParam\n\n\nname\nstr\nModel name (Gen, EKF, etc.)\n\n\ndata\ndict\ndataset_name: jnp.array\n\n\nReturns\nNone\n\\(\\!\\)\n\n\n\n\n\n\n\n\n\n\n\n\n WXY (W:jaxtyping.Float[Array,'TN'], X:jaxtyping.Float[Array,'TN'],\n      Y:jaxtyping.Float[Array,'T'])\n\n\\(\\!\\)\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nW\nFloat[Array, ‘T N’]\n\\(\\{\\mathbf w_t\\}_{t=0,\\ldots,T-1}\\)\n\n\nX\nFloat[Array, ‘T N’]\n\\(\\{\\mathbf x_t\\}_{t=0,\\ldots,T-1}\\)\n\n\nY\nFloat[Array, ‘T’]\n\\(\\{y_t\\}_{t=0,\\ldots,T-1}\\)\n\n\n\n\\(\\!\\)\n\n\n\n\n\n\n\n\n\n generate (key:Union[jaxtyping.Key[Array,''],jaxtyping.UInt32[Array,'2']],\n           N:int, T:int, p:__main__.Parameter)\n\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nkey\nUnion\nPRNGKeyArray\n\n\nN\nint\n\\(N\\)\n\n\nT\nint\n\\(T\\)\n\n\np\nParameter\nParameter\n\n\nReturns\nWXY\n\\(\\!\\)\n\n\n\n\n\n\n\n\n\n\n\n\n generate_main (param:__main__.Param, seed:int)\n\n\\(\\!\\) データを生成し、00_Data.h5 に保存する。 \\(\\!\\)\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nparam\nParam\nParam\n\n\nseed\nint\nseed値\n\n\n\n\n\n\n\n\n\n\n\n\n predict_main (param:__main__.Param, model_name:str, func:Callable[[int,in\n               t,jaxtyping.Float[Array,'TN'],jaxtyping.Float[Array,'T'],__\n               main__.Parameter],NamedTuple])\n\n\\(\\!\\) 00_Data.h5 のデータ \\(X,Y\\) に対して func で \\(W\\) 等を推論し、保存する。 \\(\\!\\)\n\n\n\n\n\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nparam\nParam\nParam\n\n\nmodel_name\nstr\nEKF, etc.\n\n\nfunc\nCallable\n\\(N,T,\\{\\mathbf x_t\\}_{t=0,\\ldots,T-1},\\{y_t\\}_{t=0,\\ldots,T-1},\\mathrm{p}\\to\\{\\hat{\\mathbf w_t}\\}_{t=0,\\ldots,T-1},\\{\\mathbf P_{t/t}\\}_{t=0,\\ldots,T-1},\\ldots\\)",
    "crumbs": [
      "分析データ",
      "分析00"
    ]
  },
  {
    "objectID": "AnalysisStorage/analysis00.html#関数定義",
    "href": "AnalysisStorage/analysis00.html#関数定義",
    "title": "分析00",
    "section": "",
    "text": "Parameter (G:jaxtyping.Float[Array,'{N}{N}'],\n            S:jaxtyping.Float[Array,'{N}{N}'],\n            w0:jaxtyping.Float[Array,'{N}'],\n            P0:jaxtyping.Float[Array,'{N}{N}'],\n            epsilon:jaxtyping.Float[Array,'']=Array(1.5258789e-05,\n            dtype=float32, weak_type=True))\n\n\\(\\!\\) 00_Gen によって生成するときのパラメータ。\n\n\n\n\\(\\!\\)\nType\nDefault\nDetails\n\n\n\n\nG\nFloat[Array, ‘{N} {N}’]\n\\(\\!\\)\n\\(\\boldsymbol\\Gamma\\)\n\n\nS\nFloat[Array, ‘{N} {N}’]\n\\(\\!\\)\n\\(\\boldsymbol\\Sigma\\)\n\n\nw0\nFloat[Array, ‘{N}’]\n\\(\\!\\)\n\\(\\mathbf w_{-1}\\)\n\n\nP0\nFloat[Array, ‘{N} {N}’]\n\\(\\!\\)\n\\(\\mathbf P_{-1}\\)\n\n\nepsilon\nFloat[Array, ’’]\n1.52587890625e-05\n\\(\\epsilon\\)\n\n\n\n\\(\\!\\)\n\n\n\n\n\n\n\n\n\n Param (N:int, p:int, q:int, r:int)\n\n\\(\\!\\) 可変パラメータ。各パラメータは次のように定義される。\n\n\\(N\\)\n\\(T=1000\\)\n\\(\\boldsymbol\\Gamma=2^p\\mathbf I\\)\n\\(\\boldsymbol\\Sigma=2^q\\mathbf I\\)\n\\(\\mathbf w_{-1}=(r/2)(1,\\ldots,1)^T/\\sqrt{N}\\)\n\\(\\mathbf P_{-1}=\\boldsymbol\\Gamma\\)\n\\(\\epsilon=2^{-16}\\)\n\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nN\nint\n\\(N\\)\n\n\np\nint\n\\(p\\)\n\n\nq\nint\n\\(q\\)\n\n\nr\nint\n\\(r\\)\n\n\n\n\\(\\!\\)\n\n\n\n\n\n\n\n\n\n restore_param (param:__main__.Param)\n\n\\(\\!\\) Param から Parameter に変換する。 \\(\\!\\)\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nparam\nParam\nParam\n\n\nReturns\nTuple\n\\(N\\), \\(T\\), Parameter\n\n\n\n\n\n\n\n\n\n\n\n\n save_data (param:__main__.Param, name:str, data:dict)\n\n\\(\\!\\) 00_Data.h5 にデータを格納する\n.\n├───param1\n│   ├───Gen\n│   │       W (seed, T, N)\n│   │       X (seed, T, N)\n│   │       Y (seed, T)\n│   │\n│   ├───Model1\n│   │       W (seed, T, N)\n│   │       P (seed, T, N, N)\n│   │\n│   ├───Model2\n│\n├───param2\n\\(\\!\\)\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nparam\nParam\nParam\n\n\nname\nstr\nModel name (Gen, EKF, etc.)\n\n\ndata\ndict\ndataset_name: jnp.array\n\n\nReturns\nNone\n\\(\\!\\)\n\n\n\n\n\n\n\n\n\n\n\n\n WXY (W:jaxtyping.Float[Array,'TN'], X:jaxtyping.Float[Array,'TN'],\n      Y:jaxtyping.Float[Array,'T'])\n\n\\(\\!\\)\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nW\nFloat[Array, ‘T N’]\n\\(\\{\\mathbf w_t\\}_{t=0,\\ldots,T-1}\\)\n\n\nX\nFloat[Array, ‘T N’]\n\\(\\{\\mathbf x_t\\}_{t=0,\\ldots,T-1}\\)\n\n\nY\nFloat[Array, ‘T’]\n\\(\\{y_t\\}_{t=0,\\ldots,T-1}\\)\n\n\n\n\\(\\!\\)\n\n\n\n\n\n\n\n\n\n generate (key:Union[jaxtyping.Key[Array,''],jaxtyping.UInt32[Array,'2']],\n           N:int, T:int, p:__main__.Parameter)\n\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nkey\nUnion\nPRNGKeyArray\n\n\nN\nint\n\\(N\\)\n\n\nT\nint\n\\(T\\)\n\n\np\nParameter\nParameter\n\n\nReturns\nWXY\n\\(\\!\\)\n\n\n\n\n\n\n\n\n\n\n\n\n generate_main (param:__main__.Param, seed:int)\n\n\\(\\!\\) データを生成し、00_Data.h5 に保存する。 \\(\\!\\)\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nparam\nParam\nParam\n\n\nseed\nint\nseed値\n\n\n\n\n\n\n\n\n\n\n\n\n predict_main (param:__main__.Param, model_name:str, func:Callable[[int,in\n               t,jaxtyping.Float[Array,'TN'],jaxtyping.Float[Array,'T'],__\n               main__.Parameter],NamedTuple])\n\n\\(\\!\\) 00_Data.h5 のデータ \\(X,Y\\) に対して func で \\(W\\) 等を推論し、保存する。 \\(\\!\\)\n\n\n\n\n\n\n\n\n\\(\\!\\)\nType\nDetails\n\n\n\n\nparam\nParam\nParam\n\n\nmodel_name\nstr\nEKF, etc.\n\n\nfunc\nCallable\n\\(N,T,\\{\\mathbf x_t\\}_{t=0,\\ldots,T-1},\\{y_t\\}_{t=0,\\ldots,T-1},\\mathrm{p}\\to\\{\\hat{\\mathbf w_t}\\}_{t=0,\\ldots,T-1},\\{\\mathbf P_{t/t}\\}_{t=0,\\ldots,T-1},\\ldots\\)",
    "crumbs": [
      "分析データ",
      "分析00"
    ]
  },
  {
    "objectID": "AnalysisStorage/analysis00.html#関数のテスト",
    "href": "AnalysisStorage/analysis00.html#関数のテスト",
    "title": "分析00",
    "section": "関数のテスト",
    "text": "関数のテスト\n\nLOCK = True",
    "crumbs": [
      "分析データ",
      "分析00"
    ]
  },
  {
    "objectID": "AnalysisStorage/analysis00.html#データ生成",
    "href": "AnalysisStorage/analysis00.html#データ生成",
    "title": "分析00",
    "section": "データ生成",
    "text": "データ生成",
    "crumbs": [
      "分析データ",
      "分析00"
    ]
  },
  {
    "objectID": "AnalysisStorage/analysis00.html#分析",
    "href": "AnalysisStorage/analysis00.html#分析",
    "title": "分析00",
    "section": "分析",
    "text": "分析\n\n推論結果の様子\n\n\n\n\n\n\n\n\n\n\n\n結果\n\n\\(N\\)\n\\(T=1000\\)\n\\(\\boldsymbol\\Gamma=2^p\\mathbf I\\)\n\\(\\boldsymbol\\Sigma=2^q\\mathbf I\\)\n\\(\\mathbf w_{-1}=(r/2)(1,\\ldots,1)^T/\\sqrt{N}\\)\n\\(\\mathbf P_{-1}=\\boldsymbol\\Gamma\\)\n\\(\\epsilon=2^{-16}\\)\n\n\n\nListening on: localhost:8060\n\n\n\n        \n        \n\n\n\n\n誤差\n\\[E(\\{w_{0,t}\\}_{t=0,\\ldots,T})=\\{\\hat{w}_{0,t} - w_{0,t}\\}_{t=0,\\ldots,T}\\]\n\n\\(N\\)\n\\(T=1000\\)\n\\(\\boldsymbol\\Gamma=2^p\\mathbf I\\)\n\\(\\boldsymbol\\Sigma=2^q\\mathbf I\\)\n\\(\\mathbf w_{-1}=(r/2)(1,\\ldots,1)^T/\\sqrt{N}\\)\n\\(\\mathbf P_{-1}=\\boldsymbol\\Gamma\\)\n\\(\\epsilon=2^{-16}\\)\n\n\n\nListening on: localhost:8070",
    "crumbs": [
      "分析データ",
      "分析00"
    ]
  },
  {
    "objectID": "AnalysisStorage/analysis01.html",
    "href": "AnalysisStorage/analysis01.html",
    "title": "分析01",
    "section": "",
    "text": "https://archive.ics.uci.edu/dataset/312/dow+jones+index\nThis dataset contains weekly data for the Dow Jones Industrial Index. It has been used in computational investing research.\n\n\n\n\n\n\n\n項目名\n説明\n\n\n\n\nquarter\n年間の四半期（1 = 1〜3月、2 = 4〜6月）\n\n\nstock\n株式のシンボル（ティッカーコード）\n\n\ndate\n週の最終営業日（通常は金曜日）\n\n\nopen\n週の始めの株価（始値）\n\n\nhigh\n週の最高株価\n\n\nlow\n週の最安株価\n\n\nclose\n週の終わりの株価（終値）\n\n\nvolume\nその週に取引された株式の出来高（取引株数）\n\n\npercent_change_price\n週を通しての株価変動率（％）\n\n\npercent_change_volume_over_last_week\n前週と比較した出来高の変化率（％）\n\n\nprevious_weeks_volume\n前週の出来高（取引株数）\n\n\nnext_weeks_open\n翌週の始値\n\n\nnext_weeks_close\n翌週の終値\n\n\npercent_change_next_weeks_price\n翌週の株価変動率（％）\n\n\ndays_to_next_dividend\n次回配当までの日数\n\n\npercent_return_next_dividend\n次回配当による利回り（％）\n\n\n\n\ndf = pd.read_csv(\"01_Data/dow_jones_index/dow_jones_index.data\")\ndf\n\n\n\n\n\n\n\n\nquarter\nstock\ndate\nopen\nhigh\nlow\nclose\nvolume\npercent_change_price\npercent_change_volume_over_last_wk\nprevious_weeks_volume\nnext_weeks_open\nnext_weeks_close\npercent_change_next_weeks_price\ndays_to_next_dividend\npercent_return_next_dividend\n\n\n\n\n0\n1\nAA\n1/7/2011\n$15.82\n$16.72\n$15.78\n$16.42\n239655616\n3.79267\nNaN\nNaN\n$16.71\n$15.97\n-4.428490\n26\n0.182704\n\n\n1\n1\nAA\n1/14/2011\n$16.71\n$16.71\n$15.64\n$15.97\n242963398\n-4.42849\n1.380223\n239655616.0\n$16.19\n$15.79\n-2.470660\n19\n0.187852\n\n\n2\n1\nAA\n1/21/2011\n$16.19\n$16.38\n$15.60\n$15.79\n138428495\n-2.47066\n-43.024959\n242963398.0\n$15.87\n$16.13\n1.638310\n12\n0.189994\n\n\n3\n1\nAA\n1/28/2011\n$15.87\n$16.63\n$15.82\n$16.13\n151379173\n1.63831\n9.355500\n138428495.0\n$16.18\n$17.14\n5.933250\n5\n0.185989\n\n\n4\n1\nAA\n2/4/2011\n$16.18\n$17.39\n$16.18\n$17.14\n154387761\n5.93325\n1.987452\n151379173.0\n$17.33\n$17.37\n0.230814\n97\n0.175029\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n745\n2\nXOM\n5/27/2011\n$80.22\n$82.63\n$80.07\n$82.63\n68230855\n3.00424\n-21.355713\n86758820.0\n$83.28\n$81.18\n-2.521610\n75\n0.568801\n\n\n746\n2\nXOM\n6/3/2011\n$83.28\n$83.75\n$80.18\n$81.18\n78616295\n-2.52161\n15.221032\n68230855.0\n$80.93\n$79.78\n-1.420980\n68\n0.578960\n\n\n747\n2\nXOM\n6/10/2011\n$80.93\n$81.87\n$79.72\n$79.78\n92380844\n-1.42098\n17.508519\n78616295.0\n$80.00\n$79.02\n-1.225000\n61\n0.589120\n\n\n748\n2\nXOM\n6/17/2011\n$80.00\n$80.82\n$78.33\n$79.02\n100521400\n-1.22500\n8.811952\n92380844.0\n$78.65\n$76.78\n-2.377620\n54\n0.594786\n\n\n749\n2\nXOM\n6/24/2011\n$78.65\n$81.12\n$76.78\n$76.78\n118679791\n-2.37762\n18.064204\n100521400.0\n$76.88\n$82.01\n6.672740\n47\n0.612139\n\n\n\n\n750 rows × 16 columns\n\n\n\n\ndf1 = df.set_index(\"date\")\ndf1\n\n\n\n\n\n\n\n\nquarter\nstock\nopen\nhigh\nlow\nclose\nvolume\npercent_change_price\npercent_change_volume_over_last_wk\nprevious_weeks_volume\nnext_weeks_open\nnext_weeks_close\npercent_change_next_weeks_price\ndays_to_next_dividend\npercent_return_next_dividend\n\n\ndate\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n1/7/2011\n1\nAA\n$15.82\n$16.72\n$15.78\n$16.42\n239655616\n3.79267\nNaN\nNaN\n$16.71\n$15.97\n-4.428490\n26\n0.182704\n\n\n1/14/2011\n1\nAA\n$16.71\n$16.71\n$15.64\n$15.97\n242963398\n-4.42849\n1.380223\n239655616.0\n$16.19\n$15.79\n-2.470660\n19\n0.187852\n\n\n1/21/2011\n1\nAA\n$16.19\n$16.38\n$15.60\n$15.79\n138428495\n-2.47066\n-43.024959\n242963398.0\n$15.87\n$16.13\n1.638310\n12\n0.189994\n\n\n1/28/2011\n1\nAA\n$15.87\n$16.63\n$15.82\n$16.13\n151379173\n1.63831\n9.355500\n138428495.0\n$16.18\n$17.14\n5.933250\n5\n0.185989\n\n\n2/4/2011\n1\nAA\n$16.18\n$17.39\n$16.18\n$17.14\n154387761\n5.93325\n1.987452\n151379173.0\n$17.33\n$17.37\n0.230814\n97\n0.175029\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n5/27/2011\n2\nXOM\n$80.22\n$82.63\n$80.07\n$82.63\n68230855\n3.00424\n-21.355713\n86758820.0\n$83.28\n$81.18\n-2.521610\n75\n0.568801\n\n\n6/3/2011\n2\nXOM\n$83.28\n$83.75\n$80.18\n$81.18\n78616295\n-2.52161\n15.221032\n68230855.0\n$80.93\n$79.78\n-1.420980\n68\n0.578960\n\n\n6/10/2011\n2\nXOM\n$80.93\n$81.87\n$79.72\n$79.78\n92380844\n-1.42098\n17.508519\n78616295.0\n$80.00\n$79.02\n-1.225000\n61\n0.589120\n\n\n6/17/2011\n2\nXOM\n$80.00\n$80.82\n$78.33\n$79.02\n100521400\n-1.22500\n8.811952\n92380844.0\n$78.65\n$76.78\n-2.377620\n54\n0.594786\n\n\n6/24/2011\n2\nXOM\n$78.65\n$81.12\n$76.78\n$76.78\n118679791\n-2.37762\n18.064204\n100521400.0\n$76.88\n$82.01\n6.672740\n47\n0.612139\n\n\n\n\n750 rows × 15 columns\n\n\n\n\ndf1.plot()\n\n\n\n\n\n\n\n\n\nx quarter\n\n\ndol_cols = [\n  \"open\", \n  \"high\", \n  \"low\", \n  \"close\", \n  \"next_weeks_open\", \n  \"next_weeks_close\"\n  ]\n\ndf1[dol_cols] = (\n    df1[dol_cols]\n    .replace('[\\$,]', '', regex=True)  # $, , を削除\n    .astype(float)                     # float型に変換\n)\n\n\ndf1\n\n\n\n\n\n\n\n\nquarter\nstock\nopen\nhigh\nlow\nclose\nvolume\npercent_change_price\npercent_change_volume_over_last_wk\nprevious_weeks_volume\nnext_weeks_open\nnext_weeks_close\npercent_change_next_weeks_price\ndays_to_next_dividend\npercent_return_next_dividend\n\n\ndate\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n1/7/2011\n1\nAA\n15.82\n16.72\n15.78\n16.42\n239655616\n3.79267\nNaN\nNaN\n16.71\n15.97\n-4.428490\n26\n0.182704\n\n\n1/14/2011\n1\nAA\n16.71\n16.71\n15.64\n15.97\n242963398\n-4.42849\n1.380223\n239655616.0\n16.19\n15.79\n-2.470660\n19\n0.187852\n\n\n1/21/2011\n1\nAA\n16.19\n16.38\n15.60\n15.79\n138428495\n-2.47066\n-43.024959\n242963398.0\n15.87\n16.13\n1.638310\n12\n0.189994\n\n\n1/28/2011\n1\nAA\n15.87\n16.63\n15.82\n16.13\n151379173\n1.63831\n9.355500\n138428495.0\n16.18\n17.14\n5.933250\n5\n0.185989\n\n\n2/4/2011\n1\nAA\n16.18\n17.39\n16.18\n17.14\n154387761\n5.93325\n1.987452\n151379173.0\n17.33\n17.37\n0.230814\n97\n0.175029\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n5/27/2011\n2\nXOM\n80.22\n82.63\n80.07\n82.63\n68230855\n3.00424\n-21.355713\n86758820.0\n83.28\n81.18\n-2.521610\n75\n0.568801\n\n\n6/3/2011\n2\nXOM\n83.28\n83.75\n80.18\n81.18\n78616295\n-2.52161\n15.221032\n68230855.0\n80.93\n79.78\n-1.420980\n68\n0.578960\n\n\n6/10/2011\n2\nXOM\n80.93\n81.87\n79.72\n79.78\n92380844\n-1.42098\n17.508519\n78616295.0\n80.00\n79.02\n-1.225000\n61\n0.589120\n\n\n6/17/2011\n2\nXOM\n80.00\n80.82\n78.33\n79.02\n100521400\n-1.22500\n8.811952\n92380844.0\n78.65\n76.78\n-2.377620\n54\n0.594786\n\n\n6/24/2011\n2\nXOM\n78.65\n81.12\n76.78\n76.78\n118679791\n-2.37762\n18.064204\n100521400.0\n76.88\n82.01\n6.672740\n47\n0.612139\n\n\n\n\n750 rows × 15 columns\n\n\n\n\ndf1.groupby(\"stock\").count()\n\n\n\n\n\n\n\n\nquarter\nopen\nhigh\nlow\nclose\nvolume\npercent_change_price\npercent_change_volume_over_last_wk\nprevious_weeks_volume\nnext_weeks_open\nnext_weeks_close\npercent_change_next_weeks_price\ndays_to_next_dividend\npercent_return_next_dividend\n\n\nstock\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAA\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nAXP\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nBA\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nBAC\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nCAT\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nCSCO\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nCVX\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nDD\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nDIS\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nGE\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nHD\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nHPQ\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nIBM\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nINTC\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nJNJ\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nJPM\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nKO\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nKRFT\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nMCD\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nMMM\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nMRK\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nMSFT\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nPFE\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nPG\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nT\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nTRV\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nUTX\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nVZ\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nWMT\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nXOM\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\n\n\n\n\n\n\nnumcols = [\"open\", \"high\", \"low\", \"close\", \"volume\", \"percent_change_price\", \"percent_change_volume_over_last_wk\", \"previous_weeks_volume\", \"next_weeks_open\", \"next_weeks_close\", \"percent_change_next_weeks_price\", \"days_to_next_dividend\", \"percent_return_next_dividend\"]\ndfAA = df1[df1[\"stock\"] == \"AA\"][numcols]\ndfAA\n\n\n\n\n\n\n\n\nopen\nhigh\nlow\nclose\nvolume\npercent_change_price\npercent_change_volume_over_last_wk\nprevious_weeks_volume\nnext_weeks_open\nnext_weeks_close\npercent_change_next_weeks_price\ndays_to_next_dividend\npercent_return_next_dividend\n\n\ndate\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n1/7/2011\n15.82\n16.72\n15.78\n16.42\n239655616\n3.792670\nNaN\nNaN\n16.71\n15.97\n-4.428490\n26\n0.182704\n\n\n1/14/2011\n16.71\n16.71\n15.64\n15.97\n242963398\n-4.428490\n1.380223\n239655616.0\n16.19\n15.79\n-2.470660\n19\n0.187852\n\n\n1/21/2011\n16.19\n16.38\n15.60\n15.79\n138428495\n-2.470660\n-43.024959\n242963398.0\n15.87\n16.13\n1.638310\n12\n0.189994\n\n\n1/28/2011\n15.87\n16.63\n15.82\n16.13\n151379173\n1.638310\n9.355500\n138428495.0\n16.18\n17.14\n5.933250\n5\n0.185989\n\n\n2/4/2011\n16.18\n17.39\n16.18\n17.14\n154387761\n5.933250\n1.987452\n151379173.0\n17.33\n17.37\n0.230814\n97\n0.175029\n\n\n2/11/2011\n17.33\n17.48\n16.97\n17.37\n114691279\n0.230814\n-25.712195\n154387761.0\n17.39\n17.28\n-0.632547\n90\n0.172712\n\n\n2/18/2011\n17.39\n17.68\n17.28\n17.28\n80023895\n-0.632547\n-30.226696\n114691279.0\n16.98\n16.68\n-1.766780\n83\n0.173611\n\n\n2/25/2011\n16.98\n17.15\n15.96\n16.68\n132981863\n-1.766780\n66.177694\n80023895.0\n16.81\n16.58\n-1.368230\n76\n0.179856\n\n\n3/4/2011\n16.81\n16.94\n16.13\n16.58\n109493077\n-1.368230\n-17.663150\n132981863.0\n16.58\n16.03\n-3.317250\n69\n0.180941\n\n\n3/11/2011\n16.58\n16.75\n15.42\n16.03\n114332562\n-3.317250\n4.419900\n109493077.0\n15.95\n16.11\n1.003130\n62\n0.187149\n\n\n3/18/2011\n15.95\n16.33\n15.43\n16.11\n130374108\n1.003130\n14.030601\n114332562.0\n16.38\n17.09\n4.334550\n55\n0.186220\n\n\n3/25/2011\n16.38\n17.24\n16.26\n17.09\n95550392\n4.334550\n-26.710607\n130374108.0\n17.13\n17.47\n1.984820\n48\n0.175541\n\n\n4/1/2011\n17.13\n17.80\n17.02\n17.47\n103320396\n1.984820\n8.131839\n95550392.0\n17.42\n17.92\n2.870260\n41\n0.171723\n\n\n4/8/2011\n17.42\n18.47\n17.42\n17.92\n129237024\n2.870260\n25.083748\n103320396.0\n18.06\n16.52\n-8.527130\n34\n0.167411\n\n\n4/15/2011\n18.06\n18.19\n16.38\n16.52\n213061090\n-8.527130\n64.860721\n129237024.0\n16.36\n16.97\n3.728610\n27\n0.181598\n\n\n4/21/2011\n16.36\n16.97\n15.88\n16.97\n85235391\n3.728610\n-59.994858\n213061090.0\n16.94\n17.00\n0.354191\n21\n0.176783\n\n\n4/29/2011\n16.94\n17.24\n16.66\n17.00\n90831895\n0.354191\n6.565939\n85235391.0\n17.27\n17.15\n-0.694847\n13\n0.176471\n\n\n5/6/2011\n17.27\n17.96\n16.83\n17.15\n225053559\n-0.694847\n147.769309\n90831895.0\n17.16\n17.10\n-0.349650\n6\n0.174927\n\n\n5/13/2011\n17.16\n17.62\n16.75\n17.10\n111630753\n-0.349650\n-50.398139\n225053559.0\n17.00\n16.26\n-4.352940\n82\n0.175439\n\n\n5/20/2011\n17.00\n17.29\n16.26\n16.26\n118281015\n-4.352940\n5.957374\n111630753.0\n15.96\n16.48\n3.258150\n75\n0.184502\n\n\n5/27/2011\n15.96\n16.48\n15.83\n16.48\n77236662\n3.258150\n-34.700711\n118281015.0\n16.73\n15.92\n-4.841600\n68\n0.182039\n\n\n6/3/2011\n16.73\n16.83\n15.77\n15.92\n77152591\n-4.841600\n-0.108849\n77236662.0\n15.92\n15.28\n-4.020100\n61\n0.188442\n\n\n6/10/2011\n15.92\n16.03\n15.17\n15.28\n94970970\n-4.020100\n23.094985\n77152591.0\n15.29\n14.72\n-3.727930\n54\n0.196335\n\n\n6/17/2011\n15.29\n15.50\n14.59\n14.72\n111273573\n-3.727930\n17.165880\n94970970.0\n14.67\n15.23\n3.817310\n47\n0.203804\n\n\n6/24/2011\n14.67\n15.60\n14.56\n15.23\n99423717\n3.817310\n-10.649299\n111273573.0\n15.22\n16.31\n7.161630\n40\n0.196980\n\n\n\n\n\n\n\n\ncols1 = [\"open\", \"high\", \"low\", \"close\", \"next_weeks_open\", \"next_weeks_close\"]\ncols2 = [\"volume\", \"previous_weeks_volume\"]\ncols3 = [\"percent_change_price\", \"percent_change_next_weeks_price\"]\ncols4 = [\"percent_change_volume_over_last_wk\"]\ncols5 = [\"days_to_next_dividend\"]\ncols6 = [\"percent_return_next_dividend\"]\n\n\ndfAA[cols1].plot()\n\n\n\n\n\n\n\n\n\ndfAA[cols2].plot()\n\n\n\n\n\n\n\n\n\ndfAA[cols3].plot()\n\n\n\n\n\n\n\n\n\ndfAA[cols4].plot()\n\n\n\n\n\n\n\n\n\ndfAA[cols5].plot()\n\n\n\n\n\n\n\n\n\ndfAA[cols6].plot()\n\n\n\n\n\n\n\n\n\n\n\ndfAA[\"open_updown\"] = dfAA[\"open\"] &lt; dfAA[\"next_weeks_open\"]\ndfAA[\"close_updown\"] = dfAA[\"close\"] &lt; dfAA[\"next_weeks_close\"]\n\n\nup = dfAA[dfAA[\"open_updown\"]]\ndown = dfAA[~dfAA[\"open_updown\"]]\nplt.scatter(x = up[\"high\"], y = up[\"low\"])\nplt.scatter(x = down[\"high\"], y = down[\"low\"])\n\n\n\n\n\n\n\n\n\nplt.scatter(x = up[cols3[0]], y = up[cols2[0]])\nplt.scatter(x = down[cols3[0]], y = down[cols2[0]])\n\n\n\n\n\n\n\n\n\nplt.scatter(x = up[cols6[0]], y = up[cols2[0]])\nplt.scatter(x = down[cols6[0]], y = down[cols2[0]])\n\n\n\n\n\n\n\n\n\nplt.scatter(x = up[cols6[0]], y = up[cols3[0]])\nplt.scatter(x = down[cols6[0]], y = down[cols3[0]])\n\n\n\n\n\n\n\n\n\nplt.scatter(x = up[cols4[0]], y = up[cols3[0]])\nplt.scatter(x = down[cols4[0]], y = down[cols3[0]])",
    "crumbs": [
      "分析データ",
      "分析01"
    ]
  },
  {
    "objectID": "AnalysisStorage/analysis01.html#dow_jones_index",
    "href": "AnalysisStorage/analysis01.html#dow_jones_index",
    "title": "分析01",
    "section": "",
    "text": "https://archive.ics.uci.edu/dataset/312/dow+jones+index\nThis dataset contains weekly data for the Dow Jones Industrial Index. It has been used in computational investing research.\n\n\n\n\n\n\n\n項目名\n説明\n\n\n\n\nquarter\n年間の四半期（1 = 1〜3月、2 = 4〜6月）\n\n\nstock\n株式のシンボル（ティッカーコード）\n\n\ndate\n週の最終営業日（通常は金曜日）\n\n\nopen\n週の始めの株価（始値）\n\n\nhigh\n週の最高株価\n\n\nlow\n週の最安株価\n\n\nclose\n週の終わりの株価（終値）\n\n\nvolume\nその週に取引された株式の出来高（取引株数）\n\n\npercent_change_price\n週を通しての株価変動率（％）\n\n\npercent_change_volume_over_last_week\n前週と比較した出来高の変化率（％）\n\n\nprevious_weeks_volume\n前週の出来高（取引株数）\n\n\nnext_weeks_open\n翌週の始値\n\n\nnext_weeks_close\n翌週の終値\n\n\npercent_change_next_weeks_price\n翌週の株価変動率（％）\n\n\ndays_to_next_dividend\n次回配当までの日数\n\n\npercent_return_next_dividend\n次回配当による利回り（％）\n\n\n\n\ndf = pd.read_csv(\"01_Data/dow_jones_index/dow_jones_index.data\")\ndf\n\n\n\n\n\n\n\n\nquarter\nstock\ndate\nopen\nhigh\nlow\nclose\nvolume\npercent_change_price\npercent_change_volume_over_last_wk\nprevious_weeks_volume\nnext_weeks_open\nnext_weeks_close\npercent_change_next_weeks_price\ndays_to_next_dividend\npercent_return_next_dividend\n\n\n\n\n0\n1\nAA\n1/7/2011\n$15.82\n$16.72\n$15.78\n$16.42\n239655616\n3.79267\nNaN\nNaN\n$16.71\n$15.97\n-4.428490\n26\n0.182704\n\n\n1\n1\nAA\n1/14/2011\n$16.71\n$16.71\n$15.64\n$15.97\n242963398\n-4.42849\n1.380223\n239655616.0\n$16.19\n$15.79\n-2.470660\n19\n0.187852\n\n\n2\n1\nAA\n1/21/2011\n$16.19\n$16.38\n$15.60\n$15.79\n138428495\n-2.47066\n-43.024959\n242963398.0\n$15.87\n$16.13\n1.638310\n12\n0.189994\n\n\n3\n1\nAA\n1/28/2011\n$15.87\n$16.63\n$15.82\n$16.13\n151379173\n1.63831\n9.355500\n138428495.0\n$16.18\n$17.14\n5.933250\n5\n0.185989\n\n\n4\n1\nAA\n2/4/2011\n$16.18\n$17.39\n$16.18\n$17.14\n154387761\n5.93325\n1.987452\n151379173.0\n$17.33\n$17.37\n0.230814\n97\n0.175029\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n745\n2\nXOM\n5/27/2011\n$80.22\n$82.63\n$80.07\n$82.63\n68230855\n3.00424\n-21.355713\n86758820.0\n$83.28\n$81.18\n-2.521610\n75\n0.568801\n\n\n746\n2\nXOM\n6/3/2011\n$83.28\n$83.75\n$80.18\n$81.18\n78616295\n-2.52161\n15.221032\n68230855.0\n$80.93\n$79.78\n-1.420980\n68\n0.578960\n\n\n747\n2\nXOM\n6/10/2011\n$80.93\n$81.87\n$79.72\n$79.78\n92380844\n-1.42098\n17.508519\n78616295.0\n$80.00\n$79.02\n-1.225000\n61\n0.589120\n\n\n748\n2\nXOM\n6/17/2011\n$80.00\n$80.82\n$78.33\n$79.02\n100521400\n-1.22500\n8.811952\n92380844.0\n$78.65\n$76.78\n-2.377620\n54\n0.594786\n\n\n749\n2\nXOM\n6/24/2011\n$78.65\n$81.12\n$76.78\n$76.78\n118679791\n-2.37762\n18.064204\n100521400.0\n$76.88\n$82.01\n6.672740\n47\n0.612139\n\n\n\n\n750 rows × 16 columns\n\n\n\n\ndf1 = df.set_index(\"date\")\ndf1\n\n\n\n\n\n\n\n\nquarter\nstock\nopen\nhigh\nlow\nclose\nvolume\npercent_change_price\npercent_change_volume_over_last_wk\nprevious_weeks_volume\nnext_weeks_open\nnext_weeks_close\npercent_change_next_weeks_price\ndays_to_next_dividend\npercent_return_next_dividend\n\n\ndate\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n1/7/2011\n1\nAA\n$15.82\n$16.72\n$15.78\n$16.42\n239655616\n3.79267\nNaN\nNaN\n$16.71\n$15.97\n-4.428490\n26\n0.182704\n\n\n1/14/2011\n1\nAA\n$16.71\n$16.71\n$15.64\n$15.97\n242963398\n-4.42849\n1.380223\n239655616.0\n$16.19\n$15.79\n-2.470660\n19\n0.187852\n\n\n1/21/2011\n1\nAA\n$16.19\n$16.38\n$15.60\n$15.79\n138428495\n-2.47066\n-43.024959\n242963398.0\n$15.87\n$16.13\n1.638310\n12\n0.189994\n\n\n1/28/2011\n1\nAA\n$15.87\n$16.63\n$15.82\n$16.13\n151379173\n1.63831\n9.355500\n138428495.0\n$16.18\n$17.14\n5.933250\n5\n0.185989\n\n\n2/4/2011\n1\nAA\n$16.18\n$17.39\n$16.18\n$17.14\n154387761\n5.93325\n1.987452\n151379173.0\n$17.33\n$17.37\n0.230814\n97\n0.175029\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n5/27/2011\n2\nXOM\n$80.22\n$82.63\n$80.07\n$82.63\n68230855\n3.00424\n-21.355713\n86758820.0\n$83.28\n$81.18\n-2.521610\n75\n0.568801\n\n\n6/3/2011\n2\nXOM\n$83.28\n$83.75\n$80.18\n$81.18\n78616295\n-2.52161\n15.221032\n68230855.0\n$80.93\n$79.78\n-1.420980\n68\n0.578960\n\n\n6/10/2011\n2\nXOM\n$80.93\n$81.87\n$79.72\n$79.78\n92380844\n-1.42098\n17.508519\n78616295.0\n$80.00\n$79.02\n-1.225000\n61\n0.589120\n\n\n6/17/2011\n2\nXOM\n$80.00\n$80.82\n$78.33\n$79.02\n100521400\n-1.22500\n8.811952\n92380844.0\n$78.65\n$76.78\n-2.377620\n54\n0.594786\n\n\n6/24/2011\n2\nXOM\n$78.65\n$81.12\n$76.78\n$76.78\n118679791\n-2.37762\n18.064204\n100521400.0\n$76.88\n$82.01\n6.672740\n47\n0.612139\n\n\n\n\n750 rows × 15 columns\n\n\n\n\ndf1.plot()\n\n\n\n\n\n\n\n\n\nx quarter\n\n\ndol_cols = [\n  \"open\", \n  \"high\", \n  \"low\", \n  \"close\", \n  \"next_weeks_open\", \n  \"next_weeks_close\"\n  ]\n\ndf1[dol_cols] = (\n    df1[dol_cols]\n    .replace('[\\$,]', '', regex=True)  # $, , を削除\n    .astype(float)                     # float型に変換\n)\n\n\ndf1\n\n\n\n\n\n\n\n\nquarter\nstock\nopen\nhigh\nlow\nclose\nvolume\npercent_change_price\npercent_change_volume_over_last_wk\nprevious_weeks_volume\nnext_weeks_open\nnext_weeks_close\npercent_change_next_weeks_price\ndays_to_next_dividend\npercent_return_next_dividend\n\n\ndate\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n1/7/2011\n1\nAA\n15.82\n16.72\n15.78\n16.42\n239655616\n3.79267\nNaN\nNaN\n16.71\n15.97\n-4.428490\n26\n0.182704\n\n\n1/14/2011\n1\nAA\n16.71\n16.71\n15.64\n15.97\n242963398\n-4.42849\n1.380223\n239655616.0\n16.19\n15.79\n-2.470660\n19\n0.187852\n\n\n1/21/2011\n1\nAA\n16.19\n16.38\n15.60\n15.79\n138428495\n-2.47066\n-43.024959\n242963398.0\n15.87\n16.13\n1.638310\n12\n0.189994\n\n\n1/28/2011\n1\nAA\n15.87\n16.63\n15.82\n16.13\n151379173\n1.63831\n9.355500\n138428495.0\n16.18\n17.14\n5.933250\n5\n0.185989\n\n\n2/4/2011\n1\nAA\n16.18\n17.39\n16.18\n17.14\n154387761\n5.93325\n1.987452\n151379173.0\n17.33\n17.37\n0.230814\n97\n0.175029\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n5/27/2011\n2\nXOM\n80.22\n82.63\n80.07\n82.63\n68230855\n3.00424\n-21.355713\n86758820.0\n83.28\n81.18\n-2.521610\n75\n0.568801\n\n\n6/3/2011\n2\nXOM\n83.28\n83.75\n80.18\n81.18\n78616295\n-2.52161\n15.221032\n68230855.0\n80.93\n79.78\n-1.420980\n68\n0.578960\n\n\n6/10/2011\n2\nXOM\n80.93\n81.87\n79.72\n79.78\n92380844\n-1.42098\n17.508519\n78616295.0\n80.00\n79.02\n-1.225000\n61\n0.589120\n\n\n6/17/2011\n2\nXOM\n80.00\n80.82\n78.33\n79.02\n100521400\n-1.22500\n8.811952\n92380844.0\n78.65\n76.78\n-2.377620\n54\n0.594786\n\n\n6/24/2011\n2\nXOM\n78.65\n81.12\n76.78\n76.78\n118679791\n-2.37762\n18.064204\n100521400.0\n76.88\n82.01\n6.672740\n47\n0.612139\n\n\n\n\n750 rows × 15 columns\n\n\n\n\ndf1.groupby(\"stock\").count()\n\n\n\n\n\n\n\n\nquarter\nopen\nhigh\nlow\nclose\nvolume\npercent_change_price\npercent_change_volume_over_last_wk\nprevious_weeks_volume\nnext_weeks_open\nnext_weeks_close\npercent_change_next_weeks_price\ndays_to_next_dividend\npercent_return_next_dividend\n\n\nstock\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAA\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nAXP\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nBA\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nBAC\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nCAT\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nCSCO\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nCVX\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nDD\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nDIS\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nGE\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nHD\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nHPQ\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nIBM\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nINTC\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nJNJ\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nJPM\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nKO\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nKRFT\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nMCD\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nMMM\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nMRK\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nMSFT\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nPFE\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nPG\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nT\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nTRV\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nUTX\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nVZ\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nWMT\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\nXOM\n25\n25\n25\n25\n25\n25\n25\n24\n24\n25\n25\n25\n25\n25\n\n\n\n\n\n\n\n\nnumcols = [\"open\", \"high\", \"low\", \"close\", \"volume\", \"percent_change_price\", \"percent_change_volume_over_last_wk\", \"previous_weeks_volume\", \"next_weeks_open\", \"next_weeks_close\", \"percent_change_next_weeks_price\", \"days_to_next_dividend\", \"percent_return_next_dividend\"]\ndfAA = df1[df1[\"stock\"] == \"AA\"][numcols]\ndfAA\n\n\n\n\n\n\n\n\nopen\nhigh\nlow\nclose\nvolume\npercent_change_price\npercent_change_volume_over_last_wk\nprevious_weeks_volume\nnext_weeks_open\nnext_weeks_close\npercent_change_next_weeks_price\ndays_to_next_dividend\npercent_return_next_dividend\n\n\ndate\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n1/7/2011\n15.82\n16.72\n15.78\n16.42\n239655616\n3.792670\nNaN\nNaN\n16.71\n15.97\n-4.428490\n26\n0.182704\n\n\n1/14/2011\n16.71\n16.71\n15.64\n15.97\n242963398\n-4.428490\n1.380223\n239655616.0\n16.19\n15.79\n-2.470660\n19\n0.187852\n\n\n1/21/2011\n16.19\n16.38\n15.60\n15.79\n138428495\n-2.470660\n-43.024959\n242963398.0\n15.87\n16.13\n1.638310\n12\n0.189994\n\n\n1/28/2011\n15.87\n16.63\n15.82\n16.13\n151379173\n1.638310\n9.355500\n138428495.0\n16.18\n17.14\n5.933250\n5\n0.185989\n\n\n2/4/2011\n16.18\n17.39\n16.18\n17.14\n154387761\n5.933250\n1.987452\n151379173.0\n17.33\n17.37\n0.230814\n97\n0.175029\n\n\n2/11/2011\n17.33\n17.48\n16.97\n17.37\n114691279\n0.230814\n-25.712195\n154387761.0\n17.39\n17.28\n-0.632547\n90\n0.172712\n\n\n2/18/2011\n17.39\n17.68\n17.28\n17.28\n80023895\n-0.632547\n-30.226696\n114691279.0\n16.98\n16.68\n-1.766780\n83\n0.173611\n\n\n2/25/2011\n16.98\n17.15\n15.96\n16.68\n132981863\n-1.766780\n66.177694\n80023895.0\n16.81\n16.58\n-1.368230\n76\n0.179856\n\n\n3/4/2011\n16.81\n16.94\n16.13\n16.58\n109493077\n-1.368230\n-17.663150\n132981863.0\n16.58\n16.03\n-3.317250\n69\n0.180941\n\n\n3/11/2011\n16.58\n16.75\n15.42\n16.03\n114332562\n-3.317250\n4.419900\n109493077.0\n15.95\n16.11\n1.003130\n62\n0.187149\n\n\n3/18/2011\n15.95\n16.33\n15.43\n16.11\n130374108\n1.003130\n14.030601\n114332562.0\n16.38\n17.09\n4.334550\n55\n0.186220\n\n\n3/25/2011\n16.38\n17.24\n16.26\n17.09\n95550392\n4.334550\n-26.710607\n130374108.0\n17.13\n17.47\n1.984820\n48\n0.175541\n\n\n4/1/2011\n17.13\n17.80\n17.02\n17.47\n103320396\n1.984820\n8.131839\n95550392.0\n17.42\n17.92\n2.870260\n41\n0.171723\n\n\n4/8/2011\n17.42\n18.47\n17.42\n17.92\n129237024\n2.870260\n25.083748\n103320396.0\n18.06\n16.52\n-8.527130\n34\n0.167411\n\n\n4/15/2011\n18.06\n18.19\n16.38\n16.52\n213061090\n-8.527130\n64.860721\n129237024.0\n16.36\n16.97\n3.728610\n27\n0.181598\n\n\n4/21/2011\n16.36\n16.97\n15.88\n16.97\n85235391\n3.728610\n-59.994858\n213061090.0\n16.94\n17.00\n0.354191\n21\n0.176783\n\n\n4/29/2011\n16.94\n17.24\n16.66\n17.00\n90831895\n0.354191\n6.565939\n85235391.0\n17.27\n17.15\n-0.694847\n13\n0.176471\n\n\n5/6/2011\n17.27\n17.96\n16.83\n17.15\n225053559\n-0.694847\n147.769309\n90831895.0\n17.16\n17.10\n-0.349650\n6\n0.174927\n\n\n5/13/2011\n17.16\n17.62\n16.75\n17.10\n111630753\n-0.349650\n-50.398139\n225053559.0\n17.00\n16.26\n-4.352940\n82\n0.175439\n\n\n5/20/2011\n17.00\n17.29\n16.26\n16.26\n118281015\n-4.352940\n5.957374\n111630753.0\n15.96\n16.48\n3.258150\n75\n0.184502\n\n\n5/27/2011\n15.96\n16.48\n15.83\n16.48\n77236662\n3.258150\n-34.700711\n118281015.0\n16.73\n15.92\n-4.841600\n68\n0.182039\n\n\n6/3/2011\n16.73\n16.83\n15.77\n15.92\n77152591\n-4.841600\n-0.108849\n77236662.0\n15.92\n15.28\n-4.020100\n61\n0.188442\n\n\n6/10/2011\n15.92\n16.03\n15.17\n15.28\n94970970\n-4.020100\n23.094985\n77152591.0\n15.29\n14.72\n-3.727930\n54\n0.196335\n\n\n6/17/2011\n15.29\n15.50\n14.59\n14.72\n111273573\n-3.727930\n17.165880\n94970970.0\n14.67\n15.23\n3.817310\n47\n0.203804\n\n\n6/24/2011\n14.67\n15.60\n14.56\n15.23\n99423717\n3.817310\n-10.649299\n111273573.0\n15.22\n16.31\n7.161630\n40\n0.196980\n\n\n\n\n\n\n\n\ncols1 = [\"open\", \"high\", \"low\", \"close\", \"next_weeks_open\", \"next_weeks_close\"]\ncols2 = [\"volume\", \"previous_weeks_volume\"]\ncols3 = [\"percent_change_price\", \"percent_change_next_weeks_price\"]\ncols4 = [\"percent_change_volume_over_last_wk\"]\ncols5 = [\"days_to_next_dividend\"]\ncols6 = [\"percent_return_next_dividend\"]\n\n\ndfAA[cols1].plot()\n\n\n\n\n\n\n\n\n\ndfAA[cols2].plot()\n\n\n\n\n\n\n\n\n\ndfAA[cols3].plot()\n\n\n\n\n\n\n\n\n\ndfAA[cols4].plot()\n\n\n\n\n\n\n\n\n\ndfAA[cols5].plot()\n\n\n\n\n\n\n\n\n\ndfAA[cols6].plot()\n\n\n\n\n\n\n\n\n\n\n\ndfAA[\"open_updown\"] = dfAA[\"open\"] &lt; dfAA[\"next_weeks_open\"]\ndfAA[\"close_updown\"] = dfAA[\"close\"] &lt; dfAA[\"next_weeks_close\"]\n\n\nup = dfAA[dfAA[\"open_updown\"]]\ndown = dfAA[~dfAA[\"open_updown\"]]\nplt.scatter(x = up[\"high\"], y = up[\"low\"])\nplt.scatter(x = down[\"high\"], y = down[\"low\"])\n\n\n\n\n\n\n\n\n\nplt.scatter(x = up[cols3[0]], y = up[cols2[0]])\nplt.scatter(x = down[cols3[0]], y = down[cols2[0]])\n\n\n\n\n\n\n\n\n\nplt.scatter(x = up[cols6[0]], y = up[cols2[0]])\nplt.scatter(x = down[cols6[0]], y = down[cols2[0]])\n\n\n\n\n\n\n\n\n\nplt.scatter(x = up[cols6[0]], y = up[cols3[0]])\nplt.scatter(x = down[cols6[0]], y = down[cols3[0]])\n\n\n\n\n\n\n\n\n\nplt.scatter(x = up[cols4[0]], y = up[cols3[0]])\nplt.scatter(x = down[cols4[0]], y = down[cols3[0]])",
    "crumbs": [
      "分析データ",
      "分析01"
    ]
  },
  {
    "objectID": "EKF/index.html",
    "href": "EKF/index.html",
    "title": "非線形カルマンフィルタ",
    "section": "",
    "text": "拡張カルマンフィルタなど。\n\n\n\n\n\n\n\n\n\n\nTitle\n\n\n\nDescription\n\n\n\n\n\n\n\n\n非線形カルマンフィルタの概要\n\n\n概要\n\n\n\n\n\n\nExtended Kalman Filter\n\n\nDynamic Logistic Regression で導出された拡張カルマンフィルタ\n\n\n\n\n\n\nNo matching items",
    "crumbs": [
      "非線形カルマンフィルタ"
    ]
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "KalmanPaper",
    "section": "",
    "text": "This file will become your README and also the index of your documentation.",
    "crumbs": [
      "KalmanPaper"
    ]
  },
  {
    "objectID": "index.html#developer-guide",
    "href": "index.html#developer-guide",
    "title": "KalmanPaper",
    "section": "Developer Guide",
    "text": "Developer Guide\nIf you are new to using nbdev here are some useful pointers to get you started.\n\nInstall KalmanPaper in Development mode\n# make sure KalmanPaper package is installed in development mode\n$ pip install -e .\n\n# make changes under nbs/ directory\n# ...\n\n# compile to have changes apply to KalmanPaper\n$ nbdev_prepare",
    "crumbs": [
      "KalmanPaper"
    ]
  },
  {
    "objectID": "index.html#usage",
    "href": "index.html#usage",
    "title": "KalmanPaper",
    "section": "Usage",
    "text": "Usage\n\nInstallation\nInstall latest from the GitHub repository:\n$ pip install git+https://github.com/SuzuSys/KalmanPaper.git\nor from conda\n$ conda install -c SuzuSys KalmanPaper\nor from pypi\n$ pip install KalmanPaper\n\n\nDocumentation\nDocumentation can be found hosted on this GitHub repository’s pages. Additionally you can find package manager specific guidelines on conda and pypi respectively.",
    "crumbs": [
      "KalmanPaper"
    ]
  },
  {
    "objectID": "Gen/index.html",
    "href": "Gen/index.html",
    "title": "データ生成",
    "section": "",
    "text": "データ生成や実データの整形等。\n\n\n\n\n\n\n\n\n\n\nTitle\n\n\n\nDescription\n\n\n\n\n\n\n\n\n00_Gen\n\n\n乱数によってデータを生成する。生成過程: \\((\\mathbf w_t,y_t)\\to\\mathbf x_t\\)\n\n\n\n\n\n\nNo matching items",
    "crumbs": [
      "データ生成"
    ]
  }
]