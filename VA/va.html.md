# Variational Approximation


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

------------------------------------------------------------------------

<a
href="https://github.com/SuzuSys/KalmanPaper/blob/main/KalmanPaper/VA.py#L19"
target="_blank" style="float:right; font-size:smaller">source</a>

### lam

>  lam (x:jaxtyping.Float[Array,''])

* * Lambda 関数
$$\lambda(x)=\frac{1}{2x}\left\[\sigma(x)-\frac{1}{2}\right\]$$
* *

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>x</td>
<td>Float[Array, ’’]</td>
<td><span class="math inline"><em>x</em></span></td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>Float[Array, ’’]</strong></td>
<td><strong><span
class="math inline"><em>λ</em>(<em>x</em>)</span></strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/SuzuSys/KalmanPaper/blob/main/KalmanPaper/EKF.py#L19"
target="_blank" style="float:right; font-size:smaller">source</a>

### Ptt

>  Ptt (Ptm:jaxtyping.Float[Array,'NN'], x:jaxtyping.Float[Array,'N'],
>           xi:jaxtyping.Float[Array,''])

* * 推定誤差共分散行列 **P**<sub>*t*/*t*</sub>

$$\mathbf P\_{t/t}=\mathbf P\_{t/t-1}-\frac{2\lambda(\xi_t)}{1+2\lambda(\xi_t)\mathbf x_t^T\mathbf P\_{t/t-1}\mathbf x_t}\left(\mathbf P\_{t/t-1}\mathbf x_t\right)\left(\mathbf P\_{t/t-1}\mathbf x_t\right)^T $$

**P**<sub>*t*/*t*</sub><sup>−1</sup> = **P**<sub>*t*/*t* − 1</sub><sup>−1</sup> + 2*λ*(*ξ*<sub>*t*</sub>)**x**<sub>*t*</sub>**x**<sub>*t*</sub><sup>*T*</sup>
* *

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Ptm</td>
<td>Float[Array, ‘N N’]</td>
<td><span
class="math inline"><strong>P</strong><sub><em>t</em>/<em>t</em> − 1</sub></span></td>
</tr>
<tr>
<td>x</td>
<td>Float[Array, ‘N’]</td>
<td><span
class="math inline"><strong>x</strong><sub><em>t</em></sub></span></td>
</tr>
<tr>
<td>xi</td>
<td>Float[Array, ’’]</td>
<td><span
class="math inline"><em>ξ</em><sub><em>t</em></sub></span></td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>Float[Array, ‘N N’]</strong></td>
<td><strong><span
class="math inline"><strong>P</strong><sub><em>t</em>/<em>t</em></sub></span></strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/SuzuSys/KalmanPaper/blob/main/KalmanPaper/EKF.py#L35"
target="_blank" style="float:right; font-size:smaller">source</a>

### wtt

>  wtt (Ptm:jaxtyping.Float[Array,'NN'], Ptt_:jaxtyping.Float[Array,'NN'],
>           w:jaxtyping.Float[Array,'N'], x:jaxtyping.Float[Array,'N'],
>           y:jaxtyping.Float[Array,''])

* * 濾波推定値 $\hat{\mathbf w}\_{t/t}$
$$\hat{\mathbf w}\_{t/t}=\mathbf P\_{t/t}\left(\mathbf P\_{t/t-1}^{-1}\hat{\mathbf w}\_{t/t-1}+(y_t-1/2)\mathbf x_t\right)$$
* *

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Ptm</td>
<td>Float[Array, ‘N N’]</td>
<td><span
class="math inline"><strong>P</strong><sub><em>t</em>/<em>t</em> − 1</sub></span></td>
</tr>
<tr>
<td>Ptt_</td>
<td>Float[Array, ‘N N’]</td>
<td><span
class="math inline"><strong>P</strong><sub><em>t</em>/<em>t</em></sub></span></td>
</tr>
<tr>
<td>w</td>
<td>Float[Array, ‘N’]</td>
<td><span class="math inline">$\hat{\mathbf w}_{t/t-1}$</span></td>
</tr>
<tr>
<td>x</td>
<td>Float[Array, ‘N’]</td>
<td><span
class="math inline"><strong>x</strong><sub><em>t</em></sub></span></td>
</tr>
<tr>
<td>y</td>
<td>Float[Array, ’’]</td>
<td><span
class="math inline"><em>y</em><sub><em>t</em></sub></span></td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>Float[Array, ‘N’]</strong></td>
<td><strong><span class="math inline">$\hat{\mathbf
w}_{t/t}$</span></strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/SuzuSys/KalmanPaper/blob/main/KalmanPaper/VA.py#L63"
target="_blank" style="float:right; font-size:smaller">source</a>

### xit

>  xit (Cov:jaxtyping.Float[Array,'NN'], w:jaxtyping.Float[Array,'N'],
>           x:jaxtyping.Float[Array,'N'])

* * 変分パラメータ *ξ*<sub>*t*</sub>
$$\xi_t=\sqrt{\mathbf x_t^T\mathbb E\[\mathbf w\mathbf w^T\]\mathbf x_t}=\sqrt{\mathbf x_t^T\left(\boldsymbol \Sigma+\hat{\mathbf w}\hat{\mathbf w}^T\right)\mathbf x_t}$$
* *

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Cov</td>
<td>Float[Array, ‘N N’]</td>
<td><span class="math inline"><strong>Σ</strong></span></td>
</tr>
<tr>
<td>w</td>
<td>Float[Array, ‘N’]</td>
<td><span class="math inline">$\hat{\mathbf w}$</span></td>
</tr>
<tr>
<td>x</td>
<td>Float[Array, ‘N’]</td>
<td><span
class="math inline"><strong>x</strong><sub><em>t</em></sub></span></td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>Float[Array, ’’]</strong></td>
<td><strong><span
class="math inline"><em>ξ</em><sub><em>t</em></sub></span></strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/SuzuSys/KalmanPaper/blob/main/KalmanPaper/VA.py#L75"
target="_blank" style="float:right; font-size:smaller">source</a>

### VApre_out

>  VApre_out (W:jaxtyping.Float[Array,'TN'], P:jaxtyping.Float[Array,'TNN'],
>                 Xi:jaxtyping.Float[Array,'T'])

* * [`VApre`](https://SuzuSys.github.io/KalmanPaper/VA/va.html#vapre)
関数の返り値

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th><span class="math inline"> </span></th>
<th>Type</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td>W</td>
<td>Float[Array, ‘T N’]</td>
<td><span class="math inline">$\{\hat{\mathbf
w}_{t/t}\}_{t=0,\ldots,T-1}$</span></td>
</tr>
<tr>
<td>P</td>
<td>Float[Array, ‘T N N’]</td>
<td><span
class="math inline">{<strong>P</strong><sub><em>t</em>/<em>t</em></sub>}<sub><em>t</em> = 0, …, <em>T</em> − 1</sub></span></td>
</tr>
<tr>
<td>Xi</td>
<td>Float[Array, ‘T’]</td>
<td><span
class="math inline">{<em>ξ</em><sub><em>t</em></sub>}<sub><em>t</em> = 0, …, <em>T</em> − 1</sub></span></td>
</tr>
</tbody>
</table>

* *

------------------------------------------------------------------------

<a
href="https://github.com/SuzuSys/KalmanPaper/blob/main/KalmanPaper/VA.py#L93"
target="_blank" style="float:right; font-size:smaller">source</a>

### VApre

>  VApre (N:int, T:int, x:jaxtyping.Float[Array,'{T}{N}'],
>             y:jaxtyping.Float[Array,'{T}'], G:jaxtyping.Float[Array,'{N}{N}'],
>             w0:jaxtyping.Float[Array,'{N}'],
>             P0:jaxtyping.Float[Array,'{N}{N}'])

* * 一段予測推定値 $\hat{\mathbf w}\_{t/t-1}$ を使う変分近似法
$$\xi_t=\sqrt{\mathbf x_t^T\left(\mathbf P\_{t/t-1}+\hat{\mathbf w}\_{t/t-1}\hat{\mathbf w}\_{t/t-1}^T\right)\mathbf x_t}$$
* *

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>N</td>
<td>int</td>
<td><span class="math inline"><em>N</em></span></td>
</tr>
<tr>
<td>T</td>
<td>int</td>
<td><span class="math inline"><em>T</em></span></td>
</tr>
<tr>
<td>x</td>
<td>Float[Array, ‘{T} {N}’]</td>
<td><span
class="math inline">{<strong>x</strong><sub><em>t</em></sub>}<sub><em>t</em> = 0, …, <em>T</em> − 1</sub></span></td>
</tr>
<tr>
<td>y</td>
<td>Float[Array, ‘{T}’]</td>
<td><span
class="math inline">{<em>y</em><sub><em>t</em></sub>}<sub><em>t</em> = 0, …, <em>T</em> − 1</sub></span></td>
</tr>
<tr>
<td>G</td>
<td>Float[Array, ‘{N} {N}’]</td>
<td><span class="math inline"><strong>Γ</strong></span></td>
</tr>
<tr>
<td>w0</td>
<td>Float[Array, ‘{N}’]</td>
<td><span class="math inline">$\hat{\mathbf w}_{0/-1}$</span></td>
</tr>
<tr>
<td>P0</td>
<td>Float[Array, ‘{N} {N}’]</td>
<td><span
class="math inline"><strong>P</strong><sub>0/ − 1</sub></span></td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>VApre_out</strong></td>
<td></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/SuzuSys/KalmanPaper/blob/main/KalmanPaper/VA.py#L136"
target="_blank" style="float:right; font-size:smaller">source</a>

### VAEM_out

>  VAEM_out (W:jaxtyping.Float[Array,'TN'], P:jaxtyping.Float[Array,'TNN'],
>                Xi:jaxtyping.Float[Array,'T'], Iters:jaxtyping.Int[Array,'T'])

* * [`VAEM`](https://SuzuSys.github.io/KalmanPaper/VA/va.html#vaem)
関数の返り値

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th><span class="math inline"> </span></th>
<th>Type</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td>W</td>
<td>Float[Array, ‘T N’]</td>
<td><span class="math inline">$\{\hat{\mathbf
w}_{t/t}\}_{t=0,\ldots,T-1}$</span></td>
</tr>
<tr>
<td>P</td>
<td>Float[Array, ‘T N N’]</td>
<td><span
class="math inline">{<strong>P</strong><sub><em>t</em>/<em>t</em></sub>}<sub><em>t</em> = 0, …, <em>T</em> − 1</sub></span></td>
</tr>
<tr>
<td>Xi</td>
<td>Float[Array, ‘T’]</td>
<td><span
class="math inline">{<em>ξ</em><sub><em>t</em></sub>}<sub><em>t</em> = 0, …, <em>T</em> − 1</sub></span></td>
</tr>
<tr>
<td>Iters</td>
<td>Int[Array, ‘T’]</td>
<td><span
class="math inline">{Iter<sub><em>t</em></sub>}<sub><em>t</em> = 0, …, <em>T</em> − 1</sub></span></td>
</tr>
</tbody>
</table>

* *

------------------------------------------------------------------------

<a
href="https://github.com/SuzuSys/KalmanPaper/blob/main/KalmanPaper/VA.py#L157"
target="_blank" style="float:right; font-size:smaller">source</a>

### VAEM

>  VAEM (N:int, T:int, x:jaxtyping.Float[Array,'{T}{N}'],
>            y:jaxtyping.Float[Array,'{T}'], G:jaxtyping.Float[Array,'{N}{N}'],
>            w0:jaxtyping.Float[Array,'{N}'],
>            P0:jaxtyping.Float[Array,'{N}{N}'],
>            epsilon:jaxtyping.Float[Array,''], max_iter:int=100)

* * 濾波推定値 $\hat{\mathbf w}\_{t/t}$
を使う変分近似法。EMアルゴリズムを使う。
$$\xi_t=\sqrt{\mathbf x_t^T\left(\mathbf P\_{t/t}+\hat{\mathbf w}\_{t/t}\hat{\mathbf w}\_{t/t}^T\right)\mathbf x_t}$$
* *

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>N</td>
<td>int</td>
<td></td>
<td><span class="math inline"><em>N</em></span></td>
</tr>
<tr>
<td>T</td>
<td>int</td>
<td></td>
<td><span class="math inline"><em>T</em></span></td>
</tr>
<tr>
<td>x</td>
<td>Float[Array, ‘{T} {N}’]</td>
<td></td>
<td><span
class="math inline">{<strong>x</strong><sub><em>t</em></sub>}<sub><em>t</em> = 0, …, <em>T</em> − 1</sub></span></td>
</tr>
<tr>
<td>y</td>
<td>Float[Array, ‘{T}’]</td>
<td></td>
<td><span
class="math inline">{<em>y</em><sub><em>t</em></sub>}<sub><em>t</em> = 0, …, <em>T</em> − 1</sub></span></td>
</tr>
<tr>
<td>G</td>
<td>Float[Array, ‘{N} {N}’]</td>
<td></td>
<td><span class="math inline"><strong>Γ</strong></span></td>
</tr>
<tr>
<td>w0</td>
<td>Float[Array, ‘{N}’]</td>
<td></td>
<td><span class="math inline">$\hat{\mathbf w}_{0/-1}$</span></td>
</tr>
<tr>
<td>P0</td>
<td>Float[Array, ‘{N} {N}’]</td>
<td></td>
<td><span
class="math inline"><strong>P</strong><sub>0/ − 1</sub></span></td>
</tr>
<tr>
<td>epsilon</td>
<td>Float[Array, ’’]</td>
<td></td>
<td><span class="math inline">$\epsilon\ge
\|\xi\\^{\text{new}}_t-\xi\\^{\text{old}}_t\|$</span></td>
</tr>
<tr>
<td>max_iter</td>
<td>int</td>
<td>100</td>
<td>繰り返し回数の上限</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>VAEM_out</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
